<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="å°å½­è€å¸ˆ">
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>ç°ä»£åŒ–çš„ API è®¾è®¡æŒ‡å— - âœï¸å°å½­å¤§å…¸âœï¸</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../css/print-site-enum-headings1.css" rel="stylesheet">
        <link href="../css/print-site-enum-headings2.css" rel="stylesheet">
        <link href="../css/print-site-enum-headings3.css" rel="stylesheet">
        <link href="../css/print-site-enum-headings4.css" rel="stylesheet">
        <link href="../css/print-site-enum-headings5.css" rel="stylesheet">
        <link href="../css/print-site-enum-headings6.css" rel="stylesheet">
        <link href="../css/print-site.css" rel="stylesheet">
        <link href="../css/print-site-mkdocs.css" rel="stylesheet">
        <link href="../extra.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">âœï¸å°å½­å¤§å…¸âœï¸</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">ç« èŠ‚åˆ—è¡¨</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href=".." class="dropdown-item">å‰è¨€</a>
</li>
                                    
<li>
    <a href="../hello_world/" class="dropdown-item">ä½ å¥½ï¼Œä¸–ç•Œ</a>
</li>
                                    
<li>
    <a href="../platform/" class="dropdown-item">å¼€å‘ç¯å¢ƒä¸å¹³å°é€‰æ‹©</a>
</li>
                                    
<li>
    <a href="../variable_types/" class="dropdown-item">å˜é‡ä¸ç±»å‹ (æœªå®Œå·¥)</a>
</li>
                                    
<li>
    <a href="../functions/" class="dropdown-item">è®¤è¯†å‡½æ•° (æœªå®Œå·¥)</a>
</li>
                                    
<li>
    <a href="../cpp_tricks/" class="dropdown-item">åº”çŸ¥åº”ä¼š C++ å°æŠ€å·§</a>
</li>
                                    
<li>
    <a href="../lambda/" class="dropdown-item">å‡½æ•°å¼ç¼–ç¨‹</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">ç°ä»£åŒ–çš„ API è®¾è®¡æŒ‡å—</a>
</li>
                                    
<li>
    <a href="../no_more_new/" class="dropdown-item">ç°ä»£ C++ ä»æ‹’ç» new å¼€å§‹</a>
</li>
                                    
<li>
    <a href="../stl_map/" class="dropdown-item">æ·±å…¥æµ…å‡º STL ç³»åˆ—ä¹‹ map (åŸºæœ¬å®Œå·¥)</a>
</li>
                                    
<li>
    <a href="../design_overview/" class="dropdown-item">è®¾è®¡æ¨¡å¼æ€»è§ˆ (æœªå®Œå·¥)</a>
</li>
                                    
<li>
    <a href="../design_virtual/" class="dropdown-item">è®©è™šå‡½æ•°å†æ¬¡ä¼Ÿå¤§ï¼</a>
</li>
                                    
<li>
    <a href="../design_gamedev/" class="dropdown-item">æ¸¸æˆå¼€å‘ä¸­å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼</a>
</li>
                                    
<li>
    <a href="../design_functor/" class="dropdown-item">å‡½æ•°å¼è®¾è®¡æ¨¡å¼</a>
</li>
                                    
<li>
    <a href="../design_variant/" class="dropdown-item">é™æ€å¤šæ€ä¸é¢å‘æ•°æ®ç¼–ç¨‹ (æœªå®Œå·¥)</a>
</li>
                                    
<li>
    <a href="../design_erasure/" class="dropdown-item">ç±»å‹æ“¦é™¤ç¥æ•™åŠå…¶å®ç° (æœªå®Œå·¥)</a>
</li>
                                    
<li>
    <a href="../design_concept/" class="dropdown-item">é¸­å­ç±»å‹ä¸ C++20 concept (æœªå®Œå·¥)</a>
</li>
                                    
<li>
    <a href="../cpp_lifetime/" class="dropdown-item">æ·±å…¥ç†è§£ææ„å‡½æ•°ä¸ç”Ÿå‘½å‘¨æœŸ</a>
</li>
                                    
<li>
    <a href="../cpp_memory/" class="dropdown-item">çœŸæ­£çš„ C++ å†…å­˜æ¨¡å‹ï¼ (æœªå®Œå·¥)</a>
</li>
                                    
<li>
    <a href="../unicode/" class="dropdown-item">å­—ç¬¦ç¼–ç é‚£äº›äº‹</a>
</li>
                                    
<li>
    <a href="../error_code/" class="dropdown-item">ç°ä»£ C++ ä¸­çš„é”™è¯¯å¤„ç† (æœªå®Œå·¥)</a>
</li>
                                    
<li>
    <a href="../warnings/" class="dropdown-item">å»ºè®® C++ ç¨‹åºå‘˜å¼€å¯çš„è­¦å‘Šé€‰é¡¹</a>
</li>
                                    
<li>
    <a href="../undef/" class="dropdown-item">æœªå®šä¹‰è¡Œä¸ºå®Œæ•´åˆ—è¡¨</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">å…³äº</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../about/" class="dropdown-item">å…³äºå°å½­è€å¸ˆ</a>
</li>
                                    
<li>
    <a href="../donate/" class="dropdown-item">èµåŠ©åå•</a>
</li>
                                    
<li>
    <a href="../recommend/" class="dropdown-item">å‚è€ƒèµ„æ–™ä¸é¡¹ç›®</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/parallel101/cppguidebook" class="nav-link">GitHub</a>
                            </li>
                            <li class="nav-item">
                                <a href="https://space.bilibili.com/263032155" class="nav-link">Bilibili</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../lambda/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../no_more_new/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/parallel101/cppguidebook/edit/master/docs/type_rich_api.md" class="nav-link"><i class="fa-brands fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#api" class="nav-link">ç°ä»£åŒ–çš„ API è®¾è®¡æŒ‡å—</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#_1" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_2" class="nav-link">ç»“æ„ä½“ä¼ å‚</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_3" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_4" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_5" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_6" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_7" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_8" class="nav-link">è¿”å›ä¸€ä¸ªç»“æ„ä½“</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_9" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_10" class="nav-link">ç±»å‹å³æ³¨é‡Š</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_11" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_12" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_13" class="nav-link">æ‹’ç»æŒ‡é’ˆï¼</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_14" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_15" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_16" class="nav-link">å¼ºç±»å‹å°è£…</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_17" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_18" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#span" class="nav-link">span â€œèƒ–æŒ‡é’ˆâ€</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_19" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_20" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_21" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_22" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_23" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_24" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_25" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_26" class="nav-link">ç©ºå€¼è¯­ä¹‰</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_27" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_28" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_29" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_30" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_31" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_32" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_33" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_34" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_35" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_36" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_37" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_38" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_39" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#stl" class="nav-link">ç‚¹åæ‰¹è¯„çš„ STL è®¾è®¡</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_40" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_41" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_42" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_43" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#stl_1" class="nav-link">ç‚¹åè¡¨æ‰¬çš„ STL éƒ¨åˆ†</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_44" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_45" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_46" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_47" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_48" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_49" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_50" class="nav-link">æšä¸¾ç±»å‹</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_51" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_52" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_53" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_54" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_55" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_56" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_57" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_58" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_59" class="nav-link">å…¶ä»–ç±»å‹å¥—çš®</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_60" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_61" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#raii" class="nav-link">RAII å°è£…</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_62" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_63" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_64" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#mutex" class="nav-link">Mutex å°è£…</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_65" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_66" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#cuda" class="nav-link">å½©è›‹ï¼šCUDA å°è£…å®æˆ˜</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_67" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_68" class="nav-link">å˜é‡åä¸ä½œç”¨åŸŸé™åˆ¶</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_69" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_70" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#getset" class="nav-link">ä½ çœŸçš„éœ€è¦ get/set å—ï¼Ÿ</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_71" class="nav-link">&mdash;</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="api">ç°ä»£åŒ–çš„ API è®¾è®¡æŒ‡å—</h1>
<p>å¦‚ä½•å†™å‡ºæ˜“äºç»´æŠ¤çš„ä»£ç ï¼Œé˜»æ­¢çŠ¯é”™ï¼Ÿ</p>
<p><strong>ç±»å‹å°±æ˜¯æœ€å¥½çš„æ³¨é‡Šï¼</strong></p>
<p><strong>Type is all you need</strong></p>
<h2 id="_1">&mdash;</h2>
<hr />
<h2 id="_2">ç»“æ„ä½“ä¼ å‚</h2>
<h2 id="_3">&mdash;</h2>
<hr />
<pre><code class="language-cpp">void foo(string name, int age, int phone, int address);

foo(&quot;å°å½­è€å¸ˆ&quot;, 24, 12345, 67890);
</code></pre>
<ul>
<li>ç—›ç‚¹ï¼šå‚æ•°å¤šï¼Œç±»å‹ç›¸ä¼¼ï¼Œå®¹æ˜“é¡ºåºå†™é”™è€Œè‡ªå·±ä¸å¯Ÿè§‰</li>
<li>å¤©ä¹¦ï¼šé˜…è¯»ä»£ç æ—¶çœ‹ä¸è§å‚æ•°åï¼Œä¸æ¸…æ¥šæ¯ä¸ªå‚æ•°åˆ†åˆ«ä»£è¡¨ä»€ä¹ˆ</li>
</ul>
<blockquote>
<p>æ€ä¹ˆåŠï¼Ÿ</p>
</blockquote>
<pre><code class="language-cpp">struct FooOptions {
    string name;
    int age;
    int phone;
    int address;
};

void foo(FooOptions opts);

foo({.name = &quot;å°å½­è€å¸ˆ&quot;, .age = 24, .phone = 12345, .address = 67890});
</code></pre>
<p>âœ”ï¸ ä¼˜é›…ï¼Œæ¯ä¸ªå‚æ•°è´Ÿè´£åšä»€ä¹ˆä¸€ç›®äº†ç„¶</p>
<h2 id="_4">&mdash;</h2>
<hr />
<p>ä¹Ÿæœ‰æŸäº›å¤§å‚æ¨å´‡æ³¨é‡Šå‚æ•°åæ¥å¢å¼ºå¯è¯»æ€§ï¼š</p>
<pre><code class="language-cpp">foo(/*name=*/&quot;å°å½­è€å¸ˆ&quot;, /*age=*/24, /*phone=*/12345, /*address=*/67890);
</code></pre>
<p>ä½†æ³¨é‡Šå¯ä»¥éª—äººï¼š</p>
<pre><code class="language-cpp">foo(/*name=*/&quot;å°å½­è€å¸ˆ&quot;, /*phone=*/12345, /*age=*/24, /*address=*/67890);
</code></pre>
<blockquote>
<p>è¿™é‡Œ age å’Œ phone å‚æ•°å†™åäº†ï¼é˜…è¯»è€…å¦‚æœä¸çœ‹ä¸‹ foo çš„å®šä¹‰ï¼Œæ ¹æœ¬å‘ç°ä¸äº†</p>
</blockquote>
<p>è€Œä»£ç ä¸ä¼šï¼š</p>
<pre><code class="language-cpp">// å³ä½¿é¡ºåºå†™é”™ï¼Œåªè¦åå­—å†™å¯¹ä¾ç„¶å¯ä»¥æ­£å¸¸è¿è¡Œ
foo({.name = &quot;å°å½­è€å¸ˆ&quot;, .phone = 12345, .age = 24, .address = 67890});
</code></pre>
<blockquote>
<p>æ€»ä¹‹ï¼Œå¥½çš„ API è®¾è®¡ç»ä¸ä¼šç»™äººç•™ä¸‹çŠ¯é”™çš„æœºä¼šï¼</p>
</blockquote>
<h2 id="_5">&mdash;</h2>
<hr />
<p>å†æ¥çœ‹ä¸€ä¸ªåœºæ™¯ï¼Œå‡è®¾fooå†…éƒ¨éœ€è¦æŠŠæ‰€æœ‰å‚æ•°è½¬å‘ç»™å¦ä¸€ä¸ªå‡½æ•°barï¼š</p>
<pre><code class="language-cpp">void bar(int index, string name, int age, int phone, int address);

void foo(string name, int age, int phone, int address) {
    bar(get_hash_index(name), name, age, phone, address);
}
</code></pre>
<ul>
<li>ç—›ç‚¹ï¼šä½ éœ€è¦ä¸æ–­åœ°å¤åˆ¶ç²˜è´´æ‰€æœ‰è¿™äº›å‚æ•°ï¼Œéå¸¸å®¹æ˜“æŠ„é”™</li>
<li>ç—›ç‚¹ï¼šä¸€æ—¦å‚æ•°ç±»å‹æœ‰æ‰€ä¿®æ”¹ï¼Œæˆ–è€…è¦åŠ æ–°å‚æ•°ï¼Œéœ€è¦æ¯ä¸ªåœ°æ–¹éƒ½æ”¹ä¸€ä¸‹</li>
</ul>
<blockquote>
<p>æ€ä¹ˆåŠï¼Ÿ</p>
</blockquote>
<pre><code class="language-cpp">struct FooOptions {
    string name;
    int age;
    int phone;
    int address;
};

void bar(int index, FooOptions opts);

void foo(FooOptions opts) {
    // æ‰€æœ‰é€»è¾‘ä¸Šç›¸å…³çš„å‚æ•°å…¨åˆå¹¶æˆä¸€ä¸ªç»“æ„ä½“ï¼Œæ–¹ä¾¿ä½¿ç”¨æ›´æ–¹ä¾¿é˜…è¯»
    bar(get_hash_index(opts.name), opts);
}
</code></pre>
<p>âœ”ï¸ ä¼˜é›…</p>
<h2 id="_6">&mdash;</h2>
<hr />
<p>å½“è€æ¿è¦æ±‚ä½ å¢åŠ ä¸€ä¸ªå‚æ•° sexï¼ŒåŠ åœ¨ age åé¢ï¼š</p>
<pre><code class="language-diff">-void foo(string name, int age, int phone, int address);
+void foo(string name, int age, int sex, int phone, int address);
</code></pre>
<p>ä½ æ‰‹å¿™è„šä¹±åœ°æ‰“å¼€æ‰€æœ‰è°ƒç”¨äº† foo çš„æ–‡ä»¶ï¼Œå‘ç°æœ‰å¤§é‡åœ°æ–¹éœ€è¦ä¿®æ”¹&hellip;</p>
<p>è€Œä¼˜é›…çš„ API æ€»è®¾è®¡å¸ˆå°å½­è€å¸ˆåªéœ€è½»è½»ä¿®æ”¹ä¸€å¤„ï¼š</p>
<pre><code class="language-cpp">struct FooOptions {
    string name;
    int age;
    int sex = 0; // ä»¤ sex é»˜è®¤ä¸º 0
    int phone;
    int address;
};
</code></pre>
<p>æ‰€æœ‰çš„è€ä»£ç ä¾ç„¶ç…§å¸¸è°ƒç”¨æ–°çš„ foo å‡½æ•°ï¼ŒæœªæŒ‡å®šçš„ sex ä¼šå…·æœ‰ç»“æ„ä½“é‡Œå®šä¹‰çš„é»˜è®¤å€¼ 0ï¼š</p>
<pre><code class="language-cpp">foo({.name = &quot;å°å½­è€å¸ˆ&quot;, .phone = 12345, .age = 24, .address = 67890});
</code></pre>
<h2 id="_7">&mdash;</h2>
<hr />
<h2 id="_8">è¿”å›ä¸€ä¸ªç»“æ„ä½“</h2>
<p>å½“ä½ éœ€è¦å¤šä¸ªè¿”å›å€¼æ—¶ï¼šä¸è¦è¿”å› pair æˆ– tupleï¼</p>
<p>ä¸€äº› STL å®¹å™¨çš„ API è®¾è®¡æ˜¯åé¢å…¸å‹ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="language-cpp">std::pair&lt;bool, iterator&gt; insert(std::pair&lt;K, V&gt; entry);
</code></pre>
<p>ç”¨çš„æ—¶å€™æ¯æ¬¡éƒ½è¦æƒ³ä¸€ä¸‹ï¼Œåˆ°åº•ç¬¬ä¸€ä¸ªæ˜¯ bool è¿˜æ˜¯ç¬¬äºŒä¸ªæ˜¯ bool æ¥ç€ï¼Ÿç„¶åçœ‹ä¸€çœ¼ IDE æç¤ºï¼Œæ‰ååº”è¿‡æ¥ã€‚</p>
<pre><code class="language-cpp">auto result = map.insert({&quot;hello&quot;, &quot;world&quot;});

cout &lt;&lt; &quot;æ˜¯å¦æˆåŠŸ: &quot; &lt;&lt; result.first &lt;&lt; '\n';
cout &lt;&lt; &quot;æ’å…¥åˆ°ä½ç½®: &quot; &lt;&lt; result.second &lt;&lt; '\n';
</code></pre>
<p>firstï¼Ÿsecondï¼Ÿè¿™ç®—ä»€ä¹ˆé¬¼ï¼Ÿ</p>
<p>æ›´å¥½çš„åšæ³•æ˜¯è¿”å›ä¸€ä¸ªå®šåˆ¶çš„ç»“æ„ä½“ï¼š</p>
<pre><code class="language-cpp">struct insert_result_t {
    bool success;
    iterator position;
};

insert_result_t insert(std::pair&lt;K, V&gt; entry);
</code></pre>
<p>ç›´æ¥é€šè¿‡åå­—è®¿é—®æˆå‘˜ï¼Œè¯­ä¹‰æ¸…æ™°æ˜ç¡®ï¼Œæˆ‘ç®¡ä½ æ˜¯ç¬¬ä¸€ä¸ªç¬¬äºŒä¸ªï¼Œæˆ‘åªæƒ³è¦è¡¨ç¤ºâ€œæ˜¯å¦æˆåŠŸ(success)â€çš„é‚£ä¸ªå˜é‡ã€‚</p>
<pre><code class="language-cpp">auto result = map.insert({&quot;hello&quot;, &quot;world&quot;});

cout &lt;&lt; &quot;æ˜¯å¦æˆåŠŸ: &quot; &lt;&lt; result.success &lt;&lt; '\n';
cout &lt;&lt; &quot;æ’å…¥åˆ°ä½ç½®: &quot; &lt;&lt; result.position &lt;&lt; '\n';
</code></pre>
<p>æœ€å¥½å½“ç„¶æ˜¯è¿”å›å’Œå‚æ•°ç±»å‹éƒ½æ˜¯ç»“æ„ä½“ï¼š</p>
<pre><code class="language-cpp">struct insert_result_t {
    bool success;
    iterator position;
};

struct map_entry_t {
    K key;
    V value;
};

insert_result_t insert(map_entry_t entry);
</code></pre>
<p>è¿™é‡Œè¯´çš„éƒ½æ¯”è¾ƒæ¿€è¿›ï¼Œä½ å¯èƒ½æš‚æ—¶ä¸ä¼šè®¤åŒï¼Œç­‰ä½ å¤§æ‰‹å¤§è„šçŠ¯äº†å‡ ä¸ªé”™ä»¥åï¼Œä½ è‡ªç„¶ä¼šå¿ƒæœå£æœã€‚
å°å½­è€å¸ˆä»¥å‰ä¹Ÿå’Œä½ ä¸€æ ·æ˜¯æŒ‡é’ˆä»™äººï¼Œä¸å–œæ¬¢å¼ºç±»å‹ï¼Œå–œæ¬¢ <code>void *</code> æ»¡å¤©é£ï¼Œç„¶åéšä¾¿æ”¹ä¸¤è¡Œå°±è¹¦å‡ºä¸ª Segmentation Faultï¼ŒæŒ‡é’ˆä¸€æ—¶çˆ½ï¼Œè°ƒè¯•ç«è‘¬åœºï¼Œç„¶åæ‰å¼€å§‹åæ€ã€‚</p>
<p>STL ä¸­ä¾ç„¶åœ¨å¤§é‡ç”¨ pair æ˜¯å› ä¸º map å®¹å™¨å‡ºç°çš„å¾ˆæ—©ï¼Œå†å²åŸå› ã€‚
æˆ‘ä»¬è‡ªå·±é¡¹ç›®çš„ API å°±ä¸è¦è®¾è®¡æˆè¿™ç†Šæ ·äº†ã€‚</p>
<blockquote>
<p>å½“ç„¶ï¼Œå’ŒæŸäº›äºŒçº§æŒ‡é’ˆè¿”å›ä»™äººç›¸æ¯” <code>cudaError_t cudaMalloc(void **pret);</code>ï¼Œè¿”å› pair å·²ç»ç®—å…ˆè¿›çš„äº†</p>
</blockquote>
<p>ä¾‹å¦‚ C++17 ä¸­çš„ <code>from_chars</code> å‡½æ•°ï¼Œä»–çš„è¿”å›ç±»å‹å°±æ˜¯ä¸€ä¸ªå®šåˆ¶çš„ç»“æ„ä½“ï¼š</p>
<pre><code class="language-cpp">struct from_chars_result {
    const char *ptr;
    errc ec;
};

from_chars_result from_chars(const char *first, const char *last, int &amp;value);
</code></pre>
<p>è¿™è¯´æ˜ä»–ä»¬ä¹Ÿå·²ç»æ„è¯†åˆ°äº†ä»¥å‰åŠ¨ä¸åŠ¨è¿”å› pair çš„è®¾è®¡æ˜¯æœ‰é—®é¢˜çš„ï¼Œå·²ç»åœ¨æ–°æ ‡å‡†ä¸­å¼€å§‹æ”¹ç”¨æ›´å¥½çš„è®¾è®¡ã€‚</p>
<h2 id="_9">&mdash;</h2>
<hr />
<h2 id="_10">ç±»å‹å³æ³¨é‡Š</h2>
<p>ä½ æ˜¯ä¸€ä¸ªæ–°æ¥çš„å‘˜å·¥ï¼Œçœ‹åˆ°ä¸‹é¢è¿™ä¸ªå‡½æ•°ï¼š</p>
<pre><code class="language-cpp">void foo(char *x);
</code></pre>
<p>è¿™é‡Œçš„ x æœ‰å¯èƒ½æ˜¯ï¼š</p>
<ol>
<li>0ç»“å°¾å­—ç¬¦ä¸²ï¼Œåªè¯»ï¼Œä½†æ˜¯ä½œè€…å¿˜äº†åŠ  const</li>
<li>æŒ‡å‘å•ä¸ªå­—ç¬¦ï¼Œç”¨äºè¿”å›å•ä¸ª charï¼ˆæŒ‡é’ˆè¿”å›ä»™äººï¼‰</li>
<li>æŒ‡å‘ä¸€ä¸ªå­—ç¬¦æ•°ç»„ç¼“å†²åŒºï¼Œç”¨äºè¿”å›å­—ç¬¦ä¸²ï¼Œä½†ç¼“å†²åŒºå¤§å°çš„ç¡®å®šæ–¹å¼æœªçŸ¥</li>
</ol>
<p>å¦‚æœä½œè€…æ²¡å†™æ–‡æ¡£ï¼Œå˜é‡ååˆéå¸¸å«ç³Šï¼Œæ ¹æœ¬ä¸çŸ¥é“è¿™ä¸ª x å‚æ•°è¦æ€ä¹ˆç”¨ã€‚</p>
<blockquote>
<p>ç±»å‹å†™çš„å¥½ï¼Œèƒ½èµ·åˆ°æ³¨é‡Šçš„ä½œç”¨ï¼</p>
</blockquote>
<pre><code class="language-cpp">void foo(string x);
</code></pre>
<p>è¿™æ ·å°±ä¸€ç›®äº†ç„¶äº†ï¼Œå¾ˆæ˜æ˜¾ï¼Œæ˜¯å­—ç¬¦ä¸²ç±»å‹çš„å‚æ•°ã€‚</p>
<pre><code class="language-cpp">void foo(string &amp;x);
</code></pre>
<p>çœ‹èµ·æ¥æ˜¯è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½†æ˜¯é€šè¿‡å¼•ç”¨ä¼ å‚çš„æ–¹å¼æ¥è¿”å›çš„</p>
<pre><code class="language-cpp">string foo();
</code></pre>
<p>é€šè¿‡å¸¸è§„æ–¹å¼ç›´æ¥è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</p>
<pre><code class="language-cpp">void foo(vector&lt;uint8_t&gt; x);
</code></pre>
<p>æ˜¯ä¸€ä¸ª 8 ä½æ— ç¬¦å·æ•´æ•°ç»„æˆçš„æ•°ç»„ï¼</p>
<pre><code class="language-cpp">void foo(span&lt;uint8_t&gt; x);
</code></pre>
<p>æ˜¯ä¸€ä¸ª 8 ä½æ— ç¬¦å·æ•´æ•°çš„æ•°ç»„åˆ‡ç‰‡ã€‚</p>
<pre><code class="language-cpp">void foo(string_view x);
</code></pre>
<p>æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²çš„åˆ‡ç‰‡ï¼Œå¯èƒ½æ˜¯ä½œè€…æƒ³è¦é¿å…æ‹·è´å¼€é”€ã€‚</p>
<h2 id="_11">&mdash;</h2>
<hr />
<p>è¿˜å¯ä»¥ä½¿ç”¨ç±»å‹åˆ«åï¼š</p>
<pre><code class="language-cpp">using ISBN = string;

BookInfo foo(ISBN isbn);
</code></pre>
<p>è¿™æ ·ç”¨æˆ·ä¸€çœ‹å°±æ˜ç™½ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯æ¥æ”¶ä¸€ä¸ª ISBN ç¼–å·ï¼ˆå‡ºç‰ˆåˆŠç‰©éƒ½æœ‰ä¸€ä¸ªè¿™ç§ç¼–å·ï¼‰ï¼Œè¿”å›å…³äºè¿™æœ¬ä¹¦çš„è¯¦ç»†ä¿¡æ¯ã€‚</p>
<p>å°½ç®¡å‡½æ•°å foo è®©äººæ‘¸ä¸ç€å¤´è„‘ï¼Œä½†ä»…å‡­ç›´è§‚çš„ç±»å‹æ ‡è¯†ï¼Œæˆ‘ä»¬å°±èƒ½å‡½æ•°åŠŸèƒ½æŠŠçŒœçš„ä¸ƒä¸ƒå…«å…«ã€‚</p>
<h2 id="_12">&mdash;</h2>
<hr />
<h2 id="_13">æ‹’ç»æŒ‡é’ˆï¼</h2>
<p>æ³¨æ„ï¼Œè¿™é‡Œ foo è¿”å›äº†ä¸€ä¸ªæŒ‡é’ˆï¼</p>
<pre><code class="language-cpp">BookInfo * foo(ISBN isbn);
</code></pre>
<p>ä»–ä»£è¡¨ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p>
<ol>
<li>æŒ‡å‘ä¸€ä¸ªå†…å­˜ä¸­å·²ç»å­˜åœ¨çš„ä¹¦ç›®é¡¹ï¼Œç”± foo è´Ÿè´£ç®¡ç†è¿™ç‰‡å†…å­˜</li>
<li>è¿”å›ä¸€ä¸ª new å‡ºæ¥çš„ BookInfo ç»“æ„ä½“ï¼Œç”±ç”¨æˆ·è´Ÿè´£ delete é‡Šæ”¾å†…å­˜</li>
<li>æ˜¯å¦è¿˜æœ‰å¯èƒ½è¿”å› NULL è¡¨ç¤ºæ‰¾ä¸åˆ°çš„æƒ…å†µï¼Ÿ</li>
<li>ç”šè‡³æœ‰å¯èƒ½è¿”å›çš„æ˜¯ä¸€ä¸ª BookInfo æ•°ç»„ï¼ŸæŒ‡é’ˆæŒ‡å‘æ•°ç»„çš„é¦–ä¸ªå…ƒç´ ï¼Œæ•°ç»„é•¿åº¦çš„åˆ¤å®šæ–¹å¼æœªçŸ¥&hellip;</li>
</ol>
<p>å¤ªå¤šæ­§ä¹‰äº†ï¼</p>
<pre><code class="language-cpp">BookInfo &amp; foo(ISBN isbn);
</code></pre>
<p>è¿™å°±å¾ˆæ¸…æ¥šï¼Œfoo ä¼šè´Ÿè´£ç®¡ç† BookInfo å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œç”¨æˆ·è·å¾—çš„åªæ˜¯ä¸€ä¸ªä¸´æ—¶çš„å¼•ç”¨ï¼Œå¹¶ä¸æŒæœ‰æ‰€æœ‰æƒã€‚</p>
<p>å¼•ç”¨çš„ç‰¹ç‚¹ï¼š</p>
<ol>
<li>ä¸€å®šä¸ä¼šæ˜¯ NULLï¼ˆæ’é™¤å¯èƒ½è¿”å› NULL çš„ç–‘è™‘ï¼‰</li>
<li>æ— æ³• delete ä¸€ä¸ªå¼•ç”¨ï¼ˆæ’é™¤å¯èƒ½éœ€è¦ç”¨æˆ·è´Ÿè´£é‡Šæ”¾å†…å­˜çš„ç–‘è™‘ï¼‰</li>
<li>ä¸ä¼šç”¨äºè¡¨ç¤ºæ•°ç»„ï¼ˆæ’é™¤å¯èƒ½è¿”å›æ•°ç»„é¦–å…ƒç´ æŒ‡é’ˆçš„ç–‘è™‘ï¼‰</li>
</ol>
<p>æ”¹ç”¨å¼•ç”¨è¿”å›å€¼ï¼Œä¸€ä¸‹å­æ€è·¯å°±æ¸…æ™°äº†å¾ˆå¤šã€‚æ²¡æœ‰é‚£ä¹ˆå¤šæ€€ç–‘å’ŒçŒœæµ‹äº†ï¼Œç”¨é€”å•ä¸€ï¼Œç”¨æ³•æ˜ç¡®ï¼Œå¼•ç”¨çœŸæ˜¯ç»ç»å­ã€‚</p>
<pre><code class="language-cpp">std::unique_ptr&lt;BookInfo&gt; foo(ISBN isbn);
</code></pre>
<p>è¿™å°±å¾ˆæ¸…æ¥šï¼Œfoo åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ BookInfoï¼Œå¹¶æŠŠç”Ÿå‘½å‘¨æœŸçš„æ‰€æœ‰æƒç§»äº¤ç»™äº†ç”¨æˆ·ã€‚</p>
<p>unique_ptr çš„ç‰¹ç‚¹ï¼š</p>
<ol>
<li>ç‹¬å æ‰€æœ‰æƒï¼Œä¸ä¼šä¸å…¶ä»–çº¿ç¨‹å…±äº«ï¼ˆæ’é™¤å¯èƒ½å¤šçº¿ç¨‹ç«äº‰çš„ç–‘è™‘ï¼‰</li>
<li>ç”Ÿå‘½å‘¨æœŸå·²ç»ç§»äº¤ç»™ç”¨æˆ·ï¼Œunique_ptr å˜é‡ç¦»å¼€ç”¨æˆ·çš„ä½œç”¨åŸŸåä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œæ— éœ€æ‰‹åŠ¨ delete</li>
<li>ä¸ä¼šç”¨äºè¡¨ç¤ºæ•°ç»„ï¼ˆå¦‚æœè¦è¡¨ç¤ºæ•°ç»„ï¼Œä¼šç”¨ <code>unique_ptr&lt;BookInfo[]&gt;</code> æˆ–è€… <code>vector&lt;BookInfo&gt;</code>ï¼‰</li>
</ol>
<p>ä½†æ˜¯ unique_ptr æœ‰ä¸€ä¸ªè‡´å‘½çš„ç„¦è™‘ç‚¹ï¼šä»–å¯ä»¥ä¸º NULLï¼
æ‰€ä»¥å½“ä½ çœ‹åˆ°ä¸€ä¸ªå‡½æ•°è¿”å› unique_ptr æˆ– shared_ptrï¼Œå°½ç®¡å‡å°‘äº†å¾ˆå¤šçš„ç–‘è™‘ï¼Œä½†â€œå¯èƒ½ä¸ºNULLâ€çš„æ‹…å¿§ä»ç„¶å­˜åœ¨ï¼
è¦ä¹ˆ foo çš„ä½œè€…åœ¨æ³¨é‡Šæˆ–æ–‡æ¡£é‡Œå†™æ˜ï¼Œâ€œfoo ä¸ä¼šè¿”å› NULLâ€æˆ–è€…â€œfoo æ‰¾ä¸åˆ°æ—¶ä¼šè¿”å› NULLâ€ï¼Œæ‰“æ¶ˆä½ çš„ç–‘è™‘ã€‚
ä½†æˆ‘ä»¬çš„è¯‰æ±‚æ˜¯é€šè¿‡ç±»å‹ï¼Œä¸€çœ¼å°±èƒ½çœ‹å‡ºå‡½æ•°æ‰€æœ‰çš„å¯èƒ½æ€§ï¼Œè€Œä¸è¦å»ä¾èµ–å¯èƒ½éª—äººçš„æ³¨é‡Šã€‚</p>
<p>ä¸ºæ­¤å¾®è½¯å®ç°äº† <a href="https://github.com/microsoft/GSL">gsl</a> åº“ï¼Œé€šè¿‡ç±»å‹ä¿®é¥°è§£å†³æŒ‡é’ˆç±»è¯­ä¹‰å«ç³Šä¸æ¸…çš„é—®é¢˜ï¼š
ä»–è§„å®šï¼Œæ‰€æœ‰å¥—äº†ä¸€å±‚ <code>gsl::not_null</code> çš„åŸå§‹æŒ‡é’ˆæˆ–æ™ºèƒ½æŒ‡é’ˆï¼Œé‡Œé¢éƒ½å¿…ç„¶ä¸ä¼šä¸º NULLã€‚
åœ¨ not_null ç±»çš„æ„é€ å‡½æ•°ä¸­ï¼Œæœ‰ç›¸åº”çš„æ–­è¨€æ£€æŸ¥ä¼ å…¥çš„æŒ‡é’ˆæ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºä¼šç›´æ¥æŠ¥é”™é€€å‡ºã€‚</p>
<pre><code class="language-cpp">gsl::not_null&lt;FILE *&gt; p = nullptr;      // ç¼–è¯‘æœŸæŠ¥é”™ï¼Œå› ä¸ºä»–é‡Œé¢å†™ç€ not_null(nullptr_t) = delete;
gsl::not_null&lt;FILE *&gt; p = fopen(...);   // å¦‚æœ fopen æ‰“å¼€å¤±è´¥ï¼Œä¸”ä¸º Debug æ„å»ºï¼Œè¿è¡Œæ—¶ä¼šè§¦å‘æ–­è¨€é”™è¯¯
</code></pre>
<p>ä¿®æ”¹åçš„å‡½æ•°æ¥å£å¦‚ä¸‹ï¼š</p>
<pre><code class="language-cpp">gsl::not_null&lt;std::unique_ptr&lt;BookInfo&gt;&gt; foo(ISBN isbn);
</code></pre>
<p>å› ä¸º gsl::not_null çš„æ„é€ å‡½æ•°ä¸­ä¼šæ£€æµ‹ç©ºæŒ‡é’ˆï¼Œå°±å‘ç”¨æˆ·ä¿è¯äº†æˆ‘è¿”å›çš„ä¸ä¼šæ˜¯ NULLã€‚</p>
<p>ä½†æ˜¯ï¼Œæœ‰æ²¡æœ‰ä¸€ç§å¯èƒ½ï¼Œä½ å¦‚æœè¦è½¬ç§»æ‰€æœ‰æƒçš„è¯ï¼Œæˆ‘ç›´æ¥è¿”å› BookInfo æœ¬èº«ä¸å°±è¡Œäº†ï¼Ÿ
é™¤é BookInfo ç‰¹åˆ«å¤§ï¼Œå¤§åˆ°ç§»åŠ¨è¿”å›çš„å¼€é”€éƒ½ä¸å¾—äº†ã€‚
ç›´æ¥è¿”å›ç±»å‹æœ¬èº«ï¼Œå°±æ˜¯ä¸€å®šä¸å¯èƒ½ä¸ºç©ºçš„ï¼Œä¸”ä¹Ÿèƒ½è¯´æ˜ç§»äº¤äº†å¯¹è±¡æ‰€æœ‰æƒç»™ç”¨æˆ·ã€‚</p>
<pre><code class="language-cpp">BookInfo foo(ISBN isbn);
</code></pre>
<h2 id="_14">&mdash;</h2>
<hr />
<p>å…¶å® GSL é‡Œå¤§é‡éƒ½æ˜¯è¿™ç§å¯æœ‰å¯æ— çš„ç©æ„ï¼Œæ¯”å¦‚ C++20 å·²ç»æœ‰äº† std::span å’Œ std::byteï¼Œä½†æ˜¯ GSL è¿˜ç»™ä½ å¼„äº†ä¸ª gsl::span å’Œ gsl::byteï¼Œä¸»è¦æ˜¯ä¸ºäº†å…¼å®¹ä½ç‰ˆæœ¬ç¼–è¯‘å™¨ï¼Œå¦‚æœä½ åœ¨æ–°é¡¹ç›®é‡Œèƒ½ç›´æ¥ç”¨ä¸Š C++20 æ ‡å‡†çš„è¯ï¼Œä¸ªäººä¸æ˜¯å¾ˆæ¨èå†å»ç”¨äº†ã€‚</p>
<p>å†æ¯”å¦‚ gsl::czstring æ˜¯ const char * çš„ç±»å‹åˆ«åï¼Œæ˜ç¡®è¡¨ç¤ºâ€œ0ç»“å°¾å­—ç¬¦ä¸²â€ï¼Œä¸ºçš„æ˜¯å’Œâ€œæŒ‡é’ˆè¿”å›ä»™äººâ€åŒºåˆ†å¼€æ¥ï¼Œæœ‰å¿…è¦å—ï¼Ÿæœ‰æ²¡æœ‰ä¸€ç§å¯èƒ½ï¼Œæˆ‘ä»¬ç°åœ¨ const char * åŸºæœ¬ä¸Šå°±â€œ0ç»“å°¾å­—ç¬¦ä¸²â€ä¸€ç§ç”¨æ³•ï¼Œè€Œä¸”æˆ‘ä»¬å¤§å¤šä¹Ÿéƒ½æ˜¯ç”¨ string å°±å¯ä»¥äº†ï¼Œconst char * åˆä¸å®‰å…¨ï¼Œåˆè¯­ä¹‰æ¨¡æ£±ä¸¤å¯ï¼Œä½•å¿…å†å»ä¸ºäº†ç”¨å®ƒä¸“é—¨å¼•å…¥ä¸ªåº“ï¼Œæ•´ä¸ªç±»å‹åˆ«åå‘¢ï¼Ÿ</p>
<pre><code class="language-cpp">using czstring = const char *;

void foo(czstring s) {          // å‘æ˜ GSL çš„äººçœŸæ˜¯ä¸ªå¤©æ‰ï¼
    if (s == &quot;å°å½­è€å¸ˆ&quot;)        // é”™è¯¯ï¼
    if (strcmp(s, &quot;å°å½­è€å¸ˆ&quot;))  // é”™è¯¯ï¼
    if (!strcmp(s, &quot;å°å½­è€å¸ˆ&quot;)) // ç»ˆäºæ­£ç¡®
    // ç„¶è€Œæˆ‘å®Œå…¨å¯ä»¥ç›´æ¥ç”¨ stringï¼Œ== çš„è¿ç®—ç¬¦é‡è½½èƒ½ç›´æ¥æ¯”è¾ƒå­—ç¬¦ä¸²å†…å®¹
    // è¿˜èƒ½éšæ—¶éšåœ° substr åˆ‡ç‰‡ï¼Œfind æŸ¥æ‰¾ï¼Œsize å¸¸æ•°å¤æ‚åº¦æŸ¥å¤§å°
}
</code></pre>
<p>ä½¿ç”¨å„å¼å„æ ·åŠŸèƒ½æ˜ç¡®çš„ç±»å‹å’Œå®¹å™¨ï¼Œæ¯”å¦‚ stringï¼Œvectorï¼Œæˆ–å¼•ç”¨ã€‚
è€Œä¸æ˜¯åŠŸèƒ½å¤ªå¤šçš„æŒ‡é’ˆï¼Œè®©ç”¨æˆ·å­¦ä¹ ä½ çš„ API æ—¶äº§ç”Ÿè¯¯è§£ï¼Œç•™ä¸‹ BUG éšæ‚£ã€‚
å¦‚æœéœ€è¦æŒ‡é’ˆï¼Œä¹Ÿå¯ä»¥é€šè¿‡ const é™å®šï¼Œæ¥å‘Šè¯‰ç”¨æˆ·è¿™ä¸ªæŒ‡é’ˆæ˜¯åªè¯»çš„è¿˜æ˜¯å¯å†™çš„ã€‚
æ€»ä¹‹ï¼Œä»£ç ä¸ä¼šæ’’è°ï¼Œä»£ç å±‚é¢èƒ½ç¦æ­¢çš„ï¼Œèƒ½å°½é‡é™åˆ¶ç”¨æ³•çš„ï¼Œå°±ä¸è¦ç”¨æ³¨é‡Šå’Œæ–‡æ¡£å»åå•†è§£å†³ã€‚</p>
<h2 id="_15">&mdash;</h2>
<hr />
<h2 id="_16">å¼ºç±»å‹å°è£…</h2>
<p>å‡è®¾ä½ æ­£åœ¨å­¦ä¹ è¿™ä¸ª Linux ç³»ç»Ÿ API å‡½æ•°ï¼š</p>
<pre><code class="language-cpp">ssize_t read(int fd, char *buf, size_t len);
// fd - æ–‡ä»¶å¥æŸ„ï¼Œint ç±»å‹
</code></pre>
<p>ä½†æ˜¯ä½ æ²¡æœ‰çœ‹ä»–çš„å‡½æ•°å‚æ•°ç±»å‹å’Œåå­—ã€‚ä½ æ˜¯è¿™æ ·è°ƒç”¨çš„ï¼š</p>
<pre><code class="language-cpp">int fd = open(...);
char buf[32];
read(32, buf, fd);
char buf[32];
read(32, buf, fd);
</code></pre>
<p>ä½ è¿™é‡Œçš„ 32 æœ¬æ„æ˜¯ç¼“å†²åŒºçš„å¤§å°ï¼Œå´ä¸å¹¸åœ°å’Œ fd å‚æ•°å†™é”™äº†ä½ç½®ï¼Œè€Œç¼–è¯‘å™¨æ¯«æ— æŠ¥é”™ï¼Œä½ æµ‘ç„¶ä¸çŸ¥ã€‚</p>
<h2 id="_17">&mdash;</h2>
<hr />
<p>ä»…ä»…åªæ˜¯è£…æ¨¡ä½œæ ·çš„ç”¨ typedef å®šä¹‰ä¸ªå¥½çœ‹çš„ç±»å‹åˆ«åï¼Œå¹¶æ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼
ä»–è¿ä½ çš„å‚æ•°å fd éƒ½èƒ½çœ‹ä¸è§ï¼Œä½ è§‰å¾—ä»–ä¼šçœ‹åˆ°ä½ çš„å‚æ•°ç±»å‹æ˜¯ä¸ªåˆ«åï¼Ÿ</p>
<p>ç”¨æˆ·ä¸€æ ·å¯ä»¥ç”¨ä¸€ä¸ªæ ¹æœ¬ä¸æ˜¯æ–‡ä»¶å¥æŸ„çš„è‡­æ•´æ•°æ¥è°ƒç”¨ä½ ï¼Œè€Œå¾—ä¸åˆ°ä»»ä½•è­¦å‘Šæˆ–æŠ¥é”™ï¼š</p>
<pre><code class="language-cpp">typedef FileHandle int;
ssize_t read(FileHandle fd, char *buf, size_t len);

read(32, buf, fd); // ç…§æ ·ç¼–è¯‘é€šè¿‡ï¼
</code></pre>
<p>å¦‚æœæˆ‘ä»¬æŠŠæ–‡ä»¶å¥æŸ„å®šä¹‰ä¸ºä¸€ä¸ªç»“æ„ä½“ï¼š</p>
<pre><code class="language-cpp">struct FileHandle {
    int handle;

    explicit FileHandle(int handle) : handle(handle) {}
};

ssize_t read(FileHandle handle, char *buf, size_t len);
</code></pre>
<p>å°±èƒ½åœ¨ç”¨æˆ·çŠ¯é©¬è™çš„æ—¶å€™ï¼Œç»™ä»–å¼¹å‡ºä¸€ä¸ªç¼–è¯‘é”™è¯¯ï¼š</p>
<pre><code class="language-cpp">read(32, buf, fd);  // ç¼–è¯‘æŠ¥é”™ï¼šæ— æ³•å°† int ç±»å‹çš„ 32 éšå¼è½¬æ¢ä¸º FileHandleï¼
</code></pre>
<p>å¯¹äºæ•´æ•°ç±»å‹ï¼Œä¹Ÿæœ‰çš„äººå–œæ¬¢ç”¨ C++11 çš„å¼ºç±»å‹æšä¸¾ï¼š</p>
<pre><code class="language-cpp">enum class FileHandle : int {};
</code></pre>
<p>è¿™æ ·ä¸€æ¥ï¼Œå¦‚æœç”¨æˆ·çœŸçš„æ˜¯æƒ³è¦è¯»å–â€œ32å·å¥æŸ„â€çš„æ–‡ä»¶ï¼Œä»–å°±å¿…é¡»æ˜¾å¼åœ°å†™å‡ºå®Œæ•´ç±»å‹æ‰èƒ½ç¼–è¯‘é€šè¿‡ï¼š</p>
<pre><code class="language-cpp">read(FileHandle(32), buf, fd);  // ç¼–è¯‘é€šè¿‡äº†
</code></pre>
<p>å¼ºè¿«ä½ å†™ä¸Šç±»å‹åï¼Œå°±ç»™äº†ä½ ä¸€æ¬¡å†æ€è€ƒçš„æœºä¼šï¼Œè®©ä½ çªç„¶æƒŠé†’ï¼š
å“¦å¤©å“ªï¼Œæˆ‘æ€ä¹ˆæŠŠç¼“å†²åŒºå¤§å°å½“æˆå¥æŸ„æ¥ä¼ é€’äº†ï¼
ä»è€Œå‡å°‘çç€çœ¼ç›è¿˜çŠ¯é”™çš„å¯èƒ½ã€‚</p>
<p>ç„¶åï¼Œä½ çš„ open å‡½æ•°ä¹Ÿè¿”å› FileHandleï¼Œæ•´ä¸ªä»£ç ä¸­å°±ä¸ç”¨å¼ºåˆ¶ç±»å‹è½¬æ¢äº†ã€‚</p>
<pre><code class="language-cpp">FileHandle fd = open(std::filesystem::path(&quot;è·¯å¾„&quot;), OpenFlag::Read);
char buf[32];
read(fd, buf, 32);
</code></pre>
<h2 id="_18">&mdash;</h2>
<hr />
<h2 id="span">span â€œèƒ–æŒ‡é’ˆâ€</h2>
<h2 id="_19">&mdash;</h2>
<hr />
<p>å‡å¦‚ä½ æ‰‹ä¸€æ»‘ï¼Œæˆ–è€…è€æ¿éœ€æ±‚æ”¹å˜ï¼ŒæŠŠ buf ç¼“å†²åŒºå°‘ç•™äº†ä¸¤ä¸ªå­—èŠ‚ï¼š</p>
<pre><code class="language-cpp">char buf[30];
read(fd, buf, 32);
</code></pre>
<p>ä½†ä½  read çš„å‚æ•°ä¾ç„¶æ˜¯ 32ï¼Œå°±äº§ç”Ÿäº†æ•°ç»„è¶Šç•Œï¼Œåˆæœªå®šä¹‰è¡Œä¸ºäº†ã€‚</p>
<p>æˆ‘ä»¬é‡‡ç”¨å°è£…ç²¾ç¥ï¼ŒæŠŠç›¸å…³çš„ buf å’Œ size å°è£…æˆä¸€ä¸ªå‚æ•°ï¼š</p>
<pre><code class="language-cpp">struct Span {
    char *data;
    size_t size;
};

ssize_t read(FileHandle fd, Span buf);
</code></pre>
<pre><code class="language-cpp">read(fd, Span{buf, 32});
</code></pre>
<p>æ³¨æ„ï¼šSpan ä¸éœ€è¦ä»¥å¼•ç”¨å½¢å¼ä¼ å…¥å‡½æ•°ï¼</p>
<pre><code class="language-cpp">void read(std::string &amp;buf);  // å¦‚æœæ˜¯ string ç±»å‹ï¼Œå‚æ•°éœ€è¦ä¸ºå¼•ç”¨ï¼Œæ‰èƒ½è®© read èƒ½å¤Ÿä¿®æ”¹ buf å­—ç¬¦ä¸²
void read(Span buf);          // Span ä¸éœ€è¦ï¼Œå› ä¸º Span å¹¶ä¸æ˜¯ç‹¬å èµ„æºçš„ç±»ï¼ŒSpan æœ¬èº«å°±æ˜¯ä¸ªè½»é‡çº§çš„å¼•ç”¨
</code></pre>
<p>vector å’Œ string è¿™ç§å…·æœ‰â€œæ‹·è´æ„é€ å‡½æ•°â€çš„ RAII å°è£…ç±»æ‰éœ€è¦ä¼ å…¥å¼•ç”¨ <code>string &amp;buf</code>ï¼Œå¦‚æœç›´æ¥ä¼ å…¥ä¼šå‘ç”Ÿæ·±æ‹·è´ï¼Œå¯¼è‡´ read å†…éƒ¨ä¿®æ”¹çš„æ˜¯ string çš„ä¸€ä»½æ‹·è´ï¼Œæ— æ³•å½±å“åˆ°å¤–ç•ŒåŸæ¥çš„ stringã€‚
å¦‚æœæ˜¯ Span å‚æ•°å°±ä¸éœ€è¦ <code>Span &amp;buf</code> å¼•ç”¨äº†ï¼ŒSpan å¹¶ä¸æ˜¯ RAII å°è£…ç±»ï¼Œå¹¶ä¸æŒæœ‰ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶æ²¡æœ‰â€œæ‹·è´æ„é€ å‡½æ•°â€ï¼Œä»–åªæ˜¯ä¸ªå¯¹å¤–éƒ¨å·²æœ‰ vectorã€stringã€æˆ– char[] çš„å¼•ç”¨ã€‚æˆ–è€…è¯´ Span æœ¬èº«å°±æ˜¯ä¸€ä¸ªå¯¹åŸç¼“å†²åŒºçš„å¼•ç”¨ï¼Œç›´æ¥ä¼ å…¥ read å†…éƒ¨ä¸€æ ·å¯ä»¥ä¿®æ”¹ä½ çš„ç¼“å†²åŒºã€‚</p>
<h2 id="_20">&mdash;</h2>
<hr />
<p>ç”¨ Span ç»“æ„ä½“è™½ç„¶çœ‹èµ·æ¥æ›´æ˜ç¡®äº†ï¼Œä½†æ˜¯ä¾ç„¶ä¸è§£å†³ç”¨æˆ·å¯èƒ½æ‰‹æ»‘å†™é”™ç¼“å†²åŒºé•¿åº¦çš„é—®é¢˜ï¼š</p>
<pre><code class="language-cpp">char buf[30];
read(fd, Span{buf, 32});
</code></pre>
<p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬åœ¨ Span é‡ŒåŠ å…¥ä¸€ä¸ªéšå¼æ„é€ å‡½æ•°ï¼š</p>
<pre><code class="language-cpp">struct Span {
    char *data;
    size_t size;

    template &lt;size_t N&gt;
    Span(char (&amp;buf)[N]) : data(buf), size(N) {}
};
</code></pre>
<p>è¿™å°†å…è®¸ char [N] éšå¼è½¬æ¢ä¸º Spanï¼Œä¸”é•¿åº¦è‡ªåŠ¨å°±æ˜¯ N çš„å€¼ã€‚</p>
<p>æ­¤å¤„å¦‚æœå†™ <code>Span(char buf[N])</code>ï¼Œä¼šè¢« C è¯­è¨€çš„æŸæ¡æ²™é›•è§„åˆ™ï¼Œå‡½æ•°ç­¾åä¼šç­‰ä»·äº <code>Span(char *buf)</code>ï¼Œä»è€Œåªèƒ½è·å–èµ·å§‹åœ°å€ï¼Œè€Œæ¨å¯¼ä¸äº†é•¿åº¦ã€‚ä½¿ç”¨æ•°ç»„å¼•ç”¨ä½œä¸ºå‚æ•° <code>Span(char (&amp;buf)[N])</code> å°±ä¸ä¼šè¢« C è¯­è¨€è‡ªåŠ¨é€€åŒ–æˆèµ·å§‹åœ°å€æŒ‡é’ˆäº†ã€‚</p>
<p>ç”¨æˆ·åªéœ€è¦ï¼š</p>
<pre><code class="language-cpp">char buf[30];
read(fd, Span{buf});
</code></pre>
<p>ç­‰ä»·äº <code>Span{buf, 30}</code>ï¼Œæ•°ç»„é•¿åº¦è‡ªåŠ¨æ¨å¯¼ï¼Œéå¸¸æ–¹ä¾¿ã€‚</p>
<p>ç”±äºæˆ‘ä»¬æ˜¯éšå¼æ„é€ å‡½æ•°ï¼Œè¿˜å¯ä»¥çœç•¥ Span ä¸å†™ï¼š</p>
<pre><code class="language-cpp">char buf[30];
read(fd, buf);  // è‡ªåŠ¨è½¬æ¢æˆ Span{buf, 30}
</code></pre>
<p>åŠ å…¥æ›´å¤šç±»å‹çš„æ”¯æŒï¼š</p>
<pre><code class="language-cpp">struct Span {
    char *data;
    size_t size;

    template &lt;size_t N&gt;
    Span(char (&amp;buf)[N]) : data(buf), size(N) {}

    template &lt;size_t N&gt;
    Span(std::array&lt;char, N&gt; &amp;arr) : data(arr.data()), size(N) {}

    Span(std::vector&lt;charN&gt; &amp;vec) : data(vec.data()), size(vec.size()) {}

    // å¦‚æœæœ‰éœ€è¦ï¼Œä¹Ÿå¯ä»¥æ˜¾å¼å†™å‡º Span(buf, 30) ä»é¦–åœ°å€å’Œé•¿åº¦æ„é€ å‡ºä¸€ä¸ª Span æ¥
    explicit Span(char *data, size_t size) : data(data), size(size) {}
};
</code></pre>
<p>ç°åœ¨ C æ•°ç»„ã€arrayã€vectorã€éƒ½å¯ä»¥éšå¼è½¬æ¢ä¸º Span äº†ï¼š</p>
<pre><code class="language-cpp">char buf1[30];
Span span1 = buf1;

std::array&lt;char, 30&gt; buf2;
Span span2 = buf2;

std::vector&lt;char&gt; buf(30);
Span span3 = buf3;

const char *str = &quot;hello&quot;;
Span span4 = Span(str, strlen(str));
</code></pre>
<p>è¿ç”¨æ¨¡æ¿å…ƒç¼–ç¨‹ï¼Œè‡ªåŠ¨æ”¯æŒä»»ä½•å…·æœ‰ data å’Œ size æˆå‘˜çš„å„ç§æ ‡å‡†åº“å®¹å™¨ï¼ŒåŒ…æ‹¬ç¬¬ä¸‰æ–¹çš„ï¼Œåªè¦ä»–æä¾› data å’Œ size å‡½æ•°ã€‚</p>
<pre><code class="language-cpp">template &lt;class Arr&gt;
concept has_data_size = requires (Arr arr) {
    { arr.data() } -&gt; std::convertible_to&lt;char *&gt;;
    { arr.size() } -&gt; std::same_as&lt;size_t&gt;;
};

struct Span {
    char *data;
    size_t size;

    template &lt;size_t N&gt;
    Span(char (&amp;buf)[N]) : data(buf), size(N) {}

    template &lt;has_data_size Arr&gt;
    Span(Arr &amp;&amp;arr) : data(arr.data()), size(arr.size()) {}
    // æ»¡è¶³ has_data_size çš„ä»»ä½•ç±»å‹éƒ½å¯ä»¥æ„é€ å‡º Span
    // è€Œæ ‡å‡†åº“çš„ vectorã€stringã€array å®¹å™¨éƒ½å«æœ‰ .data() å’Œ .size() æˆå‘˜å‡½æ•°
};
</code></pre>
<h2 id="_21">&mdash;</h2>
<hr />
<p>å¦‚æœç”¨æˆ·ç¡®å®æœ‰ä¿®æ”¹é•¿åº¦çš„éœ€è¦ï¼Œå¯ä»¥é€šè¿‡ subspan æˆå‘˜å‡½æ•°å®ç°ï¼š</p>
<pre><code class="language-cpp">char buf[32];
read(fd, Span(buf).subspan(0, 10));  // åªè¯»å–å‰ 10 ä¸ªå­—èŠ‚ï¼
</code></pre>
<p>subspan å†…éƒ¨å®ç°åŸç†ï¼š</p>
<pre><code class="language-cpp">struct Span {
    char *data;
    size_t size;

    Span subspan(size_t start, size_t length = (size_t)-1) const {
        if (start &gt; size)  // å¦‚æœèµ·å§‹ä½ç½®è¶…å‡ºèŒƒå›´ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸
            throw std::out_of_range(&quot;subspan start out of range&quot;);
        auto restSize = size - start;
        if (length &gt; restSize) // å¦‚æœé•¿åº¦è¶…è¿‡ä¸Šé™ï¼Œåˆ™è‡ªåŠ¨æˆªæ–­
            length = restSize;
        return Span(data + start, restSize + length);
    }
};
</code></pre>
<h2 id="_22">&mdash;</h2>
<hr />
<p>å¯ä»¥æŠŠ Span å˜æˆæ¨¡æ¿ç±»ï¼Œæ”¯æŒä»»æ„ç±»å‹çš„æ•°ç»„ï¼Œæ¯”å¦‚ <code>Span&lt;int&gt;</code>ã€‚</p>
<pre><code class="language-cpp">template &lt;class Arr, class T&gt;
concept has_data_size = requires (Arr arr) {
    { std::data(arr) } -&gt; std::convertible_to&lt;T *&gt;;
    { std::size(arr) } -&gt; std::same_as&lt;size_t&gt;;
    // ä½¿ç”¨ std::data è€Œä¸æ˜¯ .data() çš„å¥½å¤„ï¼š
    // std::data å¯¹äº char (&amp;buf)[N] è¿™ç§æ•°ç»„ç±»å‹ä¹Ÿæœ‰é‡è½½ï¼
    // ä¾‹å¦‚ std::size(buf) ä¼šå¾—åˆ° int buf[N] çš„æ­£ç¡®é•¿åº¦ N
    // è€Œ sizeof buf ä¼šå¾—åˆ° N * sizeof(int)
    // ç±»ä¼¼äº sizeof(buf) / sizeof(buf[0]) çš„æ•ˆæœ
    // ä¸è¿‡å¦‚æœ buf æ˜¯æ™®é€š int * æŒ‡é’ˆï¼Œä¼šé‡è½½å¤±è´¥ï¼Œç›´æ¥æŠ¥é”™ï¼Œæ²¡æœ‰å®‰å…¨éšæ‚£
};

template &lt;class T&gt;
struct Span {
    T *data;
    size_t size;

    template &lt;has_data_size&lt;T&gt; Arr&gt;
    Span(Arr &amp;&amp;arr) : data(std::data(arr)), size(std::size(arr)) {}
    // ğŸ‘† åŒæ—¶å›Šæ‹¬äº† vectorã€stringã€arrayã€åŸå§‹æ•°ç»„
};

template &lt;has_data_size Arr&gt;
Span(Arr &amp;&amp;t) -&gt; Span&lt;std::remove_pointer_t&lt;decltype(std::data(std::declval&lt;Arr &amp;&amp;&gt;()))&gt;&gt;;
</code></pre>
<h2 id="_23">&mdash;</h2>
<hr />
<p><code>Span&lt;T&gt;</code> è¡¨ç¤ºå¯è¯»å†™çš„æ•°ç»„ã€‚
å¯¹äºåªè¯»çš„æ•°ç»„ï¼Œç”¨ <code>Span&lt;const T&gt;</code> å°±å¯ä»¥ã€‚</p>
<pre><code class="language-cpp">ssize_t read(FileHandle fd, Span&lt;char&gt; buf);         // buf å¯è¯»å†™ï¼
ssize_t write(FileHandle fd, Span&lt;const char&gt; buf);  // buf åªè¯»ï¼
</code></pre>
<h2 id="_24">&mdash;</h2>
<hr />
<p>å¥½æ¶ˆæ¯ï¼è¿™ä¸œè¥¿åœ¨ C++20 å·²ç»å®è£…ï¼Œé‚£å°±æ˜¯ std::spanã€‚
æ²¡æœ‰ C++20 å¼€å‘ç¯å¢ƒçš„åŒå­¦ï¼Œä¹Ÿå¯ä»¥ç”¨ GSL åº“çš„ gsl::spanï¼Œæˆ–è€… ABSL åº“çš„ absl::Span æ¥ä½“éªŒã€‚</p>
<p>C++17 è¿˜æœ‰ä¸“é—¨é’ˆå¯¹å­—ç¬¦ä¸²çš„åŒºé—´ç±» std::string_viewï¼Œå¯ä»¥ä» std::string éšå¼æ„é€ ï¼Œç”¨æ³•ç±»ä¼¼ï¼Œä¸è¿‡åˆ‡ç‰‡å‡½æ•°æ˜¯ substrï¼Œè¿˜æ”¯æŒ findã€find_first_of ç­‰ std::string æœ‰çš„å­—ç¬¦ä¸²ä¸“å±å‡½æ•°ã€‚</p>
<ul>
<li><code>std::span&lt;T&gt;</code> - ä»»æ„ç±»å‹ T çš„å¯è¯»å¯å†™æ•°ç»„</li>
<li><code>std::span&lt;const T&gt;</code> - ä»»æ„ç±»å‹ T çš„åªè¯»æ•°ç»„</li>
<li><code>std::string_view</code> - ä»»æ„å­—ç¬¦ä¸²</li>
</ul>
<p>åœ¨ read å‡½æ•°å†…éƒ¨ï¼Œå¯ä»¥ç”¨ .data() å’Œ .size() é‡æ–°å–å‡ºç‹¬ç«‹çš„é¦–åœ°å€æŒ‡é’ˆå’Œç¼“å†²åŒºé•¿åº¦ï¼Œç”¨äºä¼ºå€™ C è¯­è¨€çš„è€å‡½æ•°ï¼š</p>
<pre><code class="language-cpp">ssize_t read(FileHandle fd, std::span&lt;char&gt; buf) {
    memset(buf.data(), 0, buf.size());  // è¯¾åä½œä¸šï¼Œç”¨æ‰€å­¦çŸ¥è¯†ï¼Œä¼˜åŒ– C è¯­è¨€çš„ memset å‡½æ•°å§ï¼
    ...
}
</code></pre>
<p>ä¹Ÿå¯ä»¥ç”¨ range-based for å¾ªç¯æ¥éå†ï¼š</p>
<pre><code class="language-cpp">ssize_t read(FileHandle fd, std::span&lt;char&gt; buf) {
    for (auto &amp; c : buf) {  // æ³¨æ„è¿™é‡Œä¸€å®šè¦ç”¨ auto &amp; å“¦ï¼å¦åˆ™æ— æ³•ä¿®æ”¹ buf å†…å®¹
        c = 'c';
        ...
    }
}
</code></pre>
<h2 id="_25">&mdash;</h2>
<hr />
<h2 id="_26">ç©ºå€¼è¯­ä¹‰</h2>
<h2 id="_27">&mdash;</h2>
<hr />
<p>æœ‰çš„å‡½æ•°ï¼Œæ¯”å¦‚åˆšæ‰çš„ fooï¼Œä¼šéœ€è¦è¡¨ç¤ºâ€œå¯èƒ½æ‰¾ä¸åˆ°è¯¥ä¹¦æœ¬â€çš„æƒ…å†µã€‚
ç²—ç³™çš„ API è®¾è®¡è€…ä¼šè¿”å›ä¸€ä¸ªæŒ‡é’ˆï¼Œç„¶ååœ¨æ–‡æ¡£é‡Œè¯´â€œè¿™ä¸ªå‡½æ•°å¯èƒ½ä¼šè¿”å› NULLï¼â€</p>
<pre><code class="language-cpp">BookInfo *foo(ISBN isbn);
</code></pre>
<p>å¦‚æœæ˜¯è¿™æ ·çš„å‡½æ•°ç­¾åï¼Œæ˜¯ä¸æ˜¯ä½ å¾ˆå®¹æ˜“å¿˜è®° foo æœ‰å¯èƒ½è¿”å› NULL è¡¨ç¤ºâ€œæ‰¾ä¸åˆ°ä¹¦æœ¬â€ï¼Ÿ</p>
<p>æ¯”å¦‚ <code>malloc</code> å‡½æ•°åœ¨åˆ†é…å¤±è´¥æ—¶ï¼Œå°±ä¼šè¿”å› NULL å¹¶è®¾ç½® errno ä¸º ENOMEMã€‚
åœ¨ <code>man malloc</code> æ–‡æ¡£ä¸­å†™çš„æ¸…æ¸…æ¥šæ¥šï¼Œä½†æ˜¯è°ä¼šè®°å¾—è¿™ä¸ªè®¾å®šï¼Ÿ
malloc å®Œéšæ‰‹å°±ç›´æ¥è®¿é—®äº†ï¼ˆç©ºæŒ‡é’ˆè§£å¼•ç”¨å±æœªå®šä¹‰è¡Œä¸ºï¼‰ã€‚</p>
<p>åœ¨ç°ä»£ C++17 ä¸­å¼•å…¥äº† optionalï¼Œä»–æ˜¯ä¸ªæ¨¡æ¿ç±»å‹ã€‚
å½¢å¦‚ <code>optional&lt;T&gt;</code> çš„ç±»å‹æœ‰ä¸¤ç§å¯èƒ½çš„çŠ¶æ€ï¼š</p>
<ol>
<li>ä¸ºç©ºï¼ˆnulloptï¼‰</li>
<li>æœ‰å€¼ï¼ˆTï¼‰</li>
</ol>
<p>å¦‚æœä¸€ä¸ªå‡½æ•°å¯èƒ½æˆåŠŸè¿”å› Tï¼Œä¹Ÿå¯èƒ½å¤±è´¥ï¼Œé‚£å°±å¯ä»¥è®©ä»–è¿”å› <code>optional&lt;T&gt;</code>ï¼Œç”¨ nullopt æ¥è¡¨ç¤ºå¤±è´¥ã€‚</p>
<pre><code class="language-cpp">std::optional&lt;BookInfo&gt; foo(ISBN isbn) {
    if (æ‰¾åˆ°äº†) {
        return BookInfo(...);
    } else {
        return std::nullopt;
    }
}
</code></pre>
<p>nullopt å’ŒæŒ‡é’ˆçš„ nullptr ç±»ä¼¼ï¼Œä½† optional çš„ç”¨é€”æ›´åŠ å•ä¸€ï¼Œæ›´å…·è¯´æ˜æ€§ã€‚
å¦‚æœä½ è¿”å›ä¸ªæŒ‡é’ˆäººå®¶ä¸ä¸€å®šçŸ¥é“ä½ çš„æ„æ€æ˜¯å¯èƒ½è¿”å› nullptrï¼Œå¯èƒ½è¿˜ä»¥ä¸ºä½ æ˜¯ä¸ºäº†è¿”å›ä¸ª new å‡ºæ¥çš„æ•°ç»„ï¼Œè¯­ä¹‰ä¸æ˜ç¡®ã€‚</p>
<p>è°ƒç”¨çš„åœ°æ–¹è¿™æ ·å†™ï¼š</p>
<pre><code class="language-cpp">auto book = foo(isbn);
if (book.has_value()) {  // book.has_vlaue() ä¸º trueï¼Œåˆ™è¡¨ç¤ºæœ‰å€¼
    BookInfo realBook = book.value();
    print(&quot;æ‰¾åˆ°äº†:&quot;, realBook);
} else {
    print(&quot;æ‰¾ä¸åˆ°è¿™æœ¬ä¹¦&quot;);
}
</code></pre>
<p>optional ç±»å‹å¯ä»¥åœ¨ if æ¡ä»¶ä¸­è‡ªåŠ¨è½¬æ¢ä¸º boolï¼Œåˆ¤æ–­æ˜¯å¦æœ‰å€¼ï¼Œç­‰ä»·äº <code>.has_value()</code>ï¼š</p>
<pre><code class="language-cpp">auto book = foo(isbn);
if (book) {  // (bool)book ä¸º trueï¼Œåˆ™è¡¨ç¤ºæœ‰å€¼
    BookInfo realBook = book.value();
    print(&quot;æ‰¾åˆ°äº†:&quot;, realBook);
} else {
    print(&quot;æ‰¾ä¸åˆ°è¿™æœ¬ä¹¦&quot;);
}
</code></pre>
<p>å¯ä»¥é€šè¿‡ * è¿ç®—ç¬¦è¯»å–å…¶ä¸­çš„å€¼ï¼Œç­‰ä»·äº <code>.value()</code>ï¼‰ï¼š</p>
<pre><code class="language-cpp">auto book = foo(isbn);
if (book) {
    BookInfo realBook = *book;
    print(&quot;æ‰¾åˆ°äº†:&quot;, realBook);
} else {
    print(&quot;æ‰¾ä¸åˆ°è¿™æœ¬ä¹¦&quot;);
}
</code></pre>
<p>è¿ç”¨ C++17 çš„å°±åœ° if è¯­æ³•ï¼š</p>
<pre><code class="language-cpp">if (auto book = foo(isbn); book.has_value()) {
    BookInfo realBook = *book;
    print(&quot;æ‰¾åˆ°äº†:&quot;, realBook);
} else {
    print(&quot;æ‰¾ä¸åˆ°è¿™æœ¬ä¹¦&quot;);
}
</code></pre>
<p>ç”±äº auto å‡ºæ¥çš„ optional å˜é‡å¯ä»¥è½¬æ¢ä¸º boolï¼Œåˆ†å·åé¢çš„æ¡ä»¶å¯ä»¥çœç•¥ï¼š</p>
<pre><code class="language-cpp">if (auto book = foo(isbn)) {
    print(&quot;æ‰¾åˆ°äº†:&quot;, *book);
} else {
    print(&quot;æ‰¾ä¸åˆ°è¿™æœ¬ä¹¦&quot;);
}
</code></pre>
<p>optional ä¹Ÿæ”¯æŒ <code>-&gt;</code> è¿ç®—ç¬¦è®¿é—®æˆå‘˜ï¼š</p>
<pre><code class="language-cpp">if (auto book = foo(isbn)) {
    print(&quot;æ‰¾åˆ°äº†:&quot;, book-&gt;name);
    book-&gt;readOnline();
}
</code></pre>
<p>optional çš„ <code>.value()</code>ï¼Œå¦‚æœæ²¡æœ‰å€¼ï¼Œä¼šæŠ›å‡º <code>std::bad_optional_access</code> å¼‚å¸¸ã€‚
ç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥ä¾¿æ·åœ°æŠŠâ€œæ‰¾ä¸åˆ°ä¹¦æœ¬â€è½¬æ¢ä¸ºå¼‚å¸¸æŠ›å‡ºç»™ä¸Šæ¸¸è°ƒç”¨è€…ï¼Œè€Œä¸ç”¨æˆå †çš„ if åˆ¤æ–­å’Œè¿”å›ã€‚</p>
<pre><code class="language-cpp">BookInfo book = foo(isbn).value();
</code></pre>
<p>ä¹Ÿå¯ä»¥é€šè¿‡ <code>.value_or(é»˜è®¤å€¼)</code> æŒ‡å®šâ€œæ‰¾ä¸åˆ°ä¹¦æœ¬â€æ—¶çš„é»˜è®¤å€¼ï¼š</p>
<pre><code class="language-cpp">BookInfo defaultBook;
BookInfo book = foo(isbn).value_or(defaultBook);
</code></pre>
<h2 id="_28">&mdash;</h2>
<hr />
<p>ä½ æ¥æ‰‹äº†ä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ•´æ•°ï¼ˆå¯èƒ½è½¬æ¢å¤±è´¥ï¼‰çš„å‡½æ•° APIï¼š</p>
<pre><code class="language-cpp">// æ–‡æ¡£ï¼šå¦‚æœå­—ç¬¦ä¸²è§£æå¤±è´¥ï¼Œä¼šè¿”å› -1 å¹¶è®¾ç½® errno ä¸º EINVALï¼è®°å¾—æ£€æŸ¥ï¼è‹¥ä½ å¿˜è®°æ£€æŸ¥åæœè‡ªè´Ÿï¼
// å½“æŒ‡å®š n ä¸º 0 æ—¶ï¼Œstr ä¸º C è¯­è¨€ç»å…¸æ¬¾ 0 ç»“å°¾å­—ç¬¦ä¸²ã€‚
// å½“æŒ‡å®š n ä¸ä¸º 0 æ—¶ï¼Œstr çš„é•¿åº¦å›ºå®šä¸º nï¼Œç”¨äºç…§é¡¾å‚æ•°å¯èƒ½ä¸ä¸º 0 ç»“å°¾å­—ç¬¦ä¸²çš„æƒ…å†µã€‚
int parseInt(const char *str, size_t n);
</code></pre>
<p>é‚£ä¹ˆæˆ‘å¦‚æœæ£€æµ‹åˆ° -1ï¼Œé¬¼çŸ¥é“æ˜¯å­—ç¬¦ä¸²é‡Œçš„æ•°å­—å°±æ˜¯ -1ï¼Œè¿˜æ˜¯å› ä¸ºå‡ºé”™æ‰è¿”å› -1ï¼Ÿè¿˜è¦æˆ‘å»æ£€æŸ¥ errnoï¼Œä¸‡ä¸€ä¸Šä¸€ä¸ªå‡½æ•°å‡ºé”™ç•™ä¸‹çš„ EINVAL å‘¢ï¼Ÿä¸‡ä¸€æˆ‘å¿˜è®°æ£€æŸ¥å‘¢ï¼Ÿ</p>
<p>è¿ç”¨æœ¬æœŸè¯¾ç¨‹æ‰€å­¦çŸ¥è¯†ä¼˜åŒ–ï¼š</p>
<pre><code class="language-cpp">std::optional&lt;int&gt; parseInt(std::string_view str);
</code></pre>
<p>æ˜¯ä¸æ˜¯åŠŸèƒ½ï¼Œè¿”å›å€¼ï¼Œå¯èƒ½å­˜åœ¨çš„é”™è¯¯æƒ…å†µï¼Œä¸€ç›®äº†ç„¶äº†ï¼Ÿæ ¹æœ¬ä¸éœ€è¦ä»€ä¹ˆéš¾æ‡‚çš„æ³¨é‡Šï¼Œæ–‡æ¡£ã€‚</p>
<p>å¦‚æœè°ƒç”¨è€…æƒ³å‡å®šå­—ç¬¦ä¸²è§£æä¸ä¼šå‡ºé”™ï¼š</p>
<pre><code class="language-cpp">parseInt(&quot;233&quot;).value();
</code></pre>
<p>å¦‚æœè°ƒç”¨è€…æƒ³å½“å‡ºé”™æ—¶é»˜è®¤è¿”å› 0ï¼š</p>
<pre><code class="language-cpp">parseInt(&quot;233&quot;).value_or(0);
</code></pre>
<p>parseInt å†…éƒ¨å®ç°å¯èƒ½å¦‚ä¸‹ï¼š</p>
<pre><code class="language-cpp">std::optional&lt;int&gt; parseInt(std::string_view sv) {
    int value;
    auto result = std::from_chars(str.data(), str.data() + str.size(), std::ref(value));
    if (result.ec == std::errc())
        return value;
    else
        return std::nullopt;
}
</code></pre>
<h2 id="_29">&mdash;</h2>
<hr />
<p>è°ƒç”¨è€…çš„å‚æ•°ä¸è®ºæ˜¯ string è¿˜æ˜¯ C è¯­è¨€é£æ ¼çš„ const char *ï¼Œéƒ½èƒ½éšå¼è½¬æ¢ä¸ºé€šç”¨çš„ string_viewã€‚</p>
<pre><code class="language-cpp">parseInt(&quot;-1&quot;);

string s;
cin &gt;&gt; s;
parseInt(s);

char perfGeek[2] = {'-', '1'};
parseInt(std::string_view{perfGeek, 2});
</code></pre>
<p>ç¬‘ç‚¹è§£æï¼šä¸Šé¢çš„ä»£ç æœ‰ä¸€å¤„é”™è¯¯ï¼Œä½ èƒ½å‘è§‰å—ï¼Ÿ</p>
<h2 id="_30">&mdash;</h2>
<hr />
<pre><code class="language-cpp">cin &gt;&gt; s;
</code></pre>
<p><code>cin &gt;&gt;</code> å¯èƒ½ä¼šå¤±è´¥ï¼æ²¡ æƒ³ åˆ° å§</p>
<p>è¦æ˜¯ int ç­‰ POD ç±»å‹ï¼Œå¦‚æœä¸æ£€æµ‹ï¼Œä¼šå‡ºç°æœªåˆå§‹åŒ–çš„ int å€¼ï¼Œäº§ç”Ÿæœªå®šä¹‰è¡Œä¸ºï¼</p>
<pre><code class="language-cpp">int i;
cin &gt;&gt; i;
return i;  // å¦‚æœç”¨æˆ·çš„è¾“å…¥å€¼ä¸æ˜¯åˆæ³•çš„æ•´æ•°ï¼Œè¿™é‡Œä¼šäº§ç”Ÿå…¸ä¸­å…¸ä¹‹å†…å­˜ä¸­çš„éšæœºæ•°çƒ«çƒ«çƒ«çƒ¤é¦„é¥¨ï¼
</code></pre>
<p>å®˜æ–¹æ¨èçš„åšæ³•æ˜¯æ¯æ¬¡éƒ½è¦æ£€æµ‹æ˜¯å¦å¤±è´¥ï¼</p>
<pre><code class="language-cpp">int i;
if (!(cin &gt;&gt; i)) {
    throw std::runtime_error(&quot;è¯»å…¥ int å˜é‡å¤±è´¥ï¼&quot;);
}
return i;
</code></pre>
<p>ä½†æ˜¯è°è®°å¾—ä½ï¼Ÿæ‰€ä»¥ä»ä¸€å¼€å§‹å°±ä¸è¦è®¾è®¡è¿™ç§ç³Ÿç³•çš„ APIã€‚
ç‰¹åˆ«æ˜¯ <code>cin &gt;&gt;</code> è¿™ç§é€šè¿‡å¼•ç”¨è¿”å› iï¼Œå´è¦äººè®°å¾—åˆ¤æ–­è¿”å› bool è¡¨ç¤ºæˆè´¥ï¼Œå¿˜è®°åˆ¤æ–­è¿˜ä¼šç»™ä½ ç•™ç€æœªåˆå§‹åŒ–çš„ç…ç¬”è®¾è®¡ã€‚
å¦‚æœè®©æˆ‘æ¥è®¾è®¡ cin çš„è¯ï¼š</p>
<pre><code class="language-cpp">std::optional&lt;int&gt; readInt();

int i = cin.readInt().value();
</code></pre>
<p>è¿™æ ·å¦‚æœç”¨æˆ·è¦è¯»å–åˆ°å€¼çš„è¯ï¼Œå¿…ç„¶è¦ <code>.value()</code>ï¼Œä»è€Œå¦‚æœ readInt å¤±è´¥è¿”å›çš„æ˜¯ nulloptï¼Œå°±å¿…ç„¶æŠ›å‡ºå¼‚å¸¸ï¼Œé¿å…äº†ç”¨æˆ·å¿˜è®°åˆ¤æ–­é”™è¯¯çš„å¯èƒ½ã€‚</p>
<blockquote>
<p>åœ¨å°å½­è€å¸ˆè‡ªä¸»ç ”å‘çš„ä¸€æ¬¾ co_async åç¨‹åº“ä¸­ï¼Œé‡æ–°è®¾è®¡äº†å¼‚æ­¥çš„å­—ç¬¦æµï¼Œä¾‹å¦‚å…¶ä¸­ getline å‡½æ•°ä¼šè¿”å› <code>std::expected&lt;std::string, std::system_error&gt;</code>ã€‚</p>
</blockquote>
<h2 id="_31">&mdash;</h2>
<hr />
<pre><code class="language-cpp">BookInfo * foo(ISBN isbn);
</code></pre>
<p>è¿™æ˜¯ä¸ªè¿”å›æ™ºèƒ½æŒ‡é’ˆçš„å‡½æ•°ï¼Œå•ä»å‡½æ•°å£°æ˜æ¥çœ‹ï¼Œä½ èƒ½å¦çŸ¥é“ä»–æœ‰æ²¡æœ‰å¯èƒ½è¿”å›ç©ºæŒ‡é’ˆï¼Ÿä¸ç¡®å®šã€‚</p>
<pre><code class="language-cpp">std::optional&lt;BookInfo *&gt; foo(ISBN isbn);
</code></pre>
<p>ç°åœ¨æ˜¯ä¸æ˜¯å¾ˆæ˜ç¡®äº†ï¼Œå¦‚æœè¿”å›çš„æ˜¯ nulloptï¼Œåˆ™è¡¨ç¤ºç©ºï¼Œç„¶å optional å†…éƒ¨çš„ BookInfo *ï¼Œå¤§æ¦‚æ˜¯ä¸ä¼šä¸º NULL çš„ï¼Ÿ</p>
<pre><code class="language-cpp">std::optional&lt;gsl::not_null&lt;BookInfo *&gt;&gt; foo(ISBN isbn);
</code></pre>
<p>è¿™ä¸‹æ›´æ˜ç¡®äº†ï¼Œå¦‚æœè¿”å›çš„æ˜¯ nulloptï¼Œåˆ™è¡¨ç¤ºç©ºï¼Œç„¶å optional å†…éƒ¨çš„ BookInfo * å› ä¸ºå¥—äº†ä¸€å±‚ gsl::not_nullï¼Œå¿…å®šä¸èƒ½ä¸º NULLï¼ˆå¦åˆ™ä¼šè¢« gsl::not_null çš„æ–­è¨€æ£€æµ‹åˆ°ï¼‰ï¼Œå‡½æ•°çš„ä½œè€…æ˜¯ç»å¯¹ä¸ä¼šæ•…æ„è¿”å›ä¸ª NULL çš„ã€‚
å¦‚æœå¤±è´¥ï¼Œä¼šè¿”å› nulloptï¼Œè€Œä¸æ˜¯æ„ä¹‰ä¸æ˜è¿˜å®¹æ˜“å¿˜è®°çš„ç©ºæŒ‡é’ˆã€‚</p>
<h2 id="_32">&mdash;</h2>
<p>è¿˜æ˜¯ä¸å»ºè®®ç›´æ¥ç”¨åŸå§‹æŒ‡é’ˆï¼Œå»ºè®®ç”¨æ™ºèƒ½æŒ‡é’ˆæˆ–å¼•ç”¨ã€‚</p>
<pre><code class="language-cpp">std::optional&lt;gsl::not_null&lt;std::unique_ptr&lt;BookInfo&gt;&gt;&gt; foo(ISBN isbn);
</code></pre>
<p>è¿™ä¸ªå‡½æ•°å¯èƒ½è¿”å› nullopt è¡¨ç¤ºå¤±è´¥ï¼ŒæˆåŠŸåˆ™è¿”å›ä¸€ä¸ªäº«æœ‰æ‰€æœ‰æƒçš„ç‹¬å æŒ‡é’ˆï¼ŒæŒ‡å‘å•ä¸ªå¯¹è±¡ã€‚</p>
<p>å°å½­è€å¸ˆï¼Œæˆ‘ <code>optional&lt;BookInfo &amp;&gt;</code> å‡ºé”™äº†æ€ä¹ˆåŠï¼Ÿ</p>
<pre><code class="language-cpp">std::optional&lt;std::reference_wrapper&lt;BookInfo&gt;&gt; foo(ISBN isbn);
</code></pre>
<p>è¿™ä¸ªå‡½æ•°å¯èƒ½è¿”å› nullopt è¡¨ç¤ºå¤±è´¥ï¼ŒæˆåŠŸåˆ™è¿”å›ä¸€ä¸ªä¸äº«æœ‰æ‰€æœ‰æƒçš„å¼•ç”¨ï¼ŒæŒ‡å‘å•ä¸ªå¯¹è±¡ã€‚</p>
<p>reference_wrapper æ˜¯å¯¹å¼•ç”¨çš„åŒ…è£…ï¼Œå¯éšå¼è½¬æ¢ä¸ºå¼•ç”¨ï¼š</p>
<pre><code class="language-cpp">int i;
std::reference_wrapper&lt;int&gt; ref = i;
int &amp;r = ref; // r æŒ‡å‘ i
</code></pre>
<p>ä½¿å¼•ç”¨å¯ä»¥å­˜åˆ°å„ç§å®¹å™¨é‡Œï¼š
ä¸”é‡åˆ° auto ä¸ä¼šè‡ªåŠ¨é€€åŒ–ï¼ˆdecayï¼‰ï¼š</p>
<pre><code class="language-cpp">int i;
std::reference_wrapper&lt;int&gt; ref = i;
auto ref2 = ref;  // ref2 æ¨å¯¼ä¸º std::reference_wrapper&lt;int&gt;
int &amp;r = i;
auto r2 = r;  // r2 æ¨å¯¼ä¸º int
</code></pre>
<p>ä¸”æ°¸è¿œä¸ä¼šä¸º NULLï¼š</p>
<pre><code class="language-cpp">std::reference_wrapper&lt;int&gt; ref; // ç¼–è¯‘é”™è¯¯ï¼šå¼•ç”¨å¿…é¡»åˆå§‹åŒ–ï¼Œreference_wrapper å½“ç„¶ä¹Ÿå¿…é¡»åˆå§‹åŒ–
</code></pre>
<p>ä¹Ÿå¯ä»¥é€šè¿‡ <code>*</code> æˆ– <code>-&gt;</code> è§£å¼•ç”¨ï¼š</p>
<pre><code class="language-cpp">BookInfo book;
std::reference_wrapper&lt;int&gt; refBook = book;
refBook-&gt;readOnline();
BookInfo deepCopyBook = *refBook;
</code></pre>
<h2 id="_33">&mdash;</h2>
<hr />
<p>æ³¨æ„ <code>.value()</code> å’Œ <code>*</code> æ˜¯æœ‰åŒºåˆ«çš„ï¼Œ<code>*</code> ä¸ä¼šæ£€æµ‹æ˜¯å¦ä¸ºç©ºï¼Œä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä½†æ›´é«˜æ•ˆã€‚</p>
<pre><code class="language-cpp">o.value(); // å¦‚æœ o é‡Œæ²¡æœ‰å€¼ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸
*o;  // å¦‚æœ o é‡Œæ²¡æœ‰å€¼ï¼Œä¼šäº§ç”Ÿæœªå®šä¹‰è¡Œä¸ºï¼
o-&gt;readOnline();  // å¦‚æœ o é‡Œæ²¡æœ‰å€¼ï¼Œä¼šäº§ç”Ÿæœªå®šä¹‰è¡Œä¸ºï¼
</code></pre>
<p>å› æ­¤ä¸€èˆ¬ä¼šåœ¨åˆ¤æ–­äº† optional ä¸ä¸ºç©ºä»¥åæ‰ä¼šå»è®¿é—® <code>*</code> å’Œ <code>-&gt;</code>ã€‚è€Œ <code>.value()</code> å¯ä»¥ç›´æ¥è®¿é—®ã€‚</p>
<pre><code class="language-cpp">print(foo().value()); // .value() å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¸ç”¨åˆ¤æ–­
if (auto o = foo()) {
    // åˆ¤æ–­è¿‡ç¡®è®¤ä¸ä¸ºç©ºäº†ï¼Œæ‰èƒ½è®¿é—® *o
    // åœ¨å·²ç»åˆ¤æ–­è¿‡ä¸ä¸ºç©ºçš„ if åˆ†æ”¯ä¸­ï¼Œç”¨ * æ¯” .value() æ›´é«˜æ•ˆ
    print(*o);
}
</code></pre>
<p>å…±äº«æ‰€æœ‰æƒ
* n - shared_ptr<T[]>
* 1 - shared_ptr<T></p>
<p>ç‹¬å æ‰€æœ‰æƒ
* n - vector<T>, unique_ptr<T[]>
* 1 - unique_ptr<T></p>
<p>æ²¡æ‰€æœ‰æƒ
* n - span<T>
* 1 - reference_wrapper<T>, T &amp;</p>
<h2 id="_34">&mdash;</h2>
<hr />
<p>æ¥ä¸‹æ¥ä»‹ç» optional çš„ä¸€äº›è¿›é˜¶ç”¨æ³•ã€‚</p>
<pre><code class="language-cpp">std::optional&lt;BookInfo&gt; o = BookInfo(1, 2, 3);  // åˆå§‹åŒ–ä¸º BookInfo å€¼
std::optional&lt;BookInfo&gt; o;  // ä¸å†™æ—¶é»˜è®¤åˆå§‹åŒ–ä¸ºç©ºï¼Œç­‰ä»·äº o = std::nullopt
o.emplace(1, 2, 3);  // å°±åœ°æ„é€ ï¼Œç­‰ä»·äº o = BookInfo(1, 2, 3); ä½†ä¸éœ€è¦ç§»åŠ¨ BookInfo äº†
o.reset();  // å°±åœ°é”€æ¯ï¼Œç­‰ä»·äº o = std::nullopt;
</code></pre>
<h2 id="_35">&mdash;</h2>
<hr />
<p>å½“ä¸ä¸ºç©ºæ—¶å°†å…¶ä¸­çš„ int å€¼åŠ  1ï¼Œå¦åˆ™ä¿æŒä¸ºç©ºä¸å˜ï¼Œæ€ä¹ˆå†™ï¼Ÿ</p>
<pre><code class="language-cpp">std::optional&lt;int&gt; o = cin.readInt();
if (o) {
    o = *o + 1;
}
</code></pre>
<p>è¿ç”¨ C++23 å¼•å…¥çš„æ–°å‡½æ•° transformï¼š</p>
<pre><code class="language-cpp">std::optional&lt;int&gt; o = cin.readInt();
o = o.transform([] (int n) { return n + 1; });
</code></pre>
<h2 id="_36">&mdash;</h2>
<hr />
<p>å½“ä¸ä¸ºç©ºæ—¶å°†å…¶ä¸­çš„ string å€¼è§£æä¸º intï¼Œå¦åˆ™ä¿æŒä¸ºç©ºä¸å˜ã€‚ä¸”è§£æå‡½æ•°å¯èƒ½å¤±è´¥ï¼Œå¤±è´¥åˆ™ä¹Ÿè¦å°† optional ç½®ä¸ºç©ºï¼Œæ€ä¹ˆå†™ï¼Ÿ</p>
<pre><code class="language-cpp">std::optional&lt;string&gt; o = cin.readLine();
std::optional&lt;int&gt; o2;
if (o) {
    o2 = parseInt(*o);
}

std::optional&lt;int&gt; parseInt(std::string_view sv) { ... }
</code></pre>
<p>è¿ç”¨ C++23 å¼•å…¥çš„æ–°å‡½æ•° and_thenï¼š</p>
<pre><code class="language-cpp">auto o = cin.readLine().and_then(parseInt);
</code></pre>
<h2 id="_37">&mdash;</h2>
<hr />
<p>å½“æ‰¾ä¸åˆ°æŒ‡å®šä¹¦ç±æ—¶ï¼Œè¿”å›ä¸€æœ¬é»˜è®¤ä¹¦ç±ä½œä¸ºæ›¿ä»£ï¼š</p>
<pre><code class="language-cpp">auto o = findBook(isbn).value_or(getDefaultBook());
</code></pre>
<p>ç¼ºç‚¹ï¼šç”±äº value_or çš„å‚æ•°ä¼šæå‰è¢«æ±‚å€¼ï¼Œå³ä½¿ findBook æˆåŠŸæ‰¾åˆ°äº†ä¹¦ç±ï¼Œä¹Ÿä¼šæ‰§è¡Œ getDefaultBook å‡½æ•°ï¼Œç„¶åå°†å…¶ä½œä¸ºæ­»äº¡å³å€¼ä¸¢å¼ƒã€‚å¦‚æœåˆ›å»ºé»˜è®¤ä¹¦ç±çš„è¿‡ç¨‹å¾ˆæ…¢ï¼Œé‚£ä¹ˆå°±éå¸¸ä½æ•ˆã€‚</p>
<p>ä¸ºæ­¤ï¼ŒC++23 å¼•å…¥äº† or_else å‡½æ•°ã€‚
åªæœ‰ findBook æ‰¾ä¸åˆ°æ—¶æ‰ä¼šæ‰§è¡Œ lambda ä¸­çš„å‡½æ•°ä½“ï¼š</p>
<pre><code class="language-cpp">auto o = findBook(isbn).or_else([] -&gt; std::optional&lt;BookInfo&gt; {
    cout &lt;&lt; &quot;findBook å‡ºé”™äº†ï¼Œç°åœ¨å¼€å§‹åˆ›å»ºé»˜è®¤ä¹¦ç±ï¼Œéå¸¸æ…¢\n&quot;;
    return getDefaultBook();
});
</code></pre>
<h2 id="_38">&mdash;</h2>
<hr />
<p>æ­¤ç±»å‡½æ•°éƒ½å¯ä»¥åå¤åµŒå¥—ï¼š</p>
<pre><code class="language-cpp">int i = cin.readLine()
    .or_else(getDefaultLine)
    .and_then(parseInt)
    .transform([] (auto i) { return i * 2; })
    .value_or(0);
</code></pre>
<p>åŠ å…¥å‡½æ•°å¼ç¥æ•™å§ï¼Œå‡½é—¨ï¼</p>
<h2 id="_39">&mdash;</h2>
<hr />
<h2 id="stl">ç‚¹åæ‰¹è¯„çš„ STL è®¾è®¡</h2>
<h2 id="_40">&mdash;</h2>
<hr />
<p>ä¾‹å¦‚ std::stack çš„è®¾è®¡å°±éå¸¸å¤±è´¥ï¼š</p>
<pre><code class="language-cpp">if (!stack.empty()) {
    auto val = std::move(stack.top());
    stack.pop();
}
</code></pre>
<p>æˆ‘ä»¬å¿…é¡»åˆ¤æ–­ stack ä¸ä¸ºç©ºï¼Œæ‰èƒ½å¼¹å‡ºæ ˆé¡¶å…ƒç´ ã€‚å¯¹ç€ä¸€ä¸ªç©ºçš„æ ˆ pop æ˜¯æœªå®šä¹‰è¡Œä¸ºã€‚
è€Œ pop() åˆæ˜¯ä¸€ä¸ªè¿”å› void çš„å‡½æ•°ï¼Œä»–åªæ˜¯åˆ é™¤æ ˆé¡¶å…ƒç´ ï¼Œå¹¶ä¸ä¼šè¿”å›å…ƒç´ ã€‚
æˆ‘ä»¬å¿…é¡»å…ˆè°ƒç”¨ top() æŠŠæ ˆé¡¶å–å‡ºæ¥ï¼Œç„¶åæ‰èƒ½ popï¼</p>
<p>æ˜æ˜æ˜¯åŒä¸€ä¸ªæ“ä½œï¼Œå´è¦æ‹†æˆä¸‰ä¸ªå‡½æ•°æ¥å®Œæˆï¼Œå¾ˆçƒ‚ã€‚å¦‚æœä½ ä¸æ…æŠŠåˆ¤æ–­æ¡ä»¶å†™åï¼š</p>
<pre><code class="language-cpp">if (stack.empty()) {
    auto val = std::move(stack.top());
    stack.pop();
}
</code></pre>
<p>å°±ä¸€ä¸ª Segmentation Fault è¹¦ä½ è„¸ä¸Šï¼Œä½ æ‰¾åŠå¤©éƒ½æ‰¾ä¸åˆ°è‡ªå·±å“ªé”™äº†ï¼</p>
<p>å°å½­è€å¸ˆé‡æ–°è®¾è®¡ï¼Œæ•´åˆæˆä¸€ä¸ªå‡½æ•°ï¼š</p>
<pre><code class="language-cpp">std::optional&lt;int&gt; pop();
</code></pre>
<p>è¯­ä¹‰æ˜ç¡®ï¼Œç”¨èµ·æ¥ä¹Ÿæ–¹ä¾¿ï¼Œç”¨æˆ·ä¸å®¹æ˜“çŠ¯é”™ã€‚</p>
<pre><code class="language-cpp">if (auto val = stack.pop()) {
    ...
}
</code></pre>
<p>æŠŠå¤šä¸ªæœ¬å°±å±äºåŒä¸€ä»¶äº‹çš„å‡½æ•°ï¼Œæ•´åˆæˆä¸€ä¸ªï¼Œé¿å…ç”¨æˆ·ä¸­é—´å‡ºçº°æ¼ã€‚
ä»å‚æ•°å’Œè¿”å›å€¼çš„ç±»å‹ä¸Šï¼Œé™å®šè‡ªç”±åº¦ï¼Œå‡è½»ç”¨æˆ·æ€è€ƒè´Ÿæ‹…ã€‚</p>
<h2 id="_41">&mdash;</h2>
<hr />
<p>ä¼—æ‰€å‘¨çŸ¥ï¼Œvector æœ‰ä¸¤ä¸ªå‡½æ•°ç”¨äºè®¿é—®æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚</p>
<pre><code class="language-cpp">int &amp;operator[](size_t index);
int &amp;at(size_t index);

vec[3];  // å¦‚æœ vec çš„å¤§å°ä¸è¶³ 3ï¼Œä¼šå‘ç”Ÿæ•°ç»„è¶Šç•Œï¼è¿™æ˜¯æœªå®šä¹‰è¡Œä¸º
vec.at(3);  // å¦‚æœ vec çš„å¤§å°ä¸è¶³ 3ï¼Œä¼šæŠ›å‡º out_of_range å¼‚å¸¸
</code></pre>
<p>ç”¨æˆ·é€šå¸¸ä¼šæ ¹æ®è‡ªå·±çš„éœ€è¦ï¼Œå¦‚æœä»–ä»¬éå¸¸è‡ªä¿¡è‡ªå·±çš„ç´¢å¼•ä¸ä¼šè¶Šç•Œï¼Œå¯ä»¥ç”¨é«˜æ•ˆçš„ []ï¼Œä¸åšæ£€æµ‹ã€‚
å¦‚æœä¸ç¡®å®šï¼Œå¯ä»¥ç”¨æ›´å®‰å…¨çš„ at()ï¼Œä¸€æ—¦è¶Šç•Œè‡ªåŠ¨æŠ›å‡ºå¼‚å¸¸ï¼Œæ–¹ä¾¿è°ƒè¯•ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é‡æ–°è®¾è®¡ä¸€ä¸ª .get() å‡½æ•°ï¼š</p>
<pre><code class="language-cpp">std::optional&lt;int&gt; get(size_t index);
</code></pre>
<p>å½“æ£€æµ‹åˆ°æ•°ç»„è¶Šç•Œæ—¶ï¼Œè¿”å› nulloptã€‚</p>
<pre><code class="language-cpp">*vec.get(3);             // å¦‚æœç”¨æˆ·è¿½æ±‚æ€§èƒ½ï¼Œå¯ä»¥æŠŠæ•°ç»„è¶Šç•Œè½¬åŒ–ä¸ºæœªå®šä¹‰è¡Œä¸ºï¼Œä»è€Œè®©ç¼–è¯‘å™¨è‡ªåŠ¨ä¼˜åŒ–æ‰è¶Šç•Œçš„è·¯å¾„
vec.get(3).value();      // å¦‚æœç”¨æˆ·è¿½æ±‚å®‰å…¨ï¼Œå¯ä»¥æŠŠæ•°ç»„è¶Šç•Œè½¬åŒ–ä¸ºä¸€ä¸ªå¼‚å¸¸
vec.get(3).value_or(0);  // å¦‚æœç”¨æˆ·æƒ³è¦åœ¨è¶Šç•Œæ—¶è·å¾—é»˜è®¤å€¼ 0
</code></pre>
<p>è¿™æ ·å°±åªéœ€è¦ä¸€ä¸ªå‡½æ•°ï¼Œä¸è®ºç”¨æˆ·æƒ³è¦çš„æ˜¯ä»€ä¹ˆï¼Œéƒ½åªéœ€è¦è¿™ä¸€ä¸ªç»Ÿä¸€çš„ get() å‡½æ•°ã€‚</p>
<h2 id="_42">&mdash;</h2>
<hr />
<p>å°å½­è€å¸ˆï¼Œä½ è¿™ä¸ªåªèƒ½ getï¼Œè¦å¦‚ä½• set å‘€ï¼Ÿ</p>
<pre><code class="language-cpp">std::optional&lt;int&gt; get(size_t index);
bool set(size_t index, int value);  // å¦‚æœè¶Šç•Œï¼Œè¿”å› false
</code></pre>
<ul>
<li>ç¼ºç‚¹1ï¼šè¿”å› bool æ— æ³•è¿ç”¨ optional çš„å°æŠ€å·§ï¼šé€šè¿‡ value() è½¬åŒ–ä¸ºå¼‚å¸¸ï¼Œä¸”ç”¨æˆ·å®¹æ˜“å¿˜è®°æ£€æŸ¥è¿”å›å€¼ã€‚</li>
<li>ç¼ºç‚¹2ï¼šä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ size_t ä¸€ä¸ªæ˜¯ intï¼Œè¿˜æ˜¯å¾ˆå®¹æ˜“é¡ºåºææ··ã€‚</li>
</ul>
<pre><code class="language-cpp">std::optional&lt;std::reference_wrapper&lt;int&gt;&gt; get(size_t index);

auto x = **vec.get(3);         // æ€§èƒ½è¯»
auto x = *vec.get(3).value();  // å®‰å…¨è¯»
*vec.get(3) = 42;              // æ€§èƒ½å†™
vec.get(3).value() = 42;       // å®‰å…¨å†™
</code></pre>
<h2 id="_43">&mdash;</h2>
<hr />
<h2 id="stl_1">ç‚¹åè¡¨æ‰¬çš„ STL éƒ¨åˆ†</h2>
<h2 id="_44">&mdash;</h2>
<hr />
<pre><code class="language-cpp">void Sleep(int delay);
</code></pre>
<p>è°çŸ¥é“è¿™ä¸ª delay çš„å•ä½æ˜¯ä»€ä¹ˆï¼Ÿç§’ï¼Ÿæ¯«ç§’ï¼Ÿ</p>
<pre><code class="language-cpp">void Sleep(int ms);
</code></pre>
<p>å¥½å§ï¼Œæ˜¯æ¯«ç§’ã€‚å¯æ˜¯é™¤éçœ‹ä¸€çœ¼å‡½æ•°å®šä¹‰æˆ–æ–‡æ¡£ï¼Œè°æƒ³å¾—åˆ°è¿™æ˜¯ä¸ªæ¯«ç§’ï¼Ÿ</p>
<p>ä¸€ä¸ªç”¨æˆ·æƒ³è¦ç¡ 3 ç§’ï¼Œä»–å†™é“ï¼š</p>
<pre><code class="language-cpp">Sleep(3);
</code></pre>
<p>ç¼–è¯‘å™¨æ²¡æœ‰ä»»ä½•æŠ¥é”™ï¼Œä¸€è¿è¡Œåªç¡äº† 3 æ¯«ç§’ã€‚
ç”¨æˆ·å¤§å‘é›·éœ†ä»¥ä¸ºä½ çš„ Sleep å‡½æ•°æœ‰ BUGï¼Œæˆ‘è®©ä»–ç¡ 3 ç§’æ€ä¹ˆå¥½åƒæ ¹æœ¬æ²¡ç¡å•Šã€‚</p>
<h2 id="_45">&mdash;</h2>
<hr />
<pre><code class="language-cpp">void SleepMilliSeconds(int ms);
</code></pre>
<p>æ”¹ä¸ªå‡½æ•°åå¯ä»¥è§£å†³ä¸€éƒ¨åˆ†é—®é¢˜ï¼Œå½“ç”¨æˆ·è°ƒç”¨æ—¶ï¼Œä»–éœ€è¦æ‰‹åŠ¨æ‰“å‡º <code>MilliSeconds</code>ï¼Œä»è€Œå¼ºè¿«ä»–æ¸…é†’ä¸€ä¸‹ï¼Œè‡ªå·±ç»™çš„ 3 åˆ°åº•æ˜¯ä¸æ˜¯è‡ªå·±æƒ³è¦çš„ã€‚</p>
<h2 id="_46">&mdash;</h2>
<hr />
<pre><code class="language-cpp">struct MilliSeconds {
    int count;

    explicit MilliSeconds(int count) : count(count) {}
};

void Sleep(MilliSeconds delay);
</code></pre>
<p>ç°åœ¨ï¼Œå¦‚æœç”¨æˆ·å†™å‡º</p>
<pre><code class="language-cpp">Sleep(3);
</code></pre>
<p>ç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚
ä»–å¿…é¡»æ˜ç¡®å†™å‡º</p>
<pre><code class="language-cpp">Sleep(MilliSeconds(3));
</code></pre>
<p>æ‰èƒ½é€šè¿‡ç¼–è¯‘ã€‚</p>
<h2 id="_47">&mdash;</h2>
<hr />
<p>æ ‡å‡†åº“çš„ chrono æ¨¡å—å°±å¤§é‡è¿ç”¨äº†è¿™ç§å¼ºç±»å‹å°è£…ï¼š</p>
<pre><code class="language-cpp">this_thread::sleep_for(chrono::seconds(3));
</code></pre>
<p>å¦‚æœä½  <code>using namespace std::literials;</code> è¿˜å¯ä»¥è¿™æ ·å¿«æ·åœ°åˆ›å»ºå­—é¢é‡ï¼š</p>
<pre><code class="language-cpp">this_thread::sleep_for(3ms);  // 3 æ¯«ç§’
this_thread::sleep_for(3s);  // 3 ç§’
this_thread::sleep_for(3m);  // 3 åˆ†é’Ÿ
this_thread::sleep_for(3h);  // 3 å°æ—¶
</code></pre>
<p>ä¸”æ”¯æŒè¿ç®—ç¬¦é‡è½½ï¼Œä¸åŒå•ä½ä¹‹é—´è¿˜å¯ä»¥äº’ç›¸è½¬æ¢ï¼š</p>
<pre><code class="language-cpp">this_thread::sleep_for(1s + 200ms);
chrono::minutes three_minutes = 180s;
</code></pre>
<h2 id="_48">&mdash;</h2>
<hr />
<p>chrono æ˜¯ä¸€ä¸ªä¼˜ç§€çš„ç±»å‹å°è£…æ¡ˆä¾‹ï¼ŒæŠŠ time_t ç±»å‹å°è£…æˆäº†å¼ºç±»å‹çš„ duration å’Œ time_pointã€‚</p>
<p>æ—¶é—´ç‚¹ï¼ˆtime_pointï¼‰è¡¨ç¤ºæŸä¸ªå…·ä½“çš„æ—¶é—´ï¼Œä¾‹å¦‚ 2024 å¹´ 5 æœˆ 16 æ—¥ 18:06:28ã€‚
æ—¶é—´æ®µï¼ˆdurationï¼‰è¡¨ç¤ºä¸€æ®µæ—¶é—´çš„é•¿åº¦ï¼Œä¾‹å¦‚ 1 å¤©ï¼Œ2 å°æ—¶ï¼Œ3 åˆ†é’Ÿï¼Œ4 ç§’ã€‚</p>
<p>æ—¶é—´æ®µå¾ˆå®¹æ˜“è¡¨ç¤ºï¼Œåªéœ€è¦æŒ‡å®šä¸€ä¸ªå•ä½ï¼Œæ¯”å¦‚ç§’ï¼Œç„¶åç”¨ä¸€ä¸ªæ•°å­—å°±å¯ä»¥è¡¨ç¤ºå¤šå°‘ç§’çš„æ—¶é—´æ®µã€‚
ä½†æ˜¯æ—¶é—´ç‚¹å°±å¾ˆéš¾è¡¨ç¤ºäº†ï¼Œä¾‹å¦‚ä½ æ— æ³•</p>
<p>Unix æ—¶é—´æˆ³ç”¨ä¸€ä¸ªæ•°å­—æ¥è¡¨ç¤ºæ—¶é—´ç‚¹ï¼Œæ•°å­—çš„å«ä¹‰æ˜¯ä»å½“å‰æ—¶é—´åˆ° 1970 å¹´ 1 æœˆ 1 æ—¥ 00:00:00 çš„ç§’æ•°ã€‚
ä¾‹å¦‚å†™ä½œè¿™ç¯‡æ–‡ç« çš„æ—¶é—´æˆ³æ˜¯ 1715853968 (2024/5/16 18:06)ã€‚
C è¯­è¨€ç”¨ä¸€ä¸ª <code>time_t</code>ï¼Œå®é™…ä¸Šæ˜¯ <code>long</code> çš„ç±»å‹åˆ«åæ¥è¡¨ç¤ºæ—¶é—´æˆ³ï¼Œä½†å®ƒæœ‰ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜ï¼š
å®ƒå¯ä»¥è¢«å½“æˆæ—¶é—´ç‚¹ï¼Œä¹Ÿå¯ä»¥è¢«å½“æˆæ—¶é—´æ®µï¼Œè¿™å°±é€ æˆäº†å·¨å¤§çš„æ··ä¹±ã€‚</p>
<pre><code class="language-cpp">time_t t0 = time(NULL);  // æ—¶é—´ç‚¹
...
time_t t1 = time(NULL);  // æ—¶é—´ç‚¹
time_t dt = t1 - t0;     // æ—¶é—´æ®µ
</code></pre>
<ul>
<li>ç—›ç‚¹ï¼šå¦‚æœè¿™é‡Œçš„è´Ÿå·å†™é”™ï¼Œå†™æˆ <code>t1 + t0</code>ï¼Œç¼–è¯‘å™¨ä¸ä¼šæŠ¥é”™ï¼Œä½ å¯èƒ½æ ¹æœ¬æ²¡å‘ç°ï¼Œæµªè´¹å¤§é‡æ—¶é—´è°ƒè¯•æœ€ååªå‘ç°ä¸€ä¸ªä½çº§é”™è¯¯ã€‚</li>
<li>æ¨¡ç³Šï¼šæ—¶é—´ç‚¹ï¼ˆt0ã€t1ï¼‰å’Œæ—¶é—´æ®µï¼ˆdtï¼‰éƒ½æ˜¯ time_tï¼Œåˆæ¬¡é˜…è¯»ä»£ç å¾ˆå®¹æ˜“åˆ†ä¸æ¸…å“ªä¸ªæ˜¯æ—¶é—´ç‚¹ï¼Œå“ªä¸ªæ˜¯æ—¶é—´æ®µã€‚</li>
</ul>
<p>å¦‚æœä¸æ…æŠŠâ€œæ—¶é—´ç‚¹â€çš„ time_t ä¼ å…¥åˆ°æœ¬åº”åªæ”¯æŒâ€œæ—¶é—´æ®µâ€çš„ sleep å‡½æ•°ï¼Œä¼šå‡ºç°â€œç¡ç¾äººâ€çš„å¥‡è§‚ï¼š</p>
<pre><code class="language-cpp">time_t t = time(NULL);  // è¿”å› 1715853968 è¡¨ç¤ºå½“å‰æ—¶é—´ç‚¹
sleep(t);               // ä¸å°å¿ƒæŠŠæ—¶é—´ç‚¹å½“æˆæ—¶é—´æ®µæ¥ç”¨äº†ï¼
</code></pre>
<p>è¿™ä¸ªç¨‹åºä¼šç¡ 1715853968 ç§’åæ‰é†’ï¼Œå³ 54 å¹´åï¼</p>
<pre><code class="language-cpp">chrono::system_clock::time_point last = chrono::system_clock::now();
...
chrono::system_clock::time_point now = chrono::system_clock::now();
chrono::system_clock::duration dt = now - last;
cout &lt;&lt; &quot;ç”¨äº† &quot; &lt;&lt; duration_cast&lt;chrono::seconds&gt;(dt).count() &lt;&lt; &quot; ç§’\n&quot;;
</code></pre>
<ul>
<li>ä¸€çœ‹å°±çŸ¥é“å“ªä¸ªæ˜¯æ—¶é—´ç‚¹ï¼Œå“ªä¸ªæ˜¯æ—¶é—´æ®µ</li>
<li>ç”¨é”™äº†ç¼–è¯‘å™¨ä¼šæŠ¥é”™</li>
<li>
<p>å•ä½è½¬æ¢ä¸ä¼šæ··æ·†</p>
</li>
<li>
<p>æ—¶é—´ç‚¹ + æ—¶é—´ç‚¹ = ç¼–è¯‘å‡ºé”™ï¼å› ä¸ºæ—¶é—´ç‚¹ä¹‹é—´ä¸å…è®¸ç›¸åŠ ï¼Œ2024 + 2024ï¼Œä½ æ˜¯æƒ³åŠ åˆ° 4048 å¹´å»å—ï¼Ÿ</p>
</li>
<li>æ—¶é—´ç‚¹ - æ—¶é—´ç‚¹ = æ—¶é—´æ®µ</li>
<li>æ—¶é—´ç‚¹ + æ—¶é—´æ®µ = æ—¶é—´ç‚¹</li>
<li>æ—¶é—´ç‚¹ - æ—¶é—´æ®µ = æ—¶é—´ç‚¹</li>
<li>æ—¶é—´æ®µ + æ—¶é—´æ®µ = æ—¶é—´æ®µ</li>
<li>æ—¶é—´æ®µ - æ—¶é—´æ®µ = æ—¶é—´æ®µ</li>
<li>æ—¶é—´æ®µ Ã— å¸¸æ•° = æ—¶é—´æ®µ</li>
<li>æ—¶é—´æ®µ / å¸¸æ•° = æ—¶é—´æ®µ</li>
</ul>
<p>è¿™å°±æ˜¯æœ¬æœŸè¯¾ç¨‹çš„ä¸»é¢˜ï¼Œé€šè¿‡å¼ºå¤§çš„ç±»å‹ç³»ç»Ÿï¼Œå¯¹å¯èƒ½çš„ç”¨æ³•åŠ ä»¥ä¸¥æ ¼çš„é™åˆ¶ï¼Œæœ€å¤§é™åº¦é˜»æ­¢ç”¨æˆ·ä¸ç»æ„é—´å†™å‡ºé”™è¯¯çš„ä»£ç ã€‚</p>
<h2 id="_49">&mdash;</h2>
<hr />
<h2 id="_50">æšä¸¾ç±»å‹</h2>
<h2 id="_51">&mdash;</h2>
<hr />
<p>ä½ çš„è€æ¿è¦æ±‚ä¸€ä¸ªè®¾å®šå®¢æˆ·æ€§åˆ«çš„å‡½æ•°ï¼š</p>
<pre><code class="language-cpp">void foo(int sex);
</code></pre>
<p>è€æ¿å£å¤´å’Œå‘˜å·¥çº¦å®šè¯´ï¼Œ0è¡¨ç¤ºå¥³ï¼Œ1è¡¨ç¤ºç”·ï¼Œ2è¡¨ç¤ºè‡ªå®šä¹‰ã€‚</p>
<p>è¿™è°è®°å¾—ä½ï¼Ÿè®¾æƒ³ä½ æ˜¯ä¸€ä¸ªæ–°æ¥çš„å‘˜å·¥ï¼Œçœ‹åˆ°ä¸‹é¢çš„ä»£ç ï¼š</p>
<pre><code class="language-cpp">foo(1);
</code></pre>
<p>ä½ èƒ½çŒœåˆ°è¿™ä¸ª 1 æ˜¯ä»€ä¹ˆæ„æ€å—ï¼Ÿ</p>
<p>è§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨æšä¸¾ç±»å‹ï¼Œç»™æ¯ä¸ªæ•°å€¼ä¸€ä¸ªå”¯ä¸€çš„åå­—ï¼š</p>
<pre><code class="language-cpp">enum Sex {
    Female = 0,
    Male = 1,
    Custom = 2,
};

void foo(Sex sex);
</code></pre>
<p>å†å‡è®¾ä½ æ˜¯ä¸€ä¸ªæ–°æ¥çš„å‘˜å·¥ï¼Œçœ‹åˆ°ï¼š</p>
<pre><code class="language-cpp">foo(Male);
</code></pre>
<p>æ˜¯ä¸æ˜¯å°±ä¸€ç›®äº†ç„¶å•¦ï¼Ÿ</p>
<h2 id="_52">&mdash;</h2>
<hr />
<p>æšä¸¾çš„å€¼ä¹Ÿå¯ä»¥ä¸ç”¨å†™ï¼Œè®©ç¼–è¯‘å™¨è‡ªåŠ¨æŒ‰ 0ã€1ã€2 çš„é¡ºåºåˆ†é…å€¼ï¼š</p>
<pre><code class="language-cpp">enum Sex {
    Female,   // 0
    Male,     // 1
    Custom,   // 2
};
</code></pre>
<p>å¯ä»¥æŒ‡å®šä» 1 å¼€å§‹è®¡æ•°ï¼š</p>
<pre><code class="language-cpp">enum Sex {
    Female = 1,
    Male,      // 2
    Custom,    // 3
};
</code></pre>
<h2 id="_53">&mdash;</h2>
<hr />
<p>ä½†æšä¸¾ç±»å‹è¿˜æ˜¯å¯ä»¥éª—äººï¼Œå†å‡è®¾ä½ æ˜¯æ–°æ¥çš„ï¼Œçœ‹åˆ°ï¼š</p>
<pre><code class="language-cpp">foo(Male, 24);
</code></pre>
<p>æ˜¯ä¸æ˜¯æƒ³å½“ç„¶çš„æ„Ÿè§‰è¿™ä¸ªä»£ç æ²¡é—®é¢˜ï¼Ÿ</p>
<p>ä½†å½“ä½ çœ‹åˆ° foo å‡†ç¡®çš„å‡½æ•°å®šä¹‰æ—¶ï¼Œå‚»çœ¼äº†ï¼š</p>
<pre><code class="language-cpp">void foo(int age, Sex sex);
</code></pre>
<p>ç›¸å½“äºæ³¨å†Œäº†ä¸€ä¸ª 1 å²ï¼Œæ€§åˆ«æ˜¯ 24 çš„ä¼ªäººã€‚ä¸”ç¨‹åºå‘˜å¾ˆå®¹æ˜“çœ‹ä¸å‡ºé—®é¢˜ï¼Œç¼–è¯‘å™¨ä¹Ÿä¸æŠ¥é”™ã€‚</p>
<p>ä¸ºæ­¤ï¼ŒC++11 å¼•å…¥äº†<strong>å¼ºç±»å‹æšä¸¾</strong>ï¼š</p>
<pre><code class="language-cpp">enum class Sex {
    Female = 0,
    Male = 1,
    Custom = 2,
};
</code></pre>
<p>ç°åœ¨ï¼Œå¦‚æœä½ å†ä¸å°å¿ƒæŠŠ sex ä¼ å…¥ age çš„è¯ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼å› ä¸ºå¼ºç±»å‹æšä¸¾ä¸å…è®¸ä¸ int éšå¼è½¬æ¢ã€‚</p>
<p>è€Œä¸”å¼ºç±»å‹æšä¸¾ä¼šéœ€è¦æ˜¾å¼å†™å‡º <code>Sex::</code> ç±»å‹å‰ç¼€ï¼Œå½“ä½ æœ‰å¾ˆå¤šæšä¸¾ç±»å‹æ—¶ä¸å®¹æ˜“æ··æ·†ï¼š</p>
<pre><code class="language-cpp">foo(24, Sex::Male);
</code></pre>
<p>å¦‚æœä½ çš„ Sex èŒƒå›´å¾ˆå°ï¼Œåªéœ€è¦ uint8_t çš„å†…å­˜å°±å¤Ÿï¼Œå¯ä»¥ç”¨è¿™ä¸ªè¯­æ³•æŒ‡å®šæšä¸¾çš„â€œåå°ç±»å‹â€ï¼š</p>
<pre><code class="language-cpp">enum class Sex : uint8_t {
    Female = 0,
    Male = 1,
    Custom = 2,
};

static_assert(sizeof(Sex) == 1);
</code></pre>
<h2 id="_54">&mdash;</h2>
<hr />
<p>å‡å¦‚ä½ çš„æ‰€æœ‰ age éƒ½æ˜¯ int ç±»å‹çš„ï¼Œä½†æ˜¯ç°åœ¨ï¼Œè€æ¿çªç„¶å¿ƒè¡€æ¥æ½®ï¼š</p>
<p>è¯´ä¸ºäº†â€œä¼˜åŒ–å­˜å‚¨ç©ºé—´â€ï¼Œæƒ³è¦æŠŠæ‰€æœ‰ age æ”¹æˆ uint8_t ç±»å‹çš„ï¼</p>
<p>ä¸ºäº†é¢„é˜²æœªæ¥å¯èƒ½éœ€è¦æ”¹å˜ç±»å‹çš„éœ€æ±‚ï¼Œä¹Ÿæ˜¯ä¸ºäº†å¯è¯»æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç±»å‹åˆ«åï¼š</p>
<pre><code class="language-cpp">using Age = int;

void foo(Age age, Sex sex);
</code></pre>
<p>è¿™æ ·å½“è€æ¿éœ€è¦æ”¹å˜åº•å±‚ç±»å‹æ—¶ï¼Œåªéœ€è¦æ”¹åŠ¨ä¸€è¡Œï¼š</p>
<pre><code class="language-cpp">using Age = uint8_t;
</code></pre>
<p>å°±èƒ½è‡ªåŠ¨è®©æ‰€æœ‰ä»£ç éƒ½ä½¿ç”¨ uint8_t ä½œä¸º age äº†ã€‚</p>
<h2 id="_55">&mdash;</h2>
<hr />
<p>ä½†æ˜¯ç±»å‹åˆ«åæ¯•ç«Ÿåªæ˜¯åˆ«åï¼Œå¹¶æ²¡æœ‰å¼ºåˆ¶ä¿éšœï¼š</p>
<pre><code class="language-cpp">using Age = int;
using Phone = int;

foo(Age age, Phone phone);

void bar() {
    Age age = 42;
    Phone phone = 12345;

    foo(phone, age); // ä¸å°å¿ƒå†™åäº†ï¼è€Œç¼–è¯‘å™¨ä¸ä¼šæé†’ä½ ï¼
}
</code></pre>
<p>å› ä¸º Age å’Œ Phone åªæ˜¯ç±»å‹åˆ«åï¼Œå®é™…ä¸Šè¿˜æ˜¯åŒæ ·çš„ int ç±»å‹&hellip;æ‰€ä»¥ç¼–è¯‘å™¨ç”šè‡³ä¸ä¼šæœ‰ä»»ä½•è­¦å‘Šã€‚</p>
<p>æœ‰ä¸€ç§å¾ˆæç«¯çš„åšæ³•æ˜¯æŠŠ Age å’Œ Phone ä¹Ÿåšæˆæšä¸¾ï¼Œä½†æ²¡æœ‰å®šä¹‰ä»»ä½•å€¼ï¼š</p>
<pre><code class="language-cpp">enum class Age : int {};
enum class Phone : int {};
</code></pre>
<p>è¿™æ ·ç”¨åˆ°çš„æ—¶å€™å°±åªèƒ½é€šè¿‡å¼ºåˆ¶è½¬æ¢çš„è¯­æ³•ï¼š</p>
<pre><code class="language-cpp">foo(Age(42), Phone(12345));
</code></pre>
<p>å¹¶ä¸”å¦‚æœå†™é”™é¡ºåºï¼Œå°è¯•æŠŠ Phone ä¼ å…¥ Age ç±»å‹çš„å‚æ•°ï¼Œç¼–è¯‘å™¨ä¼šç«‹å³æŠ¥é”™ï¼Œé˜»æ­¢ä½ åŸ‹ä¸‹ BUG éšæ‚£ã€‚</p>
<h2 id="_56">&mdash;</h2>
<hr />
<p>å°å½­è€å¸ˆï¼Œæˆ‘ç”¨äº†ä½ çš„æ–¹æ³•ä»¥åï¼Œä¸èƒ½åšåŠ æ³•äº†æ€ä¹ˆåŠï¼Ÿ</p>
<pre><code class="language-cpp">Age(42) + Age(1) // ç¼–è¯‘å™¨é”™è¯¯ï¼
</code></pre>
<p>è¿™æ˜¯å› ä¸º Age æ˜¯å¼ºç±»å‹æšä¸¾ï¼Œä¸èƒ½éšå¼è½¬æ¢ä¸º int ååšåŠ æ³•ã€‚</p>
<p>å¯ä»¥å®šä¹‰ä¸€ä¸ªè¿ç®—ç¬¦é‡è½½ï¼š</p>
<pre><code class="language-cpp">enum class Age : int {};

inline Age operator+(Age a, Age b) {
    return Age((int)a + (int)b);
}
</code></pre>
<p>æˆ–è€…è¿ç”¨æ¨¡æ¿å…ƒç¼–ç¨‹ï¼Œç›´æ¥è®©åŠ æ³•è¿ç®—ç¬¦å¯¹äºæ‰€æœ‰æšä¸¾ç±»å‹éƒ½é»˜è®¤ç”Ÿæ•ˆï¼š</p>
<pre><code class="language-cpp">template &lt;class T&gt; requires std::is_enum_v&lt;T&gt;
T operator+(T a, T b) {
    using U = std::underlying_type_t&lt;T&gt;;
    return T((U)a + (U)b);
}
</code></pre>
<p>æœ‰æ—¶è¿™åè€Œæ˜¯ä¸ªä¼˜ç‚¹ï¼Œæ¯”å¦‚ä½ å¯ä»¥åªå®šä¹‰åŠ æ³•è¿ç®—ç¬¦ï¼Œå°±å¯ä»¥è®© Age ä¸æ”¯æŒä¹˜æ³•ï¼Œéœ€è¦æ‰‹åŠ¨è½¬æ¢åæ‰èƒ½ä¹˜ï¼Œé¿å…æ— æ„ä¸­çŠ¯é”™çš„å¯èƒ½ã€‚</p>
<h2 id="_57">&mdash;</h2>
<hr />
<p>å°å½­è€å¸ˆï¼Œæˆ‘ç”¨äº†ä½ æ¨èçš„<strong>å¼ºç±»å‹æšä¸¾</strong>ï¼Œä¸æ”¯æŒæˆ‘æœ€çˆ±çš„æˆ–è¿ç®— <code>|</code> äº†æ€ä¹ˆåŠï¼Ÿ</p>
<pre><code class="language-cpp">enum class OpenFlag {
    Create = 1,
    Read = 2,
    Write = 4,
    Truncate = 8,
    Append = 16,
    Binary = 32,
};

inline OpenFlag operator|(OpenFlag a, OpenFlag b) {
    return OpenFlag((int)a | (int)b);
}

inline OpenFlag operator&amp;(OpenFlag a, OpenFlag b) {
    return OpenFlag((int)a &amp; (int)b);
}

inline OpenFlag operator~(OpenFlag a) {
    return OpenFlag(~(int)a);
}
</code></pre>
<h2 id="_58">&mdash;</h2>
<hr />
<h2 id="_59">å…¶ä»–ç±»å‹å¥—çš®</h2>
<h2 id="_60">&mdash;</h2>
<hr />
<p>å°å½­è€å¸ˆï¼Œæˆ‘å¾ˆå–œæ¬¢å¼ºç±»å‹æšä¸¾è¿™ä¸€å¥—ï¼Œä½†æˆ‘çš„å‚æ•°ä¸æ˜¯æ•´æ•°ç±»å‹ï¼Œè€Œæ˜¯ doubleã€string ç­‰ç±»å‹ï¼Œæ€ä¹ˆåŠï¼Ÿ</p>
<pre><code class="language-cpp">struct Name {
private:
    std::string value;

public:
    explicit operator std::string() const {
        return value;
    }

    explicit Name(std::string value) : value(value) {}
};
</code></pre>
<p>è¿™é‡Œæˆ‘ä»¬å†™ explicit å°±å¯ä»¥é˜»æ­¢éšå¼ç±»å‹è½¬æ¢ï¼Œèµ·åˆ°ä¸å¼ºç±»å‹æšä¸¾ç±»ä¼¼çš„ä½œç”¨ã€‚</p>
<p>æˆ–è€…è¿ç”¨æ¨¡æ¿å…ƒç¼–ç¨‹ï¼š</p>
<pre><code class="language-cpp">// æ­¤å¤„ä½¿ç”¨ CRTP æ¨¡å¼æ˜¯ä¸ºäº†è®© Typed æ¯æ¬¡éƒ½å®ä¾‹åŒ–å‡ºä¸åŒçš„åŸºç±»ï¼Œé˜»æ­¢ object-slicing
template &lt;class CRTP, class T&gt;
struct Typed {
protected:
    T value;

public:
    explicit operator T() const {
        return value;
    }

    explicit Typed(T value) : value(value) {}
};
</code></pre>
<pre><code class="language-cpp">struct Name : Typed&lt;Name, T&gt; {};

struct Meter : Typed&lt;Meter, double&gt; {};

struct Kilometer : Typed&lt;Kilometer, double&gt; {
    operator Meter() const {
        // å…è®¸éšå¼è½¬æ¢ä¸ºç±³
        return Meter(value * 1000);
    }
};

Meter m = Kilometer(1);
// m = Meter(1000);
foo(m);
</code></pre>
<h2 id="_61">&mdash;</h2>
<hr />
<h2 id="raii">RAII å°è£…</h2>
<h2 id="_62">&mdash;</h2>
<hr />
<p>å°å½­è€å¸ˆï¼Œæˆ‘çš„å‡½æ•°å°±æ˜¯æ¶‰åŠâ€œå¼€å§‹â€å’Œâ€œç»“æŸâ€ä¸¤ä¸ªæ“ä½œï¼Œç”¨æˆ·çš„æ“ä½œéœ€è¦ç©¿æ’åœ¨å…¶ä¸­é—´ï¼Œæ€ä¹ˆæ•´åˆå‘¢ï¼Ÿ</p>
<pre><code class="language-cpp">mysql_connection *conn = mysql_connect(&quot;127.0.0.1&quot;);
mysql_execute(conn, &quot;drop database paolu&quot;);
mysql_close(conn); // ç”¨æˆ·å¯èƒ½å¿˜è®°å…³é—­è¿æ¥ï¼ç ´ååº“è®¾è®¡è€…æƒ³è¦çš„ç”¨æ³•
</code></pre>
<p>è¿™ç§å¤§å¤šæ˜¯è·å–èµ„æºï¼Œå’Œé‡Šæ”¾èµ„æºä¸¤ä¸ªæ“ä½œã€‚</p>
<p>å› ä¸º mysql æ˜¯ä¸ª C è¯­è¨€çš„åº“ï¼Œä»–æ²¡æœ‰ RAII å°è£…ï¼Œè®©ä»–æ‰‹åŠ¨å°è£…æœ‰çš„åŒå­¦åˆå«Œå¼ƒéº»çƒ¦ã€‚</p>
<p>è¿™æ—¶æˆ‘ä¼šå‘Šè¯‰ä»–ä»¬ä¸€ä¸ª shared_ptr å°å¦™æ‹›ï¼šæ„é€ å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥æŒ‡å®šé‡Šæ”¾å‡½æ•°ï¼Œä»£æ›¿é»˜è®¤çš„ delete</p>
<pre><code class="language-cpp">auto conn = std::shared_ptr&lt;mysql_connection&gt;(mysql_connect(&quot;127.0.0.1&quot;), mysql_close);
mysql_execute(conn.get(), &quot;drop database paolu&quot;);
// conn ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ mysql_closeï¼Œæœç»äº†ä¸€ä¸ªå‡ºé”™çš„å¯èƒ½
</code></pre>
<h2 id="_63">&mdash;</h2>
<hr />
<p>ä»¥å°è£… C è¯­è¨€çš„ FILE ä¸ºä¾‹ã€‚</p>
<pre><code class="language-cpp">size_t fread(void *ptr, size_t size, size_t nmemb, FILE *file);
</code></pre>
<p>è¿™ä¸ª size å’Œ nmemb çœŸæ˜¯å¤ªç³Ÿç³•äº†ï¼Œæœ¬æ„æ˜¯ä¸ºäº†æ”¯æŒä¸åŒå…ƒç´ ç±»å‹çš„æ•°ç»„ã€‚
size æ˜¯å…ƒç´ æœ¬èº«å¤§å°ï¼Œnmemb æ˜¯å…ƒç´ æ•°é‡ã€‚å®é™…è¯»å–çš„å­—èŠ‚æ•°æ˜¯ size * nmembã€‚
æˆ‘å°±ç»å¸¸æŠŠ ptr å’Œ file é¡ºåºå†™åï¼Œè¿™ä¸ªè«åå…¶å¦™çš„å‚æ•°é¡ºåºå¤ªåç›´è§‰äº†ï¼</p>
<p>å°å½­è€å¸ˆè¿ç”¨ç°ä»£ C++ æ€æƒ³å°è£…ä¹‹ï¼š</p>
<pre><code class="language-cpp">using FileHandle = std::shared_ptr&lt;FILE&gt;;

enum class OpenMode {
    Read,
    Write,
    Append,
};

inline OpenMode operator|(OpenMode a, OpenMode b) {
    return OpenMode((int)a | (int)b);
}

auto modeLut = std::map&lt;OpenMode, std::string&gt;{
    {OpenMode::Read, &quot;r&quot;},
    {OpenMode::Write, &quot;w&quot;},
    {OpenMode::Append, &quot;a&quot;},
    {OpenMode::Read | OpenMode::Write, &quot;w+&quot;},
    {OpenMode::Read | OpenMode::Append, &quot;a+&quot;},
};

FileHandle file_open(std::filesystem::path path, OpenMode mode) {
#ifdef _WIN32
    return std::shared_ptr&lt;FILE&gt;(_wfopen(path.wstring().c_str(), modeLut.at(mode)), fclose);
#else
    return std::shared_ptr&lt;FILE&gt;(fopen(path.string().c_str(), modeLut.at(mode)), fclose);
#endif
}

struct [[nodiscard]] FileResult {
    std::optional&lt;size_t&gt; numElements;
    std::errc errorCode;  // std::errc æ˜¯ä¸ªå¼ºç±»å‹æšä¸¾ï¼Œç”¨äºå–ä»£ C è¯­è¨€ errno çš„ int ç±»å‹
    bool isEndOfFile;
};

template &lt;class T&gt;
FileResult file_read(FileHandle file, std::span&lt;T&gt; elements) {
    auto n = fread(elements.data(), sizeof(T), elements.size(), file.get());
    return {
        .numElements = n == 0 ? n : std::nullopt,
        .errorCode = std::errc(ferror(file.get())),
        .isEndOfFile = (bool)feof(file.get()),
    };
}
</code></pre>
<p>æ˜¯ä¸æ˜¯æ¥å£æ›´åŠ ç®€å•æ˜“æ‡‚ï¼Œæ²¡æœ‰çŠ¯é”™çš„æœºä¼šäº†ï¼Ÿ</p>
<pre><code class="language-cpp">FileHandle file = file_open(&quot;hello.txt&quot;, OpenMode::Read);
int arr[32];
file_read(file, arr).numElements.value();  // å¦‚æœæ²¡æœ‰è¯»åˆ°ä¸œè¥¿ï¼Œè¿™é‡Œä¼šæŠ›å‡ºå¼‚å¸¸
// é€€å‡ºä½œç”¨åŸŸæ—¶ï¼Œshared_ptr ä¼šè‡ªåŠ¨ä¸ºä½ å…³é—­æ–‡ä»¶ï¼Œæ— éœ€å†æä¾› file_close å‡½æ•°
</code></pre>
<h2 id="_64">&mdash;</h2>
<hr />
<h2 id="mutex">Mutex å°è£…</h2>
<h2 id="_65">&mdash;</h2>
<hr />
<h2 id="_66">&mdash;</h2>
<hr />
<h2 id="cuda">å½©è›‹ï¼šCUDA å°è£…å®æˆ˜</h2>
<h2 id="_67">&mdash;</h2>
<hr />
<h2 id="_68">å˜é‡åä¸ä½œç”¨åŸŸé™åˆ¶</h2>
<h2 id="_69">&mdash;</h2>
<hr />
<h2 id="_70">&mdash;</h2>
<hr />
<h2 id="getset">ä½ çœŸçš„éœ€è¦ get/set å—ï¼Ÿ</h2>
<h2 id="_71">&mdash;</h2>
<hr />
<p>TODO</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>å°å½­è€å¸ˆå€¾ â™¥ åˆ¶ä½œ</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../js/print-site.js"></script>
        <script src="../extra.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
