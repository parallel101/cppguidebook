<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="å°å½­è€å¸ˆ">
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>è®©è™šå‡½æ•°å†æ¬¡ä¼Ÿå¤§ï¼ - âœï¸å°å½­å¤§å…¸âœï¸</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../css/print-site.css" rel="stylesheet">
        <link href="../css/print-site-mkdocs.css" rel="stylesheet">
        <link href="../extra.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/bash.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/c.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/cmake.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/cpp.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/diff.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/java.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/json.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/llvm.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/nasm.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/python.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/txt.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">âœï¸å°å½­å¤§å…¸âœï¸</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">ç« èŠ‚åˆ—è¡¨</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href=".." class="dropdown-item">å‰è¨€</a>
</li>
                                    
<li>
    <a href="../hello_world/" class="dropdown-item">ä½ å¥½ï¼Œä¸–ç•Œ</a>
</li>
                                    
<li>
    <a href="../platform/" class="dropdown-item">å¼€å‘ç¯å¢ƒä¸å¹³å°é€‰æ‹©</a>
</li>
                                    
<li>
    <a href="../variable_types/" class="dropdown-item">å˜é‡ä¸ç±»å‹ (æœªå®Œå·¥)</a>
</li>
                                    
<li>
    <a href="../functions/" class="dropdown-item">è®¤è¯†å‡½æ•° (æœªå®Œå·¥)</a>
</li>
                                    
<li>
    <a href="../auto/" class="dropdown-item">auto ç¥æ•™</a>
</li>
                                    
<li>
    <a href="../symbols/" class="dropdown-item">é‡æ–°è®¤è¯†å£°æ˜ä¸å®šä¹‰ï¼ˆæœªå®Œå·¥ï¼‰</a>
</li>
                                    
<li>
    <a href="../struct_layout/" class="dropdown-item">ç»“æ„ä½“å¸ƒå±€</a>
</li>
                                    
<li>
    <a href="../cpp_tricks/" class="dropdown-item">åº”çŸ¥åº”ä¼š C++ å°æŠ€å·§</a>
</li>
                                    
<li>
    <a href="../lambda/" class="dropdown-item">å°å½­è€å¸ˆå¸¦ä½ å­¦å‡½æ•°å¼ç¼–ç¨‹</a>
</li>
                                    
<li>
    <a href="../type_rich_api/" class="dropdown-item">ç°ä»£åŒ–çš„ API è®¾è®¡æŒ‡å—</a>
</li>
                                    
<li>
    <a href="../no_more_new/" class="dropdown-item">ç°ä»£ C++ ä»æ‹’ç» new å¼€å§‹</a>
</li>
                                    
<li>
    <a href="../stl_map/" class="dropdown-item">STL ç²¾è®²ï¼šstd::map å’Œä»–çš„æœ‹å‹ä»¬</a>
</li>
                                    
<li>
    <a href="../design_overview/" class="dropdown-item">è®¾è®¡æ¨¡å¼æ€»è§ˆ (æœªå®Œå·¥)</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">è®©è™šå‡½æ•°å†æ¬¡ä¼Ÿå¤§ï¼</a>
</li>
                                    
<li>
    <a href="../design_gamedev/" class="dropdown-item">æ¸¸æˆå¼€å‘ä¸­å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼</a>
</li>
                                    
<li>
    <a href="../design_functor/" class="dropdown-item">å‡½æ•°å¼è®¾è®¡æ¨¡å¼</a>
</li>
                                    
<li>
    <a href="../design_variant/" class="dropdown-item">é™æ€å¤šæ€ä¸é¢å‘æ•°æ®ç¼–ç¨‹ (æœªå®Œå·¥)</a>
</li>
                                    
<li>
    <a href="../design_erasure/" class="dropdown-item">ç±»å‹æ“¦é™¤ç¥æ•™åŠå…¶å®ç° (æœªå®Œå·¥)</a>
</li>
                                    
<li>
    <a href="../design_concept/" class="dropdown-item">é¸­å­ç±»å‹ä¸ C++20 concept (æœªå®Œå·¥)</a>
</li>
                                    
<li>
    <a href="../error_code/" class="dropdown-item">ç°ä»£ C++ é”™è¯¯å¤„ç†çŸ¥å¤šå°‘ï¼ˆæœªå®Œå·¥ï¼‰</a>
</li>
                                    
<li>
    <a href="../cpp_lifetime/" class="dropdown-item">æ·±å…¥ç†è§£ææ„å‡½æ•°ä¸ç”Ÿå‘½å‘¨æœŸ</a>
</li>
                                    
<li>
    <a href="../cpp_memory/" class="dropdown-item">çœŸæ­£çš„ C++ å†…å­˜æ¨¡å‹ï¼ (æœªå®Œå·¥)</a>
</li>
                                    
<li>
    <a href="../unicode/" class="dropdown-item">å­—ç¬¦ç¼–ç é‚£äº›äº‹</a>
</li>
                                    
<li>
    <a href="../threading/" class="dropdown-item">C++ å¤šçº¿ç¨‹ç¼–ç¨‹ï¼ˆæœªå®Œå·¥ï¼‰</a>
</li>
                                    
<li>
    <a href="../test_and_safe/" class="dropdown-item">æµ‹è¯•ä¸å®‰å…¨è¯é¢˜ï¼ˆæœªå®Œå·¥ï¼‰</a>
</li>
                                    
<li>
    <a href="../undef/" class="dropdown-item">æœªå®šä¹‰è¡Œä¸ºå®Œæ•´åˆ—è¡¨</a>
</li>
                                    
<li>
    <a href="../llvm_intro/" class="dropdown-item">å°å½­è€å¸ˆå¸¦ä½ å­¦ LLVM</a>
</li>
                                    
<li>
    <a href="../cuda_intro/" class="dropdown-item">ç°ä»£ C++ çš„ CUDA ç¼–ç¨‹</a>
</li>
                                    
<li>
    <a href="../cmake_tutor/" class="dropdown-item">å­¦ç°ä»£ C++ ä»ç°ä»£ CMake å­¦èµ·ï¼ˆæœªå®Œå·¥ï¼‰</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">å…³äº</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../about/" class="dropdown-item">å…³äºå°å½­è€å¸ˆ</a>
</li>
                                    
<li>
    <a href="../donate/" class="dropdown-item">èµåŠ©åå•</a>
</li>
                                    
<li>
    <a href="../interview/" class="dropdown-item">å°å½­è€å¸ˆé¢è¯•ç»éªŒ</a>
</li>
                                    
<li>
    <a href="../recommend/" class="dropdown-item">å‚è€ƒèµ„æ–™ä¸é¡¹ç›®æ¨è</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/parallel101/cppguidebook" class="nav-link">GitHub</a>
                            </li>
                            <li class="nav-item">
                                <a href="https://space.bilibili.com/263032155" class="nav-link">Bilibili</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../design_overview/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../design_gamedev/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/parallel101/cppguidebook/edit/master/docs/design_virtual.md" class="nav-link"><i class="fa-brands fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#_1" class="nav-link">è®©è™šå‡½æ•°å†æ¬¡ä¼Ÿå¤§ï¼</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#_2" class="nav-link">è™šå‡½æ•°å®æˆ˜æ¡ˆä¾‹</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_3" class="nav-link">å¤šé‡ç­–ç•¥</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_4" class="nav-link">ä¸è¦ä»€ä¹ˆä¸œè¥¿éƒ½å¡ä¸€å—</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#_5" class="nav-link">é€‚é…å™¨æ¨¡å¼</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#_6" class="nav-link">è·¨æ¥å£çš„é€‚é…å™¨</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#_7" class="nav-link">å·¥å‚æ¨¡å¼</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#_8" class="nav-link">è¶…çº§å·¥å‚æ¨¡å¼</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#raii" class="nav-link">RAII è‡ªåŠ¨ç®¡ç†å†…å­˜</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_9" class="nav-link">å·¥å‚æ¨¡å¼å®æˆ˜</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#_10" class="nav-link">äº«å…ƒæ¨¡å¼</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#_11" class="nav-link">ä»£ç†æ¨¡å¼</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#_12" class="nav-link">ç»„ä»¶æ¨¡å¼</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#_13" class="nav-link">è™šå‡½æ•°å¸¸è§é—®é¢˜è¾¨æ</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#bool" class="nav-link">è¿”å› bool çš„è™šå‡½æ•°</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_14" class="nav-link">è¯¾åä½œä¸š</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="_1">è®©è™šå‡½æ•°å†æ¬¡ä¼Ÿå¤§ï¼</h1>
<p>è®¸å¤šè®¾è®¡æ¨¡å¼éƒ½ä¸è™šå‡½æ•°æ¯æ¯ç›¸å…³ï¼Œä»Šå¤©æˆ‘ä»¬æ¥å­¦ä¹ ä¸€äº›å¸¸ç”¨çš„ã€‚</p>
<ul>
<li>ç­–ç•¥æ¨¡å¼</li>
<li>è¿­ä»£å™¨æ¨¡å¼</li>
<li>é€‚é…å™¨æ¨¡å¼</li>
<li>å·¥å‚æ¨¡å¼</li>
<li>è¶…çº§å·¥å‚æ¨¡å¼</li>
<li>äº«å…ƒæ¨¡å¼</li>
<li>ä»£ç†æ¨¡å¼</li>
</ul>
<p>å¾ˆå¤šæ•™æä¸­éƒ½ä¼šä¸¾å‡ºè¿™ç§çœ‹èµ·æ¥å¥½åƒå¾ˆæœ‰è¯´æœåŠ›çš„ä¾‹å­ï¼š</p>
<pre><code class="language-cpp">struct Pet {
    virtual void speak() = 0;
};

struct CatPet ï¼šPet {
    void speak() override {
        puts(&quot;å–µ&quot;);
    }
};

struct DogPet ï¼šPet {
    void speak() override {
        puts(&quot;æ±ª&quot;);
    }
};

int main() {
    Pet *cat = new CatPet();
    Pet *dog = new DogPet();
    cat-&gt;speak();
    dog-&gt;speak();
}
</code></pre>
<p>ç„¶è€Œï¼Œåœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œè™šå‡½æ•°å¯æœ‰å¯æ— ï¼Œå¹¶æ²¡æœ‰å‘æŒ¥ä»»ä½•ä»·å€¼ï¼Œå› ä¸ºæ™®é€šæˆå‘˜å‡½æ•°ä¹Ÿå¯ä»¥å®ç°åŒæ ·æ•ˆæœã€‚</p>
<p>è™šå‡½æ•°çœŸæ­£çš„ä»·å€¼åœ¨äºï¼Œä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ å…¥å…¶ä»–å‡½æ•°æ—¶ï¼å¯ä»¥å¤ç”¨é‚£ä¸ªå‡½æ•°é‡Œçš„ä»£ç ã€‚</p>
<pre><code class="language-cpp">void feed(Pet *pet) {
    puts(&quot;å–‚é£Ÿ&quot;);
    pet-&gt;speak();
    puts(&quot;å–‚é£Ÿå®Œæ¯•&quot;);
}

int main() {
    Pet *cat = new CatPet();
    Pet *dog = new DogPet();
    feed(cat);
    feed(dog);
}
</code></pre>
<p>ä¼˜ç‚¹åœ¨äºï¼Œfeed å‡½æ•°åªç”¨å®ç°ä¸€éäº†ã€‚å¦‚æœæ²¡æœ‰è™šå‡½æ•°ï¼š</p>
<pre><code class="language-cpp">void feed(DogPet *pet) {
    puts(&quot;å–‚é£Ÿ&quot;);      // é‡å¤çš„ä»£ç 
    puts(&quot;æ±ª&quot;);
    puts(&quot;å–‚é£Ÿå®Œæ¯•&quot;);  // é‡å¤çš„ä»£ç 
}

void feed(CatPet *pet) {
    puts(&quot;å–‚é£Ÿ&quot;);      // é‡å¤çš„ä»£ç 
    puts(&quot;å–µ&quot;);
    puts(&quot;å–‚é£Ÿå®Œæ¯•&quot;);  // é‡å¤çš„ä»£ç 
}
</code></pre>
<p><code>å–‚é£Ÿ</code> å’Œ <code>å–‚é£Ÿå®Œæ¯•</code> é‡å¤ä¸¤éï¼å¦‚æœæˆ‘ä»¬åˆè¦å¼•å…¥ä¸€ç§æ–°åŠ¨ç‰© <code>PigPet</code> å‘¢ï¼Ÿä½ åˆè¦æ‰‹å¿™è„šä¹±å¤åˆ¶ç²˜è´´ä¸€ä»½æ–°çš„ feed å‡½æ•°ï¼</p>
<pre><code class="language-cpp">void feed(PigPet *pet) {
    puts(&quot;å–‚é£Ÿ&quot;);      // é‡å¤çš„ä»£ç 
    puts(&quot;æ‹±&quot;);
    puts(&quot;å–‚é£Ÿå®Œæ¯•&quot;);  // é‡å¤çš„ä»£ç 
}
</code></pre>
<p>ç°åœ¨ï¼Œè€æ¿çªç„¶æ”¹äº†éœ€æ±‚ï¼Œä»–è¯´åŠ¨ç‰©ç°åœ¨è¦å«ä¸¤æ¬¡ã€‚
é‡‡ç”¨äº†è™šå‡½æ•°çš„ä½ ï¼Œåªéœ€è¦åœ¨ feed å‡½æ•°å†…å¢åŠ ä¸€æ¬¡ speak å³å¯ï¼Œè½»æ¾ï¼</p>
<pre><code class="language-cpp">void feed(Pet *pet) {
    puts(&quot;å–‚é£Ÿ&quot;);
    pet-&gt;speak();
    pet-&gt;speak();  // åŠ è¿™é‡Œ
    puts(&quot;å–‚é£Ÿå®Œæ¯•&quot;);
}
</code></pre>
<p>è€Œå¦‚æœä¸€å¼€å§‹æ²¡ç”¨è™šå‡½æ•°ï¼Œå°±å¾—è¿æ”¹ 3 ä¸ªåœ°æ–¹ï¼</p>
<pre><code class="language-cpp">void feed(DogPet *pet) {
    puts(&quot;å–‚é£Ÿ&quot;);
    puts(&quot;æ±ª&quot;);  // æ”¹è¿™é‡Œ
    puts(&quot;æ±ª&quot;);  // æ”¹è¿™é‡Œ
    puts(&quot;å–‚é£Ÿå®Œæ¯•&quot;);
}

void feed(CatPet *pet) {
    puts(&quot;å–‚é£Ÿ&quot;);
    puts(&quot;å–µ&quot;);  // æ”¹è¿™é‡Œ
    puts(&quot;å–µ&quot;);  // æ”¹è¿™é‡Œ
    puts(&quot;å–‚é£Ÿå®Œæ¯•&quot;);
}

void feed(PigPet *pet) {
    puts(&quot;å–‚é£Ÿ&quot;);
    puts(&quot;æ‹±&quot;);  // æ”¹è¿™é‡Œ
    puts(&quot;æ‹±&quot;);  // æ”¹è¿™é‡Œ
    puts(&quot;å–‚é£Ÿå®Œæ¯•&quot;);
}
</code></pre>
<p>è€Œä¸”ä¸‡ä¸€å¤åˆ¶ç²˜è´´çš„æ—¶å€™æœ‰ä¸ªåœ°æ–¹å†™é”™äº†ï¼Œéå¸¸éšè”½ï¼Œå¾ˆå®¹æ˜“å‘ç°ä¸äº†ï¼š</p>
<pre><code class="language-cpp">void feed(PigPet *pet) {
    puts(&quot;å–‚é£Ÿ&quot;);
    puts(&quot;æ‹±&quot;);
    puts(&quot;å–µ&quot;);  // æŠŠçŒ«çš„ä»£ç å¤åˆ¶è¿‡æ¥çš„æ—¶å€™æ¼æ”¹äº† ğŸ¤¯
    puts(&quot;å–‚é£Ÿå®Œæ¯•&quot;);
}
</code></pre>
<h2 id="_2">è™šå‡½æ•°å®æˆ˜æ¡ˆä¾‹</h2>
<p>å°å½­è€å¸ˆï¼Œä½ è¯´çš„è¿™äº›æˆ‘éƒ½ä¼šï¼Œè¿™æœ‰ä»€ä¹ˆç¨€å¥‡çš„ã€‚é‚£æˆ‘ä»¬æ¥ä¸¾ä¸ªå®é™…å¼€å‘ä¸­ä¼šé‡åˆ°çš„ä¾‹å­ã€‚</p>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªæ±‚å’Œå‡½æ•°ï¼Œå¯ä»¥è®¡ç®—ä¸€ä¸ªæ•°ç»„ä¸­æ‰€æœ‰æ•°å­—çš„å’Œã€‚
è¿˜æœ‰ä¸€ä¸ªæ±‚ç§¯å‡½æ•°ï¼Œå¯ä»¥è®¡ç®—ä¸€ä¸ªæ•°ç»„ä¸­æ‰€æœ‰æ•°å­—çš„ç§¯ã€‚</p>
<pre><code class="language-cpp">int sum(vector&lt;int&gt; v) {
    int res = 0;
    for (int i = 0; i &lt; v.size(); i++) {
        res = res + v[i];
    }
    return res;
}

int product(vector&lt;int&gt; v) {
    int res = 1;
    for (int i = 0; i &lt; v.size(); i++) {
        res = res * v[i];
    }
    return res;
}
</code></pre>
<p>æ³¨æ„åˆ°è¿™é‡Œé¢æœ‰å¾ˆå¤šä»£ç é‡å¤ï¼</p>
<p>æˆ‘ä»¬è§‚å¯Ÿä¸€ä¸‹ sum å’Œ product ä¹‹é—´æœ‰å“ªäº›ç›¸ä¼¼çš„éƒ¨åˆ†ï¼ŒæŠŠä¸¤è€…äº§ç”Ÿä¸åŒçš„éƒ¨åˆ†ç”¨ ??? ä»£æ›¿ã€‚</p>
<pre><code class="language-cpp">int reduce(vector&lt;int&gt; v) {
    int res = ???;            // sum æ—¶è¿™é‡Œæ˜¯ 0ï¼Œproduct æ—¶è¿™é‡Œæ˜¯ 1
    for (int i = 0; i &lt; v.size(); i++) {
        res = res ??? v[i];   // sum æ—¶è¿™é‡Œæ˜¯ +ï¼Œproduct æ—¶è¿™é‡Œæ˜¯ *
    }
    return res;
}
</code></pre>
<p>æŠŠ ??? éƒ¨åˆ†ç”¨ä¸€ä¸ªè™šå‡½æ•°é¡¶æ›¿ï¼š</p>
<pre><code class="language-cpp">struct Reducer {
    virtual int init() = 0;
    virtual int add(int a, int b) = 0;
};

int reduce(vector&lt;int&gt; v, Reducer *reducer) {
    int res = reducer-&gt;init();
    for (int i = 0; i &lt; v.size(); i++) {
        res = reducer-&gt;add(res, v[i]);
    }
    return res;
}
</code></pre>
<p>è¿™æ ·ä¸è®ºæˆ‘ä»¬æƒ³è¦æ±‚å’Œï¼Œè¿˜æ˜¯æ±‚ç§¯ï¼Œåªéœ€è¦å®ç°å…¶ä¸­ä¸åŒçš„éƒ¨åˆ†å°±å¯ä»¥äº†ï¼Œå…¬å…±éƒ¨åˆ†å·²ç»åœ¨ reduce é‡Œå®ç°å¥½ï¼Œå°±å®ç°äº†ä»£ç å¤ç”¨ã€‚</p>
<pre><code class="language-cpp">struct SumReducer : Reducer {
    int init() override {
        return 0;
    }

    int add(int a, int b) override {
        return a + b;
    }
};

struct ProductReducer : Reducer {
    int init() override {
        return 1;
    }

    int add(int a, int b) override {
        return a * b;
    }
};
</code></pre>
<pre><code class="language-cpp">reduce(v, new SumReducer());     // ç­‰ä»·äºä¹‹å‰çš„ sum(v)
reduce(v, new ProductReducer()); // ç­‰ä»·äºä¹‹å‰çš„ product(v)
</code></pre>
<p>è¿™å°±æ˜¯æ‰€è°“çš„<strong>ç­–ç•¥æ¨¡å¼</strong>ã€‚</p>
<p>å¾ˆå®¹æ˜“æ·»åŠ æ–°çš„ç­–ç•¥è¿›æ¥ï¼š</p>
<pre><code class="language-cpp">struct MinReducer : Reducer {
    int init() override {
        return numeric_limits&lt;int&gt;::max();
    }

    int add(int a, int b) override {
        return min(a, b);
    }
};

struct MaxReducer : Reducer {
    int init() override {
        return numeric_limits&lt;int&gt;::min();
    }

    int add(int a, int b) override {
        return max(a, b);
    }
};
</code></pre>
<h2 id="_3">å¤šé‡ç­–ç•¥</h2>
<p>ç°åœ¨ï¼Œè€æ¿éœ€æ±‚æ”¹å˜ï¼Œä»–æƒ³è¦ sum å’Œ product å‡½æ•°ä»è¾“å…¥æ•°æ®ç›´æ¥è®¡ç®—ï¼ˆè€Œä¸ç”¨å…ˆè¯»å–åˆ°ä¸€ä¸ª vectorï¼‰ï¼</p>
<p>è¿˜å¥½ä½ æ—©å·²æå‰æŠ½å‡ºå…¬å…±éƒ¨åˆ†ï¼Œç°åœ¨åªéœ€è¦ä¿®æ”¹ reduce å‡½æ•°æœ¬èº«å°±å¯ä»¥äº†ã€‚</p>
<p>SumReducer å’Œ ProductReducer æ— éœ€ä»»ä½•ä¿®æ”¹ï¼Œä½“ç°äº†<strong>å¼€é—­åŸåˆ™</strong>ã€‚</p>
<pre><code class="language-cpp">int reduce(Reducer *reducer) {
    int res = reducer-&gt;init();
    while (true) {
        int tmp;
        cin &gt;&gt; tmp;
        if (tmp == -1) break;
        res = reducer-&gt;add(res, tmp);
    }
    return res;
}
</code></pre>
<p>ç°åœ¨ï¼Œè€æ¿éœ€æ±‚åˆæ”¹å›æ¥ï¼Œä»–çªç„¶åˆæƒ³è¦ä» vector é‡Œè¯»å–æ•°æ®äº†ã€‚</p>
<p>åœ¨ç ´å£å¤§éª‚è€æ¿å‡ºå°”åå°”çš„åŒæ—¶ï¼Œä½ å¼€å§‹æ€è€ƒï¼Œè¿™ä¸¤ä¸ªå‡½æ•°ä¼¼ä¹è¿˜æ˜¯æœ‰ä¸€äº›é‡å¤å¯ä»¥æŠ½å–å‡ºæ¥ï¼Ÿ</p>
<pre><code class="language-cpp">int cin_reduce(Reducer *reducer) {
    int res = reducer-&gt;init();
    while (true) {
        int tmp;
        cin &gt;&gt; tmp;
        if (tmp == -1) break;
        res = reducer-&gt;add(res, tmp);
    }
    return res;
}

int vector_reduce(vector&lt;int&gt; v, Reducer *reducer) {
    int res = reducer-&gt;init();
    for (int i = 0; i &lt; v.size(); i++) {
        res = reducer-&gt;add(res, v[i]);
    }
    return res;
}
</code></pre>
<p>ç°åœ¨æˆ‘ä»¬åªæœ‰è¡¨ç¤ºå¦‚ä½•è®¡ç®—çš„ç±» Reducer åšå‚æ•°ã€‚</p>
<p>ä½ å†³å®šï¼Œå†å®šä¹‰ä¸€ä¸ªè¡¨ç¤ºå¦‚ä½•è¯»å–çš„è™šç±» Inputerã€‚</p>
<pre><code class="language-cpp">struct Inputer {
    virtual optional&lt;int&gt; fetch() = 0;
};

int reduce(Inputer *inputer, Reducer *reducer) {
    int res = reducer-&gt;init();
    while (auto tmp = inputer-&gt;fetch()) {
        res = reducer-&gt;add(res, tmp.value());
    }
    return res;
}
</code></pre>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬æ»¡è¶³äº†<strong>å•ä¸€èŒè´£åŸåˆ™</strong>ï¼šæ¯ä¸ªç±»åªè´Ÿè´£ä¸€ä»¶äº‹ã€‚</p>
<p>è¿™é‡Œçš„ Inputer å®é™…ä¸Šè¿ç”¨äº†<strong>è¿­ä»£å™¨æ¨¡å¼</strong>ï¼šæä¾›ä¸€ä¸ªæŠ½è±¡æ¥å£æ¥<strong>é¡ºåºè®¿é—®</strong>ä¸€ä¸ªé›†åˆä¸­å„ä¸ªå…ƒç´ ï¼Œè€Œåˆæ— é¡»æš´éœ²è¯¥é›†åˆçš„å†…éƒ¨è¡¨ç¤ºã€‚</p>
<blockquote>
<p>åº•å±‚æ˜¯ cin è¿˜æ˜¯ vectorï¼Ÿæˆ‘ä¸åœ¨ä¹ï¼æˆ‘åªçŸ¥é“ä»–å¯ä»¥ä¾æ¬¡é¡ºåºå–å‡ºæ•°æ®ã€‚</p>
</blockquote>
<pre><code class="language-cpp">struct CinInputer : Inputer {
    optional&lt;int&gt; fetch() override {
        int tmp;
        cin &gt;&gt; tmp;
        if (tmp == -1)
            return nullopt;
        return tmp;
    }
};

struct VectorInputer : Inputer {
    vector&lt;int&gt; v;
    int pos = 0;

    VectorInputer(vector&lt;int&gt; v) : v(v) {}

    optional&lt;int&gt; fetch() override {
        if (pos == v.size())
            return nullopt;
        return v[pos++];
    }
};
</code></pre>
<pre><code class="language-cpp">reduce(new CinInputer(), new SumReducer());
reduce(new VectorInputer(v), new SumReducer());
reduce(new CinInputer(), new ProductReducer());
reduce(new VectorInputer(v), new ProductReducer());
</code></pre>
<p>Inputer è´Ÿè´£å‘Šè¯‰ reduce å‡½æ•°å¦‚ä½•è¯»å–æ•°æ®ï¼ŒReducer è´Ÿè´£å‘Šè¯‰ reduce å‡½æ•°å¦‚ä½•è®¡ç®—æ•°æ®ã€‚</p>
<p>è¿™å°±æ˜¯<strong>ä¾èµ–å€’ç½®åŸåˆ™</strong>ï¼šé«˜å±‚æ¨¡å—ï¼ˆreduce å‡½æ•°ï¼‰ä¸è¦ç›´æ¥ä¾èµ–äºä½å±‚æ¨¡å—ï¼ŒäºŒè€…éƒ½ä¾èµ–äºæŠ½è±¡ï¼ˆInputer å’Œ Reducer ç±»ï¼‰æ¥æ²Ÿé€šã€‚</p>
<h2 id="_4">ä¸è¦ä»€ä¹ˆä¸œè¥¿éƒ½å¡ä¸€å—</h2>
<p>æœ‰äº›ç³Ÿç³•çš„å®ç°ä¼šæŠŠåˆ†æ˜ä¸å±äºåŒä¸€å±‚æ¬¡çš„ä¸œè¥¿å¼ºè¡Œæ”¾åœ¨ä¸€èµ·ï¼Œæ¯”å¦‚æ²¡èƒ½åˆ†æ¸… Inputer å’Œ Reducer ç±»ï¼Œé”™è¯¯åœ°æŠŠä»–ä»¬è®¾è®¡æˆäº†ä¸€ä¸ªç±»ï¼</p>
<pre><code class="language-cpp">int reduce(Reducer *reducer) {
    int res = reducer-&gt;init();
    while (auto tmp = reducer-&gt;fetch()) {  // fetch å‡­ä»€ä¹ˆå’Œ initã€add æ”¾åœ¨ä¸€èµ·ï¼Ÿ
        res = reducer-&gt;add(res, tmp.value());
    }
    return res;
}
</code></pre>
<p>fetch æ˜æ˜å±äº IO æ“ä½œï¼ä½†ä»–è¢«é”™è¯¯åœ°æ”¾åœ¨äº†æœ¬åº”åªè´Ÿè´£è®¡ç®—çš„ Reducer é‡Œï¼</p>
<p>è¿™å¯¼è‡´ä½ å¿…é¡»å®ç°å››ä¸ªç±»ï¼Œç½—åˆ—æ‰€æœ‰çš„æ’åˆ—ç»„åˆï¼š</p>
<pre><code class="language-cpp">struct CinSumReducer : Reducer { ... };
struct VectorSumReducer : Reducer { ... };
struct CinProductReducer : Reducer { ... };
struct VectorProductReducer : Reducer { ... };
</code></pre>
<p>è¿™æ˜¾ç„¶æ˜¯ä¸ç¬¦åˆ<strong>å•ä¸€è´£ä»»åŸåˆ™</strong>çš„ã€‚</p>
<p>æ»¡è¶³<strong>å•ä¸€è´£ä»»åŸåˆ™</strong>ã€<strong>å¼€é—­åŸåˆ™</strong>ã€<strong>ä¾èµ–å€’ç½®åŸåˆ™</strong>çš„ä»£ç æ›´åŠ çµæ´»ã€æ˜“äºæ‰©å±•ã€æ˜“äºç»´æŠ¤ã€‚è¯·åŠ¡å¿…è®°ä½å¹¶è½å®èµ·æ¥ï¼
å¦åˆ™å³ä½ è£…æ¨¡ä½œæ ·åœ°ç”¨äº†è™šå‡½æ•°ï¼Œä¹Ÿä¸€æ ·ä¼šå¯¼è‡´ä»£ç é‡å¤ã€éš¾ä»¥ç»´æŠ¤ï¼</p>
<blockquote>
<p>è€æ¿å…‹æ‰£å·¥èµ„æ—¶å°±ä¸ç”¨éµå®ˆè¿™äº›åŸåˆ™</p>
</blockquote>
<h1 id="_5">é€‚é…å™¨æ¨¡å¼</h1>
<p>åˆšæ‰çš„ä¾‹å­ä¸­æˆ‘ä»¬ç”¨åˆ°äº† Inputer è™šæ¥å£ç±»ã€‚</p>
<pre><code class="language-cpp">struct CinInputer : Inputer {
    optional&lt;int&gt; fetch() override {
        int tmp;
        cin &gt;&gt; tmp;
        if (tmp == -1)
            return nullopt;
        return tmp;
    }
};

struct VectorInputer : Inputer {
    vector&lt;int&gt; v;
    int pos = 0;

    VectorInputer(vector&lt;int&gt; v) : v(v) {}

    optional&lt;int&gt; fetch() override {
        if (pos == v.size())
            return nullopt;
        return v[pos++];
    }
};
</code></pre>
<p>å¦‚æœæˆ‘ä»¬æƒ³è¦å®ç°ï¼šè¯»å–åˆ° 0 æˆªæ­¢ï¼Œè€Œä¸æ˜¯ -1 å‘¢ï¼Ÿéš¾é“è¿˜å¾—ç»™ CinInputer åŠ ä¸ªå‚æ•°ï¼Ÿ
ä½†æ˜¯ vector æœ‰æ—¶å€™ä¹Ÿå¯èƒ½æœ‰è¯»åˆ° -1 å°±æå‰æˆªæ–­çš„éœ€æ±‚å‘€ï¼Ÿ</p>
<p>è¿™æ˜æ˜¾è¿èƒŒäº†<strong>å•ä¸€è´£ä»»åŸåˆ™</strong>ã€‚</p>
<p>æ›´å¥½çš„è®¾è®¡æ˜¯ï¼Œè®© CinInputer æ— é™è¯»å–ï¼Œæ°¸è¿œæˆåŠŸã€‚
ç„¶åå¦å¤–å¼„ä¸€ä¸ª StopInputerAdapterï¼Œå…¶æ¥å—ä¸€ä¸ª CinInputer ä½œä¸ºæ„é€ å‚æ•°ã€‚
å½“ StopInputerAdapter è¢«è¯»å–æ—¶ï¼Œä»–ä¼šæ£€æŸ¥æ˜¯å¦ä¸º -1ï¼Œå¦‚æœå·²ç»å¾—åˆ° -1ï¼Œé‚£ä¹ˆå°±è¿”å› nulloptï¼Œä¸ä¼šè¿›ä¸€æ­¥è°ƒç”¨ CinInputer äº†ã€‚</p>
<p>StopInputerAdapter è´Ÿè´£å¤„ç†æˆªæ–­é—®é¢˜ï¼ŒCinInputer åªæ˜¯è´Ÿè´£è¯»å– cin è¾“å…¥ã€‚æ»¡è¶³äº†<strong>å•ä¸€è´£ä»»åŸåˆ™</strong>ã€‚</p>
<pre><code class="language-cpp">struct StopInputerAdapter : Inputer {
    Inputer *inputer;
    int stopMark;

    StopInputerAdapter(Inputer *inputer, int stopMark)
        : inputer(inputer)
        , stopMark(stopMark)
    {}

    optional&lt;int&gt; fetch() override {
        auto tmp = inputer-&gt;fetch();
        if (tmp == stopMark)
            return nullopt;
        return tmp;
    }
};
</code></pre>
<p>è¿™é‡Œçš„ StopInputerAdapter å°±æ˜¯ä¸€ä¸ªé€‚é…å™¨ï¼Œä»–æŠŠ CinInputer çš„æ¥å£ï¼ˆæ— é™è¯»å–ï¼‰å åŠ ä¸Šäº†ä¸€ä¸ªé¢å¤–åŠŸèƒ½ï¼Œè¯»åˆ°æŒ‡å®šçš„ stopMark å€¼å°±åœæ­¢ï¼Œäº§ç”Ÿäº†ä¸€ä¸ªæ–°çš„ Inputerã€‚</p>
<pre><code class="language-cpp">reduce(new StopInputerAdapter(new CinInputer(), -1), new SumReducer());      // ä» cin è¯»åˆ° -1 ä¸ºæ­¢
reduce(new StopInputerAdapter(new VectorInputer(v), -1), new SumReducer());  // ä» vector è¯»åˆ° -1 ä¸ºæ­¢
reduce(new VectorInputer(), new SumReducer());  // ä» vector è¯»ï¼Œä½†æ— éœ€æˆªæ–­
</code></pre>
<p>è¿™å°±æ˜¯<strong>é€‚é…å™¨æ¨¡å¼</strong>ï¼šå°†ä¸€ä¸ªç±»çš„æ¥å£æ·»æ²¹åŠ é†‹ï¼Œè½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦ä¸€ä¸ªæ¥å£ã€‚</p>
<ul>
<li>StopInputerAdapter è¿™ä¸ªé€‚é…å™¨æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ª Inputerï¼Œå¯ä»¥ç›´æ¥ä½œä¸º reduce çš„å‚æ•°ï¼Œé€‚åº”äº†ç°æœ‰çš„<strong>ç­–ç•¥æ¨¡å¼</strong>ã€‚</li>
<li>StopInputerAdapter å¹¶ä¸ä¾èµ–äºå‚æ•° Inputer çš„åº•å±‚å®ç°ï¼Œå¯ä»¥æ˜¯ CinInputerã€ä¹Ÿå¯ä»¥æ˜¯ VectorInputerï¼Œæ»¡è¶³äº†<strong>ä¾èµ–å€’ç½®åŸåˆ™</strong>ã€‚</li>
<li>æœªæ¥å³ä½¿æ–°å¢äº†ä¸åŒç±»å‹çš„ Inputerï¼Œç”šè‡³æ˜¯å…¶ä»– InputerAdapterï¼Œä¸€æ ·å¯ä»¥é…åˆ StopInputerAdapter ä¸€èµ·ä½¿ç”¨è€Œæ— éœ€ä»»ä½•ä¿®æ”¹ï¼Œæ»¡è¶³äº†<strong>å¼€é—­åŸåˆ™</strong>ã€‚</li>
</ul>
<hr />
<p>å¦‚æœæˆ‘ä»¬è¿˜æƒ³å®ç°ï¼Œè¿‡æ»¤å‡ºæ‰€æœ‰æ­£æ•°å’Œé›¶ï¼Œè´Ÿæ•°ç›´æ¥ä¸¢å¼ƒå‘¢ï¼Ÿ</p>
<pre><code class="language-cpp">struct FilterInputerAdapter {
    Inputer *inputer;

    FilterInputerAdapter(Inputer *inputer)
        : inputer(inputer)
    {}

    optional&lt;int&gt; fetch() override {
        while (true) {
            auto tmp = inputer-&gt;fetch();
            if (!tmp.has_value()) {
                return nullopt;
            }
            if (tmp &gt;= 0) {
                return tmp;
            }
        }
    }
};
</code></pre>
<p>æ”¹è¿›ï¼šFilter çš„æ¡ä»¶ä¸åº”ä¸ºå†™æ­»çš„ <code>tmp &gt;= 0</code>ï¼Œè€Œåº”è¯¥æ˜¯ä¼ å…¥ä¸€ä¸ª FilterStrategyï¼Œå…è®¸ç”¨æˆ·æ‰©å±•ã€‚</p>
<pre><code class="language-cpp">struct FilterStrategy {
    virtual bool shouldPass(int value) = 0;  // è¿”å› true è¡¨ç¤ºè¯¥å€¼åº”è¯¥è¢«ä¿ç•™
};

struct FilterStrategyAbove : FilterStrategy { // å¤§äºä¸€å®šå€¼ï¼ˆthresholdï¼‰æ‰èƒ½é€šè¿‡
    int threshold;

    FilterStrategyAbove(int threshold) : threshold(threshold) {}

    bool shouldPass(int value) override {
        return value &gt; threshold;
    }
};

struct FilterStrategyBelow : FilterStrategy { // å°äºä¸€å®šå€¼ï¼ˆthresholdï¼‰æ‰èƒ½é€šè¿‡
    int threshold;

    FilterStrategyBelow(int threshold) : threshold(threshold) {}

    bool shouldPass(int value) override {
        return value &lt; threshold;
    }
};

struct FilterInputerAdapter : Inputer {
    Inputer *inputer;
    FilterStrategy *strategy;

    FilterInputerAdapter(Inputer *inputer, FilterStrategy *strategy)
        : inputer(inputer), strategy(strategy)
    {}

    optional&lt;int&gt; fetch() override {
        while (true) {
            auto tmp = inputer-&gt;fetch();
            if (!tmp.has_value()) {
                return nullopt;
            }
            if (strategy-&gt;shouldPass(tmp)) {
                return tmp;
            }
        }
    }
};
</code></pre>
<p>FilterStrategy åˆå¯ä»¥è¿›ä¸€æ­¥è¿ç”¨é€‚é…å™¨æ¨¡å¼ï¼šä¾‹å¦‚æˆ‘ä»¬å¯ä»¥æŠŠ FilterStrategyAbove(0) å’Œ FilterStrategyBelow(100) ç»„åˆèµ·æ¥ï¼Œå®ç°è¿‡æ»¤å‡º 0ï½100 èŒƒå›´å†…çš„æ•´æ•°ã€‚</p>
<pre><code class="language-cpp">struct FilterStrategyAnd : FilterStrategy {  // è¦æ±‚ a å’Œ b ä¸¤ä¸ªè¿‡æ»¤ç­–ç•¥éƒ½ä¸º trueï¼Œæ‰èƒ½é€šè¿‡
    FilterStrategy *a;
    FilterStrategy *b;

    FilterStrategyAnd(FilterStrategy *a, FilterStrategy *b)
        : a(a), b(b)
    {}

    bool shouldPass(int value) override {
        return a-&gt;shouldPass(value) &amp;&amp; b-&gt;shouldPass(value);
    }
};
</code></pre>
<pre><code class="language-cpp">reduce(
    new FilterInputerAdapter(
        new StopInputerAdapter(
            new CinInputer(),
            -1
        ),
        new FilterStrategyAnd(
            new FilterStrategyAbove(0),
            new FilterStrategyBelow(100)
        )
    ),
    new SumReducer());
</code></pre>
<p>æ˜¯ä¸æ˜¯é€»è¾‘éå¸¸æ¸…æ™°ï¼Œè€Œä¸”å®¹æ˜“æ‰©å±•å‘¢ï¼Ÿ</p>
<blockquote>
<p>å®é™…ä¸Šå‡½æ•°å¼å’Œæ¨¡æ¿å…ƒç¼–ç¨‹æ›´æ“…é•¿åšè¿™ç§å·¥ä½œï¼Œä½†ä»Šå¤©å…ˆä»‹ç»å®ŒåŸæ±åŸå‘³çš„ Java é£æ ¼é¢å‘å¯¹è±¡ï¼Œä»–ä»¬å¤ç”¨ä»£ç çš„æ€è·¯æ˜¯å…±é€šçš„ã€‚
ä½ å…ˆå­¦ä¼šèµ°è·¯ï¼Œæ˜å¤©æˆ‘ä»¬å†æ¥å­¦ä¹ è·‘æ­¥ï¼Œå¥½å§ï¼Ÿ</p>
</blockquote>
<h2 id="_6">è·¨æ¥å£çš„é€‚é…å™¨</h2>
<p>é€‚é…å™¨æ¨¡å¼è¿˜å¯ä»¥ä½¿åŸæœ¬ç”±äºæ¥å£ä¸å…¼å®¹è€Œä¸èƒ½ä¸€èµ·å·¥ä½œçš„é‚£äº›ç±»å¯ä»¥ä¸€èµ·å·¥ä½œï¼Œä¾‹å¦‚ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“æä¾›äº†ç±»ä¼¼äºæˆ‘ä»¬ Inputer çš„è¾“å…¥æµæ¥å£ï¼Œä¹Ÿæ˜¯åŸºäºè™šå‡½æ•°çš„ã€‚ä½†æ˜¯ä»–çš„æ¥å£æ˜¾ç„¶ä¸èƒ½ç›´æ¥ä¼ å…¥æˆ‘ä»¬çš„ reduce å‡½æ•°ï¼Œæˆ‘ä»¬çš„ reduce å‡½æ•°åªæ¥å—æˆ‘ä»¬è‡ªå·±çš„ Inputer æ¥å£ã€‚è¿™æ—¶å°±å¯ä»¥ç”¨é€‚é…å™¨ï¼ŒæŠŠæ¥å£ç¿»è¯‘æˆæˆ‘ä»¬çš„ reducer èƒ½å¤Ÿç†è§£çš„ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªè‡ªç§° â€œPoostâ€ çš„ç¬¬ä¸‰æ–¹åº“æä¾›çš„æ¥å£ï¼š</p>
<pre><code class="language-cpp">struct PoostInputer {
    virtual bool hasNext() = 0;
    virtual int getNext() = 0;
};
</code></pre>
<p>ä»–ä»¬è¦æ±‚çš„ç”¨æ³•æ˜¯å…ˆåˆ¤æ–­ hasNext()ï¼Œç„¶åæ‰èƒ½è°ƒç”¨ getNext è¯»å–å‡ºçœŸæ­£çš„å€¼ã€‚å°å½­è€å¸ˆè®¾è®¡äº†ä¸€ä¸ª Poost é€‚é…å™¨ï¼ŒæŠŠ PoostInputer ç¿»è¯‘æˆæˆ‘ä»¬çš„ Inputerï¼š</p>
<pre><code class="language-cpp">struct PoostInputerAdapter : Inputer {
    PoostInputer *poostIn;

    PoostInputerAdapter(PoostInputer *poostIn)
        : poostIn(poostIn)
    {}

    optional&lt;int&gt; fetch() override {
        if (poostIn-&gt;hasNext()) {
            return poostIn-&gt;getNext();
        } else {
            return nullopt;
        }
    }
};
</code></pre>
<p>å½“æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ª PoostInputer æ—¶ï¼Œå¦‚æœæƒ³è¦è°ƒç”¨æˆ‘ä»¬è‡ªå·±çš„ reducerï¼Œå°±å¯ä»¥ç”¨è¿™ä¸ª PoostInputerAdapter å¥—ä¸€å±‚ï¼š</p>
<pre><code class="language-cpp">auto poostStdIn = poost::getStandardInput();
reduce(new PoostInputerAdapter(poostStdIn), new SumReducer());
</code></pre>
<p>è¿™æ ·å°±å¯ä»¥æ— ç¼åœ°æŠŠ PoostInputer ä½œä¸º reduce çš„å‚æ•°äº†ã€‚</p>
<h1 id="_7">å·¥å‚æ¨¡å¼</h1>
<p>ç°åœ¨ä½ æ˜¯ä¸€ä¸ªæ¸¸æˆå¼€å‘è€…ï¼Œä½ çš„ç©å®¶å¯ä»¥è£…å¤‡æ­¦å™¨ï¼Œä¸åŒçš„æ­¦å™¨å¯ä»¥å‘å‡ºä¸åŒçš„å­å¼¹ï¼</p>
<p>ä½ ä½¿ç”¨å°å½­è€å¸ˆæ•™çš„<strong>ç­–ç•¥æ¨¡å¼</strong>ï¼ŒæŠŠä¸åŒçš„å­å¼¹ç±»å‹ä½œä¸ºä¸åŒçš„ç­–ç•¥ä¼ å…¥ player å‡½æ•°ï¼Œé€ æˆä¸åŒç±»å‹çš„ä¼¤å®³ã€‚</p>
<pre><code class="language-cpp">struct Bullet {
    virtual void explode() = 0;
};

struct AK47Bullet : Bullet {
    void explode() override {
        puts(&quot;ç‰©ç†ä¼¤å®³&quot;);
    }
};

struct MagicBullet : Bullet {
    void explode() override {
        puts(&quot;é­”æ³•ä¼¤å®³&quot;);
    }
};

void player(Bullet *bullet) {
    bullet-&gt;explode();
}

player(new AK47Bullet());
player(new MagicBullet());
</code></pre>
<p>ä½†æ˜¯è¿™æ ·å°±ç›¸å½“äºæ¯ä¸ªç©å®¶åªæœ‰ä¸€å‘å­å¼¹ï¼Œå¬ä¸ªå“å°±æ²¡äº†â€¦</p>
<p>å¦‚ä½•å…è®¸ç©å®¶æºæºä¸æ–­åœ°åˆ›é€ æ–°å­å¼¹å‡ºæ¥ï¼Ÿæˆ‘ä»¬å¯ä»¥æŠŠâ€œåˆ›å»ºå­å¼¹â€è¿™ä¸€è¿‡ç¨‹æŠ½è±¡å‡ºæ¥ï¼Œæ”¾åœ¨ä¸€ä¸ªâ€œæªâ€ç±»é‡Œã€‚</p>
<pre><code class="language-cpp">struct Gun {
    virtual Bullet *shoot() = 0;
};

struct AK47Gun : Gun {
    Bullet *shoot() override {
        return new AK47Bullet();
    }
};

struct MagicGun : Gun {
    Bullet *shoot() override {
        return new MagicBullet();
    }
};

void player(Gun *gun) {
    for (int i = 0; i &lt; 100; i++) {
        Bullet *bullet = gun-&gt;shoot();
        bullet-&gt;explode();
    }
}

player(new AK47Gun());
player(new MagicGun());
</code></pre>
<p>ç°åœ¨ï¼Œä½ çš„ç©å®¶å¯ä»¥ç›´æ¥é€‰æ‹©ä¸åŒçš„æªäº†ï¼</p>
<p>è¿™å°±æ˜¯æ‰€è°“çš„<strong>å·¥å‚æ¨¡å¼</strong>ï¼šâ€œæªâ€å°±æ˜¯â€œå­å¼¹â€å¯¹è±¡çš„å·¥å‚ã€‚
ä¼ ç»™ç©å®¶çš„æ˜¯å­å¼¹çš„å·¥å‚â€”â€”æªï¼Œè€Œä¸æ˜¯å­å¼¹æœ¬èº«ã€‚
åªè¦è°ƒç”¨å·¥å‚çš„ shoot å‡½æ•°ï¼Œç©å®¶å¯ä»¥æºæºä¸æ–­åœ°åˆ›å»ºæ–°å­å¼¹å‡ºæ¥ã€‚
æ­£æ‰€è°“æˆäººä»¥é±¼ä¸å¦‚æˆäººä»¥æ¸”ï¼Œä½ çš„ç©å®¶ä¸å†æ˜¯è¢«åŠ¨æ¥å—å­å¼¹ï¼Œè€Œæ˜¯å¯ä»¥è‡ªå·±åˆ›é€ å­å¼¹äº†ï¼</p>
<p>å·¥å‚è¿˜å¯ä»¥å…·æœ‰ä¸€å®šçš„å‚æ•°ï¼Œä¾‹å¦‚æˆ‘ä»¬éœ€è¦æ¨¡æ‹Ÿ AK47 å¯èƒ½â€œå—æ½®â€ï¼Œå¯¼è‡´äº§ç”Ÿçš„å­å¼¹å¨åŠ›é™ä½ã€‚
å°±å¯ä»¥ç»™æªåŠ ä¸€ä¸ª isWet å‚æ•°ï¼Œç»™å­å¼¹åŠ ä¸€ä¸ª damage å‚æ•°ï¼Œè®© AK47 ç”Ÿæˆå­å¼¹çš„æ—¶å€™ï¼Œæ ¹æ® isWet ä¸ºå­å¼¹æ„é€ å‡½æ•°è®¾ç½®ä¸åŒçš„ damageã€‚</p>
<pre><code class="language-cpp">struct AK47Bullet {
    int damage;

    AK47Bullet(int damage) : damage(damage) {}

    void explode() {
        printf(&quot;é€ æˆ %d ç‚¹ç‰©ç†ä¼¤å®³\n&quot;, damage);
    }
};

struct AK47Gun : Gun {
    bool isWet;

    AK47Gun(bool isWet) : isWet(isWet) {}

    Bullet *shoot() override {
        if (isWet)
            return new AK47Bullet(5);  // å—æ½®äº†ï¼Œä¼¤å®³é™ä½ä¸º 5
        else
            return new AK47Bullet(10); // æ­£å¸¸æƒ…å†µä¸‹ä¼¤å®³ä¸º 10
    }
};
</code></pre>
<p>æˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨æ¨¡æ¿è‡ªåŠ¨ä¸ºä¸åŒçš„å­å¼¹ç±»å‹æ‰¹é‡å®šä¹‰å·¥å‚ï¼š</p>
<pre><code class="language-cpp">template &lt;class B&gt;
struct GunWithBullet : Gun {
    static_assert(is_base_of&lt;Bullet, B&gt;::value, &quot;B å¿…é¡»æ˜¯ Bullet çš„å­ç±»&quot;);

    Bullet *shoot() override {
        return new B();
    }
};

void player(Gun *gun) {
    for (int i = 0; i &lt; 100; i++) {
        Bullet *bullet = gun-&gt;shoot();
        bullet-&gt;explode();
    }
}

player(new GunWithBullet&lt;AK47Bullet&gt;());
player(new GunWithBullet&lt;MagicBullet&gt;());
</code></pre>
<p>è¿™æ ·å°±ä¸å¿…æ¯æ¬¡æ·»åŠ æ–°å­å¼¹ç±»å‹æ—¶ï¼Œéƒ½å¾—æ–°å»ºä¸€ä¸ªç›¸åº”çš„æªç±»å‹äº†ï¼Œè¿›ä¸€æ­¥é¿å…äº†ä»£ç é‡å¤ã€‚å¯è§æ¨¡æ¿å…ƒç¼–ç¨‹å®Œå…¨å¯ä¸ä¼ ç»Ÿé¢å‘å¯¹è±¡å¼ºå¼ºè”æ‰‹ã€‚</p>
<h2 id="_8">è¶…çº§å·¥å‚æ¨¡å¼</h2>
<pre><code class="language-cpp">Gun *getGun(string name) {
    if (name == &quot;AK47&quot;) {
        return new GunWithBullet&lt;AK47Bullet&gt;();
    } else if (name == &quot;Magic&quot;) {
        return new GunWithBullet&lt;MagicBullet&gt;();
    } else {
        throw runtime_error(&quot;æ²¡æœ‰è¿™ç§æª&quot;);
    }
}

player(getGun(&quot;AK47&quot;));
player(getGun(&quot;Magic&quot;));
</code></pre>
<h2 id="raii">RAII è‡ªåŠ¨ç®¡ç†å†…å­˜</h2>
<pre><code class="language-cpp">template &lt;class B&gt;
struct GunWithBullet : Gun {
    static_assert(is_base_of&lt;Bullet, B&gt;::value, &quot;B å¿…é¡»æ˜¯ Bullet çš„å­ç±»&quot;);

    Bullet *shoot() override {
        return new B();
    }
};

void player(Gun *gun) {
    for (int i = 0; i &lt; 100; i++) {
        Bullet *bullet = gun-&gt;shoot();
        bullet-&gt;explode();
        delete bullet;  // åˆšæ‰æ²¡æœ‰ deleteï¼ä¼šäº§ç”Ÿå†…å­˜æ³„æ¼ï¼
    }
}

player(new GunWithBullet&lt;AK47Bullet&gt;());
player(new GunWithBullet&lt;MagicBullet&gt;());
</code></pre>
<p>ç°åœ¨çš„å·¥å‚ä¸€èˆ¬éƒ½ä¼šè¿”å›æ™ºèƒ½æŒ‡é’ˆå°±æ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>å…·ä½“æ¥è¯´å°±æ˜¯ç”¨ <code>unique_ptr&lt;T&gt;</code> ä»£æ›¿ <code>T *</code>ï¼Œç”¨ <code>make_unique&lt;T&gt;(xxx)</code> ä»£æ›¿ <code>new T(xxx)</code>ã€‚</p>
<pre><code class="language-cpp">template &lt;class B&gt;
struct GunWithBullet : Gun {
    static_assert(is_base_of&lt;Bullet, B&gt;::value, &quot;B å¿…é¡»æ˜¯ Bullet çš„å­ç±»&quot;);

    unique_ptr&lt;Bullet&gt; shoot() override {
        return make_unique&lt;B&gt;();
    }
};

void player(Gun *gun) {
    for (int i = 0; i &lt; 100; i++) {
        auto bullet = gun-&gt;shoot();
        bullet-&gt;explode();
        // unique_ptr åœ¨é€€å‡ºå½“å‰ {} æ—¶ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œä¸ç”¨ä½ æƒ¦è®°ç€äº†
    }
}

player(make_unique&lt;GunWithBullet&lt;AK47Bullet&gt;&gt;().get());
player(make_unique&lt;GunWithBullet&lt;MagicBullet&gt;&gt;().get());
</code></pre>
<blockquote>
<p>è¿™é‡Œ C++ æ ‡å‡†ä¿è¯äº† unique_ptr çš„ç”Ÿå‘½å‘¨æœŸæ˜¯è¿™ä¸€æ•´è¡Œï¼ˆ; ç»“æŸå‰ï¼‰ï¼Œæ•´ä¸ª player æ‰§è¡ŒæœŸé—´éƒ½æ´»ç€ï¼Œä¸ä¼šæå‰é‡Šæ”¾
æ­£å¦‚ <code>func(string().c_str())</code> ä¸ä¼šæœ‰ä»»ä½•é—®é¢˜ï¼Œstring è¦åˆ° func è¿”å›åæ‰é‡Šæ”¾å‘¢ï¼</p>
</blockquote>
<p>åªè¦æŠŠæ‰€æœ‰ <code>make_unique&lt;T&gt;</code> çœ‹ä½œ <code>new T</code>ï¼ŒæŠŠæ‰€æœ‰çš„ <code>unique_ptr&lt;T&gt;</code> çœ‹ä½œ <code>T *</code>ï¼Œç”¨æ³•å‡ ä¹ä¸€æ ·ï¼Œä½†æ²¡æœ‰å†…å­˜æ³„æ¼ï¼Œæ— éœ€æ‰‹åŠ¨ deleteã€‚</p>
<h2 id="_9">å·¥å‚æ¨¡å¼å®æˆ˜</h2>
<p>å›åˆ°æ•°ç»„æ±‚å’Œé—®é¢˜ã€‚</p>
<pre><code class="language-cpp">int sum(vector&lt;int&gt; v) {
    int res = 0;
    for (int i = 0; i &lt; v.size(); i++) {
        res = res + v[i];
    }
    return res;
}

int product(vector&lt;int&gt; v) {
    int res = 1;
    for (int i = 0; i &lt; v.size(); i++) {
        res = res * v[i];
    }
    return res;
}

int average(vector&lt;int&gt; v) {
    int res = 0;
    int count = 0;
    for (int i = 0; i &lt; v.size(); i++) {
        res = res + v[i];
        count = count + 1;
    }
    return res / count;
}
</code></pre>
<p>æˆ‘ä»¬æƒ³è¦åŠ ä¸€ä¸ªæ±‚å¹³å‡å€¼çš„å‡½æ•° averageï¼Œè¿™è¯¥å¦‚ä½•ä¸ sum åˆèµ·æ¥ï¼Ÿ</p>
<p>æ³¨æ„å› ä¸ºæˆ‘ä»¬è¦æ”¯æŒä» CinInputer è¯»å…¥æ•°æ®ï¼Œå¹¶ä¸ä¸€å®šåƒä¸€æ · VectorInputer èƒ½å¤Ÿæå‰å¾—åˆ°æ•°ç»„å¤§å°ï¼Œä¸ç„¶ä¹Ÿä¸éœ€è¦ count äº†ã€‚</p>
<pre><code class="language-cpp">int reduce(vector&lt;int&gt; v) {
    int res = ???;              // sum æ—¶è¿™é‡Œæ˜¯ 0ï¼Œproduct æ—¶è¿™é‡Œæ˜¯ 1
    int count? = ???;           // sum å’Œ product ç”¨ä¸åˆ°è¯¥å˜é‡ï¼Œåªæœ‰ average éœ€è¦
    for (int i = 0; i &lt; v.size(); i++) {
        res = res ??? v[i];   // sum æ—¶è¿™é‡Œæ˜¯ +ï¼Œproduct æ—¶è¿™é‡Œæ˜¯ *
        count? = count? ???;  // average æ—¶è¿™é‡Œè¿˜éœ€è¦é¢å¤–ä¿®æ”¹ count å˜é‡ï¼
    }
    return res;
}
</code></pre>
<p>çœ‹æ¥æˆ‘ä»¬éœ€è¦å…è®¸ Reducer çš„ init() è¿”å› â€œä»»æ„æ•°é‡çš„çŠ¶æ€å˜é‡â€ï¼
ä»¥å‰çš„è®¾è®¡è®© init() åªèƒ½è¿”å›å•ä¸ª int æ˜¯ä¸ªé”™è¯¯çš„å†³å®šã€‚
è¿™æ—¶å€™å°±å¯ä»¥æŠŠ â€œä»»æ„æ•°é‡çš„çŠ¶æ€å˜é‡â€ å°è£…æˆä¸€ä¸ªæ–°çš„ç±»ã€‚
ç„¶åæ”¹ä¸ºç”±è¿™ä¸ªç±»è´Ÿè´£æä¾›è™šå‡½æ•° add()ã€‚
ä¸”åªéœ€è¦æä¾›ä¸€ä¸ªå³ä¾§å‚æ•°äº†ï¼Œå·¦ä¾§çš„ res å˜é‡å·²ç»å­˜åœ¨ ReducerState ä½“å†…äº†ã€‚</p>
<pre><code class="language-cpp">struct ReducerState {
    virtual void add(int val) = 0;
    virtual int result() = 0;
};

struct Reducer {
    virtual unique_ptr&lt;ReducerState&gt; init() = 0;
};

struct SumReducerState : ReducerState {
    int res;

    SumReducerState() : res(0) {}

    void add(int val) override {
        res = res + val;
    }

    int result() override {
        return res;
    }
};

struct ProductReducerState : ReducerState {
    int res;

    ProductReducerState() : res(1) {}

    void add(int val) override {
        res = res * val;
    }

    int result() override {
        return res;
    }
};

struct AverageReducerState : ReducerState {
    int res;
    int count;

    AverageReducerState() : res(0), count(0) {}

    void add(int val) override {
        res = res + val;
        count = count + 1;
    }

    int result() override {
        return res / count;
    }
};

struct SumReducer : Reducer {
    unique_ptr&lt;ReducerState&gt; init() override {
        return make_unique&lt;SumReducerState&gt;();
    }
};

struct ProductReducer : Reducer {
    unique_ptr&lt;ReducerState&gt; init() override {
        return make_unique&lt;ProductReducerState&gt;();
    }
};

struct AverageReducer : Reducer {
    unique_ptr&lt;ReducerState&gt; init() override {
        return make_unique&lt;AverageReducerState&gt;();
    }
};
</code></pre>
<p>è¿™é‡Œ Reducer å°±æˆäº† ReducerState çš„å·¥å‚ã€‚</p>
<pre><code class="language-cpp">int reduce(Inputer *inputer, Reducer *reducer) {
    unique_ptr&lt;ReducerState&gt; state = reducer-&gt;init();
    while (auto val = inputer-&gt;fetch()) {
        state-&gt;add(val);
    }
    return state-&gt;result();
}

int main() {
    vector&lt;int&gt; v;
    reduce(make_unique&lt;VectorInputer&gt;(v).get(), make_unique&lt;SumReducer&gt;().get());
    reduce(make_unique&lt;VectorInputer&gt;(v).get(), make_unique&lt;ProductReducer&gt;().get());
    reduce(make_unique&lt;VectorInputer&gt;(v).get(), make_unique&lt;AverageReducer&gt;().get());
}
</code></pre>
<hr />
<p>ç°åœ¨ï¼Œè€æ¿éœ€æ±‚æ”¹å˜ï¼Œä»–æƒ³è¦<strong>å¹¶è¡Œ</strong>çš„ sum å’Œ product å‡½æ•°ï¼</p>
<p>å¹¶è¡Œç‰ˆéœ€è¦åˆ›å»ºå¾ˆå¤šä¸ªä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡éœ€è¦æœ‰ä¸€ä¸ªè‡ªå·±çš„ä¸­é—´ç»“æœå˜é‡ï¼Œæœ€åçš„ç»“æœè®¡ç®—åˆéœ€è¦ä¸€ä¸ªä¸­é—´å˜é‡ã€‚
è¿˜å¥½ä½ æ—©å·²æå‰é‡‡ç”¨å·¥å‚æ¨¡å¼ï¼Œå…è®¸å‡½æ•°ä½“å†…å¤šæ¬¡åˆ›å»º ReducerState å¯¹è±¡ã€‚</p>
<pre><code class="language-cpp">int reduce(Inputer *inputer, Reducer *reducer) {
    tbb::task_group g;
    list&lt;unique_ptr&lt;ReducerState&gt;&gt; local_states;
    vector&lt;int&gt; chunk;
    auto enqueue_chunk = [&amp;]() {
        local_chunks.emplace_back();
        g.run([chunk = move(chunk), &amp;back = local_chunks.back()]() {
            auto local_state = reducer-&gt;init();
            for (auto &amp;&amp;c: chunk) {
                local_state-&gt;add(c);
            }
            back = move(local_state); // list ä¿è¯å·²ç»æ’å…¥å…ƒç´ çš„å¼•ç”¨ä¸ä¼šå¤±æ•ˆï¼Œæ‰€ä»¥å¯ä»¥æš‚å­˜ back å¼•ç”¨
        });
        chunk.clear();
    };
    while (auto tmp = inputer-&gt;fetch()) {
        if (chunk.size() &lt; 64) { // è¿˜æ²¡å¡«æ»¡ 64 ä¸ª
            chunk.push_back(tmp);
        } else { // å¡«æ»¡äº† 64 ä¸ªï¼Œå¯ä»¥æäº¤æˆä¸€ä¸ªå•ç‹¬ä»»åŠ¡äº†
            enqueue_chunk();
        }
    }
    if (chunk.size() &gt; 0) {
        enqueue_chunk(); // æäº¤ä¸è¶³ 64 ä¸ªçš„æ®‹ä½™é¡¹
    }
    g.wait();
    auto final_state = reducer-&gt;init();
    for (auto &amp;&amp;local_state: local_states) {
        res = final_state-&gt;add(local_state-&gt;result());
    }
    return final_state-&gt;result();
}
</code></pre>
<p>åªéœ€è¦æŠŠ reducer å‚æ•°æ›¿æ¢ä¸º MinReducerã€AverageReducerâ€¦â€¦å°±è‡ªåŠ¨é€‚ç”¨äºä¸åŒçš„è®¡ç®—ä»»åŠ¡ï¼Œè€Œä¸ç”¨ä¸ºä»–ä»¬æ¯ä¸ªå•ç‹¬ç¼–å†™å¹¶è¡Œç‰ˆæœ¬çš„ä»£ç ã€‚</p>
<p>è¯¾åä½œä¸šï¼šä½¿ç”¨æ¨¡æ¿æ‰¹é‡å®šä¹‰æ‰€æœ‰çš„ Reducerï¼ä¾‹å¦‚ï¼š</p>
<pre><code class="language-cpp">using MinReducer = ReducerWithState&lt;MinReducerState&gt;;
...
</code></pre>
<h1 id="_10">äº«å…ƒæ¨¡å¼</h1>
<p>åœ¨äºŒç»´æ¸¸æˆå¼€å‘ä¸­ï¼Œå¸¸å¸¸ä¼šæåˆ°ä¸€ç§ç§°ä¸º Spriteï¼ˆç²¾çµè´´å›¾ï¼‰çš„é»‘è¯ï¼Œå®é™…ä¸Šå°±æ˜¯æ¯ä¸ªå¯¹è±¡è‡ªå·±æœ‰ä¸€å¼ è´´å›¾ï¼Œè´´å›¾è·Ÿç€ç‰©ä½“çš„ä½ç½®èµ°ã€‚</p>
<pre><code class="language-cpp">struct Bullet {
    glm::vec3 position;
    glm::vec3 velocity;
    vector&lt;char&gt; texture;

    void draw() {
        glDrawPixels(position, texture);
    }
};
</code></pre>
<p>texture é‡Œé¢å­˜å‚¨ç€è´´å›¾çš„ RGB æ•°æ®ï¼Œä»–ç›´æ¥å°±æ˜¯ Bullet çš„æˆå‘˜ã€‚
è¿™æ ·çš„è¯ï¼Œå¦‚æœæˆ‘ä»¬çš„ç©å®¶æ‰“å‡ºäº† 100 é¢—å­å¼¹ï¼Œå°±éœ€è¦å­˜å‚¨ 100 ä¸ªè´´å›¾æ•°ç»„ã€‚
å¦‚æœæˆ‘ä»¬çš„ç©å®¶åŒæ—¶æ‰“å‡ºäº† 1000 é¢—å­å¼¹ï¼Œå°±éœ€è¦å­˜å‚¨ 1000 ä¸ªè´´å›¾æ•°ç»„ã€‚
è¿™æ ·çš„è¯ï¼Œå†…å­˜æ¶ˆè€—å°†ä¼šéå¸¸å¤§ã€‚ç„¶è€Œæ‰€æœ‰åŒç±»å‹çš„ Bulletï¼Œå…¶è´´å›¾æ•°ç»„å…¶å®æ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œå®Œå…¨æ²¡å¿…è¦å„è‡ªå­˜é‚£ä¹ˆå¤šä»½æ‹·è´ã€‚</p>
<p>ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<strong>äº«å…ƒæ¨¡å¼</strong>ï¼šå…±äº«å¤šä¸ªå¯¹è±¡ä¹‹é—´<strong>ç›¸åŒ</strong>çš„éƒ¨åˆ†ï¼ŒèŠ‚çœå†…å­˜å¼€é”€ã€‚</p>
<p>è¿™é‡Œæ¯é¢—å­å¼¹çš„ positionã€velocity æ˜¾ç„¶éƒ½æ˜¯å„æœ‰ä¸åŒçš„ï¼Œä¸å¯èƒ½æ‰€æœ‰å­å¼¹éƒ½åœ¨åŒä¸€ä¸ªä½ç½®ä¸Šã€‚
ä½†æ˜¯å¾ˆå¤šå­å¼¹éƒ½ä¼šæœ‰ç€ç›¸åŒçš„è´´å›¾ï¼Œåªæœ‰ä¸åŒç±»å‹çš„å­å¼¹è´´å›¾ä¼šä¸ä¸€æ ·ã€‚
æ¯”å¦‚ç«ç„°å¼¹å’Œå¯’å†°å¼¹ä¼šæœ‰ä¸åŒçš„è´´å›¾ï¼Œä½†æ˜¯å½“åœºä¸Šå‡ºç° 100 é¢—ç«ç„°å¼¹æ—¶ï¼Œæ˜¾ç„¶ä¸éœ€è¦æ‹·è´ 100 ä»½å®Œå…¨ç›¸åŒçš„ç«ç„°å¼¹è´´å›¾ã€‚</p>
<pre><code class="language-cpp">struct Sprite {  // Sprite æ‰æ˜¯çœŸæ­£æŒæœ‰ï¼ˆå¾ˆå¤§çš„ï¼‰è´´å›¾æ•°æ®çš„
    vector&lt;char&gt; texture;

    void draw(glm::vec3 position) {
        glDrawPixels(position, texture);
    }
};

struct Bullet {
    glm::vec3 position;
    glm::vec3 velocity;
    shared_ptr&lt;Sprite&gt; sprite;  // å…è®¸å¤šä¸ªå­å¼¹å¯¹è±¡å…±äº«åŒä¸€ä¸ªç²¾çµè´´å›¾çš„æ‰€æœ‰æƒ

    void draw() {
        sprite-&gt;draw(position);  // è½¬å‘ç»™ Sprite è®©ä»–å¸®å¿™åœ¨æˆ‘çš„ä½ç½®ç»˜åˆ¶è´´å›¾
    }
};
</code></pre>
<p>éœ€è¦ç»˜åˆ¶å­å¼¹æ—¶ï¼ŒBullet çš„ draw åªæ˜¯ç®€å•åœ°è½¬å‘ç»™ Sprite ç±»çš„ drawã€‚
åªè¦å‘Šè¯‰ Sprite å­å¼¹çš„ä½ç½®å°±è¡Œï¼Œè´´å›¾æ•°æ®å·²ç»å­˜åœ¨ Sprite å†…éƒ¨ï¼Œè®©ä»–æ¥è´Ÿè´£çœŸæ­£ç»˜åˆ¶ã€‚
Bullet ç±»åªéœ€è¦ä¸“æ³¨äºä½ç½®ã€é€Ÿåº¦çš„æ›´æ–°å³å¯ï¼Œä¸å¿…å»æ“å¿ƒç€è´´å›¾ç»˜åˆ¶çš„ç»†èŠ‚ï¼Œå®ç°äº†è§£è€¦ã€‚</p>
<p>è¿™ç§å‡½æ•°è°ƒç”¨çš„è½¬å‘ä¹Ÿè¢«ç§°ä¸º<strong>ä»£ç†æ¨¡å¼</strong>ã€‚</p>
<h2 id="_11">ä»£ç†æ¨¡å¼</h2>
<p>è¿™æ ·è¿˜æœ‰ä¸€ä¸ªå¥½å¤„é‚£å°±æ˜¯ï¼ŒSprite å¯ä»¥è®¾è®¡æˆä¸€ä¸ªè™šå‡½æ•°æ¥å£ç±»ï¼š</p>
<pre><code class="language-cpp">struct Sprite {
    virtual void draw(glm::vec3 position) = 0;
};

struct FireSprite : Sprite {
    vector&lt;char&gt; fireTexture;

    FireSprite() : fireTexture(loadTexture(&quot;fire.jpg&quot;)) {}

    void draw(glm::vec3 position) override {
        glDrawPixels(position, fireTexture);
    }
};

struct IceSprite : Sprite { // å‡å¦‚å¯’å†°å¼¹éœ€è¦ä¸¤å¼ è´´å›¾ï¼Œä¹Ÿæ²¡é—®é¢˜ï¼å› ä¸ºè™šæ¥å£ç±»å…è®¸å­ç±»æœ‰ä¸åŒçš„æˆå‘˜ï¼Œä¸åŒçš„ç»“æ„ä½“å¤§å°
    vector&lt;char&gt; iceTexture1;
    vector&lt;char&gt; iceTexture2;

    IceSprite()
    : iceTexture1(loadTexture(&quot;ice1.jpg&quot;))
    , iceTexture2(loadTexture(&quot;ice2.jpg&quot;))
    {}

    void draw(glm::vec3 position) override {
        glDrawPixels(position, iceTexture1);
        glDrawPixels(position, iceTexture2);
    }
};
</code></pre>
<pre><code class="language-cpp">struct Bullet {
    glm::vec3 position;
    glm::vec3 velocity;
    shared_ptr&lt;Sprite&gt; sprite;  // Sprite è´Ÿè´£å«æœ‰è™šå‡½æ•°

    void draw() {  // Bullet çš„ draw å°±ä¸ç”¨æ˜¯è™šå‡½æ•°äº†ï¼
        sprite-&gt;draw(position);
    }
};
</code></pre>
<h1 id="_12">ç»„ä»¶æ¨¡å¼</h1>
<pre><code class="language-cpp"></code></pre>
<h1 id="_13">è™šå‡½æ•°å¸¸è§é—®é¢˜è¾¨æ</h1>
<h2 id="bool">è¿”å› bool çš„è™šå‡½æ•°</h2>
<h2 id="_14">è¯¾åä½œä¸š</h2>
<p>ä½ æ‹¿åˆ°äº†ä¸€ä¸ªå¤§å­¦ç”Ÿè®¡ç®—å™¨çš„å¤§ä½œä¸šï¼š</p>
<pre><code class="language-cpp">int main() {
    char c;
    cout &lt;&lt; &quot;è¯·è¾“å…¥ç¬¬ä¸€ä¸ªæ•°ï¼š&quot;;
    cin &gt;&gt; a;
    cout &lt;&lt; &quot;è¯·è¾“å…¥ç¬¬äºŒä¸ªæ•°ï¼š&quot;;
    cin &gt;&gt; b;
    cout &lt;&lt; &quot;è¯·è¾“å…¥è¿ç®—ç¬¦ï¼š&quot;;
    cin &gt;&gt; c;
    if (c == '+') {
        cout &lt;&lt; a + b;
    } else if (c == '-') {
        cout &lt;&lt; a - b;
    } else if (c == '*') {
        cout &lt;&lt; a * b;
    } else if (c == '/') {
        cout &lt;&lt; a / b;
    } else {
        cout &lt;&lt; &quot;ä¸æ”¯æŒçš„è¿ç®—ç¬¦&quot;;
    }
}
</code></pre>
<p>ä½ å¼€å§‹ç”¨ç­–ç•¥æ¨¡å¼æ”¹é€ å®ƒï¼š</p>
<pre><code class="language-cpp">struct Calculator {
    virtual int calculate(int a, int b) = 0;
};

struct AddCalculator : Calculator {
    int calculate(int a, int b) override {
        return a + b;
    }
};

struct SubCalculator : Calculator {
    int calculate(int a, int b) override {
        return a - b;
    }
};

struct MulCalculator : Calculator {
    int calculate(int a, int b) override {
        return a * b;
    }
};

struct DivCalculator : Calculator {
    int calculate(int a, int b) override {
        return a / b;
    }
};

Calculator *getCalculator(char c) {
    if (c == '+') {
        calculator = new AddCalculator();
    } else if (c == '-') {
        calculator = new SubCalculator();
    } else if (c == '*') {
        calculator = new MulCalculator();
    } else if (c == '/') {
        calculator = new DivCalculator();
    } else {
        throw runtime_error(&quot;ä¸æ”¯æŒçš„è¿ç®—ç¬¦&quot;);
    }
};

int main() {
    char c;
    cout &lt;&lt; &quot;è¯·è¾“å…¥ç¬¬ä¸€ä¸ªæ•°ï¼š&quot;;
    cin &gt;&gt; a;
    cout &lt;&lt; &quot;è¯·è¾“å…¥ç¬¬äºŒä¸ªæ•°ï¼š&quot;;
    cin &gt;&gt; b;
    cout &lt;&lt; &quot;è¯·è¾“å…¥è¿ç®—ç¬¦ï¼š&quot;;
    cin &gt;&gt; c;
    Calculator *calculator = getCalculator(c);
    cout &lt;&lt; calculator-&gt;calculate(a, b);
}
</code></pre></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>å°å½­è€å¸ˆå€¾ â™¥ åˆ¶ä½œ</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../js/print-site.js"></script>
        <script src="../extra.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
